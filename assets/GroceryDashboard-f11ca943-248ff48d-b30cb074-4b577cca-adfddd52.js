import{E as X,A as Z,k as D,Y as J,f as d,a0 as Q,a1 as Y,y as e,a2 as A,a3 as O,a8 as W,i as G,X as ee,t as ae,u as se,v as te,_ as re,g as ce,x as N,Z as ie,B as oe,m as de,n as ne,I as le,T as me,N as q}from"./index-87ab05f1.js";import{E as ue,G as pe}from"./BaseStoreDashboard-9ad5c13e-d7a1a933-4e4e637d-e46edf80-92fa8562.js";import{s as z,u as he}from"./useStoreDashboard-6cfa5bdd-a014cfe4-c8bff8db-4123484f-ad5d382b.js";import fe from"./OverviewTab-a01a807a-07dd1735-5ada0bfc-c4caa4a6-82fd39ae.js";import{a as _}from"./input-977568de-bea10295-4adb3258-368f21ef-dd0395aa.js";import{$ as be,T as je,H as xe,D as ge,_ as ye}from"./select-03f52418-c5111b6c-af5e7482-637f31c9-c1fa3325.js";import{u as $}from"./label-6ced007b-31f64b09-71156226-1e4e75c4-8af8544c.js";import"./textarea-03a75c76-69040bf5-35a9782e-8e0ca7dd-b23a1c90.js";import{l as ve,b as ke}from"./index-e23a302d-1b9287b5-b6450a0d-35f60f24-c4974312.js";import{k as Ne}from"./check-78166ef5-9630779a-ee565adf-12fad7f6-47c88872.js";import{d as we}from"./badge-34bdff7c-b2c90fce-efd43af8-f7a84e83-2020d777.js";import{o as Ce,d as Pe,f as R,N as C,m as Se,b as P}from"./table-d515a05c-fec441de-a95c27a2-dbafa435-3628cfd7.js";import{e as T}from"./shopping-cart-8aca5ef3-095b1616-112594bf-3a6e2763-072beeee.js";import{o as _e}from"./search-566f00ed-c3babbf0-ad60b5b7-3e645f27-67335d64.js";import{k as $e}from"./pencil-b145156d-81e39600-5a684db5-7834b695-6280cdd5.js";import Ee from"./OrdersManagementTab-74307886-48065a75-18a01665-f134e541-ee33a121.js";import{B as qe}from"./BulkUploadTab-0fe3efc4-824a62de-987b67e9-4bcf2828-9a124cc2.js";import Ie from"./FinancialsTab-e07ef4f8-cb7c3ea0-71aba4e2-cf3d1041-f4dca4a9.js";import Le from"./AdminTab-1ef2bbd0-38fe81f3-dd6c0adf-0124de59-ea200bc2.js";import Me from"./ProfileTab-fd4f3500-9e2db3bd-31628205-5943de2a-0696709a.js";import{y as De}from"./credit-card-bcc8ac59-e0a7eb79-9e00e665-407b30eb-fd4bd701.js";import{t as Oe}from"./upload-8259cec2-21216fe4-eb25a68c-1da87379-90ddbf9a.js";import{c as Ge,o as ze}from"./settings-96af137d-f461a4db-8933cd88-d7585a9f-df6ebdcf.js";import{r as Re}from"./users-93d0d9a2-82ed9403-42cfbbc5-b53a716c-9b48157b.js";import"./Helmet-d9a99439-17d17245-80416325-0a82370e-5a6bde15.js";import"./log-out-1de3e3ee-53ee1d6f-be22ed5f-31659d2d-18bff071.js";import"./index-6c60542e-1f0cc56c-a6179bc2-c5eb0dfa-9596aa86.js";import"./triangle-alert-5ea4272b-316ec065-d63fb5c5-7c95de1a-02bb8d63.js";import"./package-99b0a55c-785e5cf1-bac652b0-c1d00408-aa7462ee.js";import"./trending-up-147c55bb-4628ab85-e3b835f1-1f811d81-76ad9897.js";import"./clock-0a32af33-121834d9-4cd0de5d-d758c7ab-1bf2afff.js";import"./truck-a0071c63-090d128d-9cfc595e-b33772c3-de5cb612.js";import"./map-pin-4396fd6c-98f8e615-be2face5-18973d83-0f5a17cb.js";import"./circle-alert-58769497-aeae36dd-aab7d564-c8980787-32b03cc8.js";import"./user-plus-74362f50-3e37ce73-40475d04-0b128926-0d3181b2.js";/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ae=[["path",{d:"M3 5v14",key:"1nt18q"}],["path",{d:"M8 5v14",key:"1ybrkv"}],["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"M17 5v14",key:"ycjyhj"}],["path",{d:"M21 5v14",key:"nzette"}]],Te=X("barcode",Ae),Fe=Z((s,n)=>({products:[],cart:[],isLoadingProducts:!1,isLoadingCheckout:!1,error:null,fetchProducts:async r=>{s({isLoadingProducts:!0});try{const i=await z.obtenerProductos(r);s({products:i||[]})}catch(i){s({error:i.message})}finally{s({isLoadingProducts:!1})}},addToCart:r=>{const i=n().cart,l=i.find(t=>t.id===r.id);return s(l?{cart:i.map(t=>t.id===r.id?{...t,qty:t.qty+1}:t)}:{cart:[...i,{...r,qty:1}]}),!0},removeFromCart:r=>s(i=>({cart:i.cart.filter(l=>l.id!==r)})),updateCartQty:(r,i)=>s(l=>({cart:l.cart.map(t=>t.id===r?{...t,qty:Math.max(1,t.qty+i)}:t)})),clearCart:()=>s({cart:[]}),processCheckout:async(r,i,l,t)=>{const m=n().cart;if(m.length===0)return;const p=typeof i=="object"?{...i,method:l,type:"POS"}:{name:i,method:l,type:"POS"};s({isLoadingCheckout:!0});try{const{data:b,error:h}=await D.from("orders").insert({store_id:r,customer_id:null,status:"Entregado",total:t,delivery_address:JSON.stringify({guest:p,items:m.map(c=>({id:c.id,name:c.name,qty:c.qty,price:c.price}))})}).select().single();if(h)throw h;const j=m.map(c=>({order_id:b.id,product_id:c.id,quantity:c.qty,price:c.price})),{error:x}=await D.from("order_items").insert(j);if(x)throw x;for(const c of m)c.stock!==void 0&&await z.actualizarProducto(c.id,{stock:Math.max(0,c.stock-c.qty)});return n().clearCart(),!0}catch(b){throw b}finally{s({isLoadingCheckout:!1})}}}));var L="Checkbox",[Ve,Ia]=J(L),[Be,Ke]=Ve(L),F=d.forwardRef((s,n)=>{const{__scopeCheckbox:r,name:i,checked:l,defaultChecked:t,required:m,disabled:p,value:b="on",onCheckedChange:h,form:j,...x}=s,[c,w]=d.useState(null),o=Q(n,u=>w(u)),f=d.useRef(!1),E=c?j||!!c.closest("form"):!0,[g=!1,S]=Y({prop:l,defaultProp:t,onChange:h}),I=d.useRef(g);return d.useEffect(()=>{const u=c==null?void 0:c.form;if(u){const v=()=>S(I.current);return u.addEventListener("reset",v),()=>u.removeEventListener("reset",v)}},[c,S]),e.jsxs(Be,{scope:r,state:g,disabled:p,children:[e.jsx(A.button,{type:"button",role:"checkbox","aria-checked":y(g)?"mixed":g,"aria-required":m,"data-state":K(g),"data-disabled":p?"":void 0,disabled:p,value:b,...x,ref:o,onKeyDown:O(s.onKeyDown,u=>{u.key==="Enter"&&u.preventDefault()}),onClick:O(s.onClick,u=>{S(v=>y(v)?!0:!v),E&&(f.current=u.isPropagationStopped(),f.current||u.stopPropagation())})}),E&&e.jsx(Ue,{control:c,bubbles:!f.current,name:i,value:b,checked:g,required:m,disabled:p,form:j,style:{transform:"translateX(-100%)"},defaultChecked:y(t)?!1:t})]})});F.displayName=L;var V="CheckboxIndicator",B=d.forwardRef((s,n)=>{const{__scopeCheckbox:r,forceMount:i,...l}=s,t=Ke(V,r);return e.jsx(W,{present:i||y(t.state)||t.state===!0,children:e.jsx(A.span,{"data-state":K(t.state),"data-disabled":t.disabled?"":void 0,...l,ref:n,style:{pointerEvents:"none",...s.style}})})});B.displayName=V;var Ue=s=>{const{control:n,checked:r,bubbles:i=!0,defaultChecked:l,...t}=s,m=d.useRef(null),p=ve(r),b=ke(n);d.useEffect(()=>{const j=m.current,x=window.HTMLInputElement.prototype,c=Object.getOwnPropertyDescriptor(x,"checked").set;if(p!==r&&c){const w=new Event("click",{bubbles:i});j.indeterminate=y(r),c.call(j,y(r)?!1:r),j.dispatchEvent(w)}},[p,r,i]);const h=d.useRef(y(r)?!1:r);return e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:l??h.current,...t,tabIndex:-1,ref:m,style:{...s.style,...b,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function y(s){return s==="indeterminate"}function K(s){return y(s)?"indeterminate":s?"checked":"unchecked"}var U=F,He=B;const Xe=d.forwardRef(({className:s,...n},r)=>e.jsx(U,{ref:r,className:G("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",s),...n,children:e.jsx(He,{className:G("flex items-center justify-center text-current"),children:e.jsx(Ne,{className:"h-4 w-4"})})}));Xe.displayName=U.displayName;const Ze=()=>{const{products:s,fetchProducts:n,addProduct:r,updateProduct:i,deleteProduct:l,store:t}=he(),[m,p]=d.useState(""),[b,h]=d.useState(!1),[j,x]=d.useState(!1),[c,w]=d.useState(null),[o,f]=d.useState({name:"",price:"",stock:"",description:"",category:"Abarrotes",sku:"",image_url:""});d.useEffect(()=>{t!=null&&t.id&&n(t.id)},[t==null?void 0:t.id,n]);const E=s.filter(a=>a.name.toLowerCase().includes(m.toLowerCase())||a.sku&&a.sku.includes(m)),g=["Abarrotes","Lácteos","Carnes","Frutas/Verduras","Limpieza","Bebidas","Cuidado Personal"],S=()=>{w(null),f({name:"",price:"",stock:"50",description:"",category:"Abarrotes",sku:"",image_url:""}),h(!0)},I=a=>{w(a),f({name:a.name,price:a.price,stock:a.stock,description:a.description||"",category:a.category||"Abarrotes",sku:a.sku||"",image_url:a.image_url||""}),h(!0)},u=async(a,k)=>{try{await i(a.id,{stock:parseInt(k)}),q({title:"Stock actualizado"})}catch{}},v=async a=>{a.preventDefault(),x(!0);try{const k={name:o.name,price:parseFloat(o.price),stock:parseInt(o.stock),sku:o.sku,description:o.sku?`${o.description}

SKU:${o.sku}`:o.description,category:o.category,store_id:t==null?void 0:t.id,product_type:"physical",requires_shipping:!0};c?(await i(c.id,k),q({title:"Producto actualizado"})):(await r(k),q({title:"Producto registrado"})),h(!1)}catch{q({title:"Error",variant:"destructive"})}finally{x(!1)}},H=async a=>{confirm("¿Eliminar producto?")&&await l(a)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-emerald-50 border border-emerald-100 p-6 rounded-t-xl flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-emerald-900 flex items-center gap-2",children:[e.jsx(T,{className:"h-8 w-8 text-emerald-600"}),"Inventario Máster"]}),e.jsx("p",{className:"text-emerald-700",children:"Gestión masiva de referencias, precios y existencias."})]}),e.jsxs(N,{className:"bg-emerald-700 hover:bg-emerald-800",onClick:S,children:[e.jsx(ie,{className:"h-4 w-4 mr-2"})," Nuevo Producto"]})]}),e.jsxs("div",{className:"flex gap-4 items-center bg-white p-2 border-b",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(_e,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(_,{placeholder:"Buscar por nombre, código de barras...",className:"pl-10",value:m,onChange:a=>p(a.target.value)})]}),e.jsxs(N,{variant:"outline",children:[e.jsx(Te,{className:"h-4 w-4 mr-2"})," Escanear"]})]}),e.jsx("div",{className:"bg-white border rounded-lg overflow-hidden shadow-sm",children:e.jsxs(Ce,{children:[e.jsx(Pe,{children:e.jsxs(R,{className:"bg-gray-50",children:[e.jsx(C,{className:"w-[100px]",children:"Código/SKU"}),e.jsx(C,{children:"Producto"}),e.jsx(C,{children:"Categoría"}),e.jsx(C,{className:"text-right",children:"Precio"}),e.jsx(C,{className:"text-center w-[150px]",children:"Stock"}),e.jsx(C,{className:"text-right",children:"Acciones"})]})}),e.jsx(Se,{children:E.map(a=>{var k,M;return e.jsxs(R,{children:[e.jsx(P,{className:"font-mono text-xs text-gray-500",children:a.sku||((M=(k=a.description)==null?void 0:k.match(/SKU:(\w+)/))==null?void 0:M[1])||"---"}),e.jsx(P,{className:"font-medium text-slate-800",children:a.name}),e.jsx(P,{children:e.jsx(we,{variant:"outline",className:"font-normal",children:a.category})}),e.jsxs(P,{className:"text-right font-bold text-emerald-700",children:["$",Number(a.price).toLocaleString()]}),e.jsx(P,{className:"text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(N,{variant:"ghost",className:"h-6 w-6 rounded-full p-0",onClick:()=>u(a,Math.max(0,a.stock-1)),children:"-"}),e.jsx("span",{className:"w-8 text-center",children:a.stock}),e.jsx(N,{variant:"ghost",className:"h-6 w-6 rounded-full p-0",onClick:()=>u(a,a.stock+1),children:"+"})]})}),e.jsxs(P,{className:"text-right",children:[e.jsx(N,{variant:"ghost",size:"sm",onClick:()=>I(a),children:e.jsx($e,{className:"h-4 w-4 text-blue-500"})}),e.jsx(N,{variant:"ghost",size:"sm",onClick:()=>H(a.id),children:e.jsx(oe,{className:"h-4 w-4 text-red-500"})})]})]},a.id)})})]})}),e.jsx(de,{open:b,onOpenChange:h,children:e.jsxs(ne,{children:[e.jsx(le,{children:e.jsx(me,{children:"Producto de Supermercado"})}),e.jsxs("form",{onSubmit:v,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2 col-span-2",children:[e.jsx($,{children:"Nombre Producto"}),e.jsx(_,{value:o.name,onChange:a=>f({...o,name:a.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx($,{children:"Código Barras / SKU"}),e.jsx(_,{value:o.sku,onChange:a=>f({...o,sku:a.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx($,{children:"Categoría"}),e.jsxs(be,{value:o.category,onValueChange:a=>f({...o,category:a}),children:[e.jsx(je,{children:e.jsx(xe,{})}),e.jsx(ge,{children:g.map(a=>e.jsx(ye,{value:a,children:a},a))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx($,{children:"Precio"}),e.jsx(_,{type:"number",value:o.price,onChange:a=>f({...o,price:a.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx($,{children:"Stock Inicial"}),e.jsx(_,{type:"number",value:o.stock,onChange:a=>f({...o,stock:a.target.value}),required:!0})]})]}),e.jsx(N,{type:"submit",className:"w-full bg-emerald-600 hover:bg-emerald-700",disabled:j,children:"Guardar"})]})]})})]})},Je=d.lazy(()=>ee(()=>ae(()=>se(()=>te(()=>re(()=>import("./GenericPOSView-65865e30-e48d2479-1f7364f9-da5c4b26-51e5425d.js"),["./GenericPOSView-65865e30-e48d2479-1f7364f9-da5c4b26-51e5425d.js","./index-87ab05f1.js","./index-dc19931e.css","./input-977568de-bea10295-4adb3258-368f21ef-dd0395aa.js","./badge-34bdff7c-b2c90fce-efd43af8-f7a84e83-2020d777.js","./scroll-area-d0c9b1aa-5d11dc0b-4a9e3f1e-c4827a88-a3cd7b48.js","./label-6ced007b-31f64b09-71156226-1e4e75c4-8af8544c.js","./useStoreDashboard-6cfa5bdd-a014cfe4-c8bff8db-4123484f-ad5d382b.js","./shopping-cart-8aca5ef3-095b1616-112594bf-3a6e2763-072beeee.js","./search-566f00ed-c3babbf0-ad60b5b7-3e645f27-67335d64.js","./circle-check-big-68527463-8ad93454-9bdb44d7-ad5a0975-66385ab6.js"],import.meta.url),["./GenericPOSView-65865e30-e48d2479-1f7364f9-da5c4b26.js","./index-bea51c07.js","./index-dc19931e.css","./input-977568de-bea10295-4adb3258-368f21ef.js","./badge-34bdff7c-b2c90fce-efd43af8-f7a84e83.js","./scroll-area-d0c9b1aa-5d11dc0b-4a9e3f1e-c4827a88.js","./label-6ced007b-31f64b09-71156226-1e4e75c4.js","./useStoreDashboard-6cfa5bdd-a014cfe4-c8bff8db-4123484f.js","./shopping-cart-8aca5ef3-095b1616-112594bf-3a6e2763.js","./search-566f00ed-c3babbf0-ad60b5b7-3e645f27.js","./circle-check-big-68527463-8ad93454-9bdb44d7-ad5a0975.js"],import.meta.url),["./GenericPOSView-65865e30-e48d2479-1f7364f9.js","./index-8e3c4911.js","./index-dc19931e.css","./input-977568de-bea10295-4adb3258.js","./badge-34bdff7c-b2c90fce-efd43af8.js","./scroll-area-d0c9b1aa-5d11dc0b-4a9e3f1e.js","./label-6ced007b-31f64b09-71156226.js","./useStoreDashboard-6cfa5bdd-a014cfe4-c8bff8db.js","./shopping-cart-8aca5ef3-095b1616-112594bf.js","./search-566f00ed-c3babbf0-ad60b5b7.js","./circle-check-big-68527463-8ad93454-9bdb44d7.js"],import.meta.url),["./GenericPOSView-65865e30-e48d2479.js","./index-4834c6e1.js","./index-dc19931e.css","./input-977568de-bea10295.js","./badge-34bdff7c-b2c90fce.js","./scroll-area-d0c9b1aa-5d11dc0b.js","./label-6ced007b-31f64b09.js","./useStoreDashboard-6cfa5bdd-a014cfe4.js","./shopping-cart-8aca5ef3-095b1616.js","./search-566f00ed-c3babbf0.js","./circle-check-big-68527463-8ad93454.js"],import.meta.url),["./GenericPOSView-65865e30.js","./index-3101bb07.js","./index-dc19931e.css","./input-977568de.js","./badge-34bdff7c.js","./scroll-area-d0c9b1aa.js","./label-6ced007b.js","./useStoreDashboard-6cfa5bdd.js","./shopping-cart-8aca5ef3.js","./search-566f00ed.js","./circle-check-big-68527463.js"],import.meta.url)),La=d.memo(({store:s})=>{const n=[{path:"",label:"Resumen",icon:ue,element:e.jsx(fe,{storeId:s.id})},{path:"caja",label:"Caja (POS)",icon:De,element:e.jsx(Je,{useStore:Fe,title:"Caja Registradora"})},{path:"inventario",label:"Inventario",icon:T,element:e.jsx(Ze,{})},{path:"pedidos",label:"Pedidos",icon:ce,element:e.jsx(Ee,{storeId:s.id})},{path:"importar",label:"Carga Masiva",icon:Oe,element:e.jsx(qe,{storeId:s.id,onProductsUploaded:()=>{}})},{path:"finanzas",label:"Finanzas",icon:Ge,element:e.jsx(Ie,{storeId:s.id})},{path:"equipo",label:"Cajeros",icon:Re,element:e.jsx(Le,{storeId:s.id})},{path:"configuracion",label:"Ajustes",icon:ze,element:e.jsx(Me,{})}];return e.jsx(pe,{store:s,tabs:n})});export{La as default};
