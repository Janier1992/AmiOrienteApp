import{S as $,u as Y,s as _,Z as w,t as S,y as e,w as N,b as p,d as A,f as F,h as V,x as j,p as G,F as ee,m as ae,X as se,q as I,i as P,H as L,J as M,M as te,K as R,_ as x}from"./index-4834c6e1.js";import{B as re,F as ie}from"./BulkUploadTab-0fe3efc4-824a62de.js";import{R as ne,_ as oe}from"./BaseStoreDashboard-9ad5c13e-d7a1a933.js";import{d as B}from"./badge-34bdff7c-b2c90fce.js";import{s as b}from"./useStoreDashboard-6cfa5bdd-a014cfe4.js";import{d as ce,S as le}from"./RestaurantMenuView-c52c06fd-fcac7cf3.js";import de from"./GenericPOSView-65865e30-e48d2479.js";import{l as g}from"./input-977568de-bea10295.js";import{u as h}from"./label-6ced007b-31f64b09.js";import{k as me,O as pe,V as xe,I as ue,M as D}from"./select-03f52418-c5111b6c.js";import{t as he}from"./textarea-03a75c76-69040bf5.js";import{L as je}from"./index-6c60542e-1f0cc56c.js";import{c as ge}from"./calendar-71354730-a3d22a8b.js";import{a as z}from"./history-a917c19b-2a23d0da.js";import{o as be}from"./save-155183cf-7e3b99a3.js";import{c as fe}from"./credit-card-bcc8ac59-e0a7eb79.js";import{a as ye}from"./utensils-crossed-8251ba29-3d1f84c7.js";import{t as ve}from"./upload-8259cec2-21216fe4.js";import{a as Ne,n as _e}from"./settings-96af137d-f461a4db.js";import{r as we}from"./users-93d0d9a2-82ed9403.js";import"./circle-alert-58769497-aeae36dd.js";import"./Helmet-d9a99439-17d17245.js";import"./log-out-1de3e3ee-53ee1d6f.js";import"./switch-4dcb0898-6baf1f34.js";import"./search-566f00ed-c3babbf0.js";import"./pencil-b145156d-81e39600.js";import"./scroll-area-d0c9b1aa-5d11dc0b.js";import"./shopping-cart-8aca5ef3-095b1616.js";import"./circle-check-big-68527463-8ad93454.js";import"./check-78166ef5-9630779a.js";import"./triangle-alert-5ea4272b-316ec065.js";import"./index-e23a302d-1b9287b5.js";/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Se=[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]],Ce=$("layout-grid",Se);/**
* @license lucide-react v0.561.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const Ee=[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.106-3.105c.32-.322.863-.22.983.218a6 6 0 0 1-8.259 7.057l-7.91 7.91a1 1 0 0 1-2.999-3l7.91-7.91a6 6 0 0 1 7.057-8.259c.438.12.54.662.219.984z",key:"1ngwbx"}]],q=$("wrench",Ee),C={async getTables(s){const{data:o,error:t}=await N.from("restaurant_tables").select("*").eq("store_id",s).order("number");if(t)throw t;return o},async createTable(s){const{data:o,error:t}=await N.from("restaurant_tables").insert(s).select().single();if(t)throw t;return o},async updateTableStatus(s,o){const{error:t}=await N.from("restaurant_tables").update({status:o}).eq("id",s);if(t)throw t},async createPOSTransaction({orderPayload:s,items:o}){const{data:t,error:r}=await N.from("orders").insert(s).select().single();if(r)throw r;const c=o.map(n=>({order_id:t.id,product_id:n.id,quantity:n.qty,price:n.price})),{error:i}=await N.from("order_items").insert(c);if(i)throw console.error("Error creating items",i),i;return t}},H=Y((s,o)=>({tables:[],products:[],cart:[],isLoadingTables:!1,isLoadingCheckout:!1,error:null,addToCart:t=>{const r=o().cart,c=r.find(i=>i.id===t.id);if(c){if(t.stock!==void 0&&c.qty>=t.stock)return!1;s({cart:r.map(i=>i.id===t.id?{...i,qty:i.qty+1}:i)})}else s({cart:[...r,{...t,qty:1}]});return!0},removeFromCart:t=>{s(r=>({cart:r.cart.filter(c=>c.id!==t)}))},updateCartQty:(t,r)=>{s(c=>({cart:c.cart.map(i=>{if(i.id===t){const n=Math.max(1,i.qty+r);return r>0&&i.stock!==void 0&&n>i.stock?i:{...i,qty:n}}return i})}))},clearCart:()=>s({cart:[]}),processCheckout:async(t,r,c,i)=>{const n=o().cart;if(n.length===0)return;const y=typeof r=="object"?{name:r.name,doc_id:r.docId,phone:r.phone,email:r.email,method:c,type:"POS"}:{name:r,method:c,type:"POS"};s({isLoadingCheckout:!0});try{const l={store_id:t,customer_id:null,status:"Entregado",total:i,delivery_address:JSON.stringify({guest:y,items:n.map(m=>({id:m.id,name:m.name,qty:m.qty,price:m.price}))})};return await C.createPOSTransaction({orderPayload:l,items:n}),o().clearCart(),!0}catch(l){throw l}finally{s({isLoadingCheckout:!1})}},fetchTables:async t=>{s({isLoadingTables:!0,error:null});try{const r=await C.getTables(t);s({tables:r})}catch(r){s({error:r.message})}finally{s({isLoadingTables:!1})}},addTable:async t=>{try{const r=await C.createTable(t);return s(c=>({tables:[...c.tables,r]})),r}catch(r){throw r}},toggleTableStatus:async(t,r)=>{const c=r==="available"?"occupied":"available",i=o().tables;s({tables:i.map(n=>n.id===t?{...n,status:c}:n)});try{await C.updateTableStatus(t,c)}catch(n){throw s({tables:i}),n}},fetchProducts:async t=>{try{const r=await b.getProducts(t);s({products:r})}catch(r){console.error("Error fetching products for POS:",r)}}})),qe=({storeId:s})=>{const{tables:o,fetchTables:t,addTable:r,toggleTableStatus:c,isLoadingTables:i,error:n}=H();p.useEffect(()=>{s&&t(s)},[s,t]);const y=async()=>{const l=prompt("Número de mesa:");if(l)try{await r({store_id:s,number:l,capacity:4}),x({title:"Mesa agregada"})}catch(m){x({title:"Error",description:m.message,variant:"destructive"})}};return i&&o.length===0?e.jsx("div",{className:"p-4",children:"Cargando mesas..."}):e.jsxs(A,{children:[e.jsxs(F,{className:"flex flex-row items-center justify-between",children:[e.jsx(V,{children:"Gestión de Mesas"}),e.jsx(j,{onClick:y,children:"+ Agregar Mesa"})]}),e.jsxs(G,{children:[n&&e.jsxs("p",{className:"text-red-500 mb-4",children:["Error: ",n]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4",children:[o.map(l=>e.jsxs("div",{className:`p-4 rounded-lg border-2 cursor-pointer transition-all ${l.status==="occupied"?"bg-red-50 border-red-200":"bg-green-50 border-green-200"}`,onClick:()=>c(l.id,l.status),children:[e.jsx("div",{className:"text-2xl font-bold text-center mb-2",children:l.number}),e.jsx(B,{variant:l.status==="occupied"?"destructive":"default",className:"w-full justify-center",children:l.status==="occupied"?"Ocupada":"Libre"})]},l.id)),o.length===0&&!i&&e.jsx("p",{className:"col-span-full text-center text-gray-500",children:"Agrega mesas para gestionarlas aquí."})]})]})]})},Te=({storeId:s})=>{const[o,t]=p.useState([]),[r,c]=p.useState(!0),[i,n]=p.useState(!1),[y,l]=p.useState(!1),[m,J]=p.useState(null),[T,k]=p.useState([]),[X,O]=p.useState(!1),[u,v]=p.useState({name:"",serial_number:"",purchase_date:"",status:"operational",next_maintenance_date:""}),[d,f]=p.useState({type:"preventive",description:"",cost:"",performed_by:"",date:new Date().toISOString().split("T")[0]}),E=async()=>{if(s){c(!0);try{const a=await b.getEquipment(s);t(a)}catch{x({title:"Error",description:"No se pudieron cargar los equipos.",variant:"destructive"})}finally{c(!1)}}};p.useEffect(()=>{E()},[s]);const K=async()=>{if(!u.name){x({title:"Error",description:"El nombre es requerido",variant:"destructive"});return}try{await b.addEquipment({...u,store_id:s}),x({title:"Éxito",description:"Equipo registrado correctamente."}),n(!1),v({name:"",serial_number:"",purchase_date:"",status:"operational",next_maintenance_date:""}),E()}catch{x({title:"Error",description:"No se pudo registrar el equipo.",variant:"destructive"})}},Q=async a=>{if(confirm("¿Estás seguro de eliminar este equipo? Se borrará su historial."))try{await b.deleteEquipment(a),x({title:"Eliminado",description:"Equipo eliminado del sistema."}),E()}catch{x({title:"Error",description:"No se pudo eliminar.",variant:"destructive"})}},U=async a=>{J(a),l(!0),O(!0);try{const Z=await b.getMaintenanceLogs(a.id);k(Z)}catch{x({title:"Error",description:"No se pudo cargar la bitácora."})}finally{O(!1)}},W=async()=>{if(d.description)try{await b.addMaintenanceLog({...d,equipment_id:m.id}),x({title:"Registrado",description:"Mantenimiento registrado."});const a=await b.getMaintenanceLogs(m.id);k(a),f({type:"preventive",description:"",cost:"",performed_by:"",date:new Date().toISOString().split("T")[0]})}catch{x({title:"Error",description:"Fallo al registrar mantenimiento.",variant:"destructive"})}};return r?e.jsx(je,{text:"Cargando inventario..."}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-orange-50 border border-orange-100 p-6 rounded-2xl flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-extrabold text-orange-900 flex items-center gap-3",children:[e.jsx(q,{className:"h-8 w-8 text-orange-600"}),"Mantenimiento de Equipos"]}),e.jsx("p",{className:"text-orange-800 mt-2",children:"Gestiona el estado y cronograma de mantenimiento de tu maquinaria."})]}),e.jsxs(j,{className:"bg-orange-600 hover:bg-orange-700",onClick:()=>n(!0),children:[e.jsx(ee,{className:"h-4 w-4 mr-2"})," Registrar Equipo"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[o.length===0&&e.jsxs("div",{className:"col-span-full text-center py-12 text-gray-500",children:[e.jsx(q,{className:"h-12 w-12 mx-auto mb-4 opacity-20"}),e.jsx("p",{children:"No hay equipos registrados aún."})]}),o.map(a=>e.jsxs(A,{className:`border-l-4 shadow-sm hover:shadow-md transition-shadow ${a.status==="maintenance_needed"||a.status==="in_repair"?"border-l-red-500":"border-l-green-500"}`,children:[e.jsxs(F,{className:"pb-2",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx(V,{className:"text-lg font-bold text-gray-800 truncate",title:a.name,children:a.name}),e.jsx(B,{variant:a.status==="operational"?"default":"destructive",className:a.status==="operational"?"bg-green-100 text-green-800 hover:bg-green-100":"",children:a.status==="operational"?"Operativo":a.status==="maintenance_needed"?"Mantenimiento Req.":a.status==="in_repair"?"En Reparación":"Retirado"})]}),e.jsx("p",{className:"text-xs text-gray-500 truncate",children:a.serial_number?`S/N: ${a.serial_number}`:"Sin N/S"})]}),e.jsx(G,{children:e.jsx("div",{className:"space-y-3 text-sm",children:e.jsxs("div",{className:`flex items-center font-medium ${a.next_maintenance_date&&new Date(a.next_maintenance_date)<new Date?"text-red-600":"text-blue-600"}`,children:[e.jsx(ge,{className:"h-4 w-4 mr-2"}),e.jsxs("span",{children:["Próximo: ",a.next_maintenance_date||"No programado"]})]})})}),e.jsxs(ae,{className:"pt-2 flex gap-2 border-t",children:[e.jsxs(j,{variant:"outline",size:"sm",className:"flex-1 text-xs",onClick:()=>U(a),children:[e.jsx(z,{className:"h-3 w-3 mr-1"})," Bitácora"]}),e.jsx(j,{variant:"ghost",size:"sm",className:"text-red-500 hover:text-red-700 hover:bg-red-50 p-2",onClick:()=>Q(a.id),children:e.jsx(se,{className:"h-4 w-4"})})]})]},a.id))]}),e.jsx(I,{open:i,onOpenChange:n,children:e.jsxs(P,{children:[e.jsxs(L,{children:[e.jsx(M,{children:"Registrar Nuevo Equipo"}),e.jsx(te,{children:"Ingresa los datos técnicos del equipo."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Nombre del Equipo"}),e.jsx(g,{value:u.name,onChange:a=>v({...u,name:a.target.value}),placeholder:"Ej. Horno Industrial"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Número de Serie"}),e.jsx(g,{value:u.serial_number,onChange:a=>v({...u,serial_number:a.target.value}),placeholder:"Opcional"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Fecha Compra"}),e.jsx(g,{type:"date",value:u.purchase_date,onChange:a=>v({...u,purchase_date:a.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Prox. Mantenimiento"}),e.jsx(g,{type:"date",value:u.next_maintenance_date,onChange:a=>v({...u,next_maintenance_date:a.target.value})})]})]})]}),e.jsxs(R,{children:[e.jsx(j,{variant:"outline",onClick:()=>n(!1),children:"Cancelar"}),e.jsx(j,{onClick:K,children:"Guardar Equipo"})]})]})}),e.jsx(I,{open:y,onOpenChange:l,children:e.jsxs(P,{className:"max-w-2xl",children:[e.jsx(L,{children:e.jsxs(M,{children:["Bitácora: ",m==null?void 0:m.name]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 h-[400px]",children:[e.jsxs("div",{className:"border rounded-lg p-4 overflow-y-auto space-y-3 bg-slate-50",children:[e.jsxs("h4",{className:"font-semibold text-sm mb-2 flex items-center",children:[e.jsx(z,{className:"h-4 w-4 mr-2"})," Historial"]}),X?e.jsx("p",{className:"text-xs text-gray-500",children:"Cargando..."}):T.length===0?e.jsx("p",{className:"text-xs text-gray-400 italic",children:"Sin registros."}):T.map(a=>e.jsxs("div",{className:"bg-white p-3 rounded border text-sm shadow-sm",children:[e.jsxs("div",{className:"flex justify-between font-semibold text-xs text-gray-500 mb-1",children:[e.jsx("span",{children:a.date}),e.jsx("span",{className:a.type==="corrective"?"text-red-500":"text-blue-500 uppercase",children:a.type})]}),e.jsx("p",{className:"text-gray-800",children:a.description}),(a.cost>0||a.performed_by)&&e.jsxs("div",{className:"mt-2 text-xs text-gray-500 flex gap-4 pt-1 border-t border-gray-100",children:[a.cost>0&&e.jsxs("span",{children:["Coste: $",Number(a.cost).toLocaleString()]}),a.performed_by&&e.jsxs("span",{children:["Por: ",a.performed_by]})]})]},a.id))]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h4",{className:"font-semibold text-sm mb-2 flex items-center",children:[e.jsx(ie,{className:"h-4 w-4 mr-2"})," Nuevo Registro"]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border space-y-3",children:[e.jsxs("div",{children:[e.jsx(h,{className:"text-xs",children:"Tipo"}),e.jsxs(me,{value:d.type,onValueChange:a=>f({...d,type:a}),children:[e.jsx(pe,{children:e.jsx(xe,{})}),e.jsxs(ue,{children:[e.jsx(D,{value:"preventive",children:"Preventivo"}),e.jsx(D,{value:"corrective",children:"Correctivo (Reparación)"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx(h,{className:"text-xs",children:"Fecha"}),e.jsx(g,{type:"date",className:"h-8",value:d.date,onChange:a=>f({...d,date:a.target.value})})]}),e.jsxs("div",{children:[e.jsx(h,{className:"text-xs",children:"Costo"}),e.jsx(g,{type:"number",className:"h-8",placeholder:"0",value:d.cost,onChange:a=>f({...d,cost:a.target.value})})]})]}),e.jsxs("div",{children:[e.jsx(h,{className:"text-xs",children:"Realizado por"}),e.jsx(g,{className:"h-8",placeholder:"Técnico / Empresa",value:d.performed_by,onChange:a=>f({...d,performed_by:a.target.value})})]}),e.jsxs("div",{children:[e.jsx(h,{className:"text-xs",children:"Descripción"}),e.jsx(he,{className:"h-20 text-xs",placeholder:"Detalle del trabajo realizado...",value:d.description,onChange:a=>f({...d,description:a.target.value})})]}),e.jsxs(j,{className:"w-full",size:"sm",onClick:W,children:[e.jsx(be,{className:"h-3 w-3 mr-2"})," Guardar Registro"]})]})]})]}),e.jsx(R,{children:e.jsx(j,{variant:"outline",onClick:()=>l(!1),children:"Cerrar"})})]})})]})},ke=_.lazy(()=>w(()=>S(()=>import("./OverviewTab-a01a807a-07dd1735.js"),["./OverviewTab-a01a807a-07dd1735.js","./index-4834c6e1.js","./index-dc19931e.css","./useStoreDashboard-6cfa5bdd-a014cfe4.js","./index-6c60542e-1f0cc56c.js","./triangle-alert-5ea4272b-316ec065.js","./settings-96af137d-f461a4db.js","./package-99b0a55c-785e5cf1.js","./trending-up-147c55bb-4628ab85.js"],import.meta.url),["./OverviewTab-a01a807a.js","./index-3101bb07.js","./index-dc19931e.css","./useStoreDashboard-6cfa5bdd.js","./index-6c60542e.js","./triangle-alert-5ea4272b.js","./settings-96af137d.js","./package-99b0a55c.js","./trending-up-147c55bb.js"],import.meta.url)),Oe=_.lazy(()=>w(()=>S(()=>import("./OrdersManagementTab-74307886-48065a75.js"),["./OrdersManagementTab-74307886-48065a75.js","./index-4834c6e1.js","./index-dc19931e.css","./badge-34bdff7c-b2c90fce.js","./select-03f52418-c5111b6c.js","./check-78166ef5-9630779a.js","./useStoreDashboard-6cfa5bdd-a014cfe4.js","./index-6c60542e-1f0cc56c.js","./triangle-alert-5ea4272b-316ec065.js","./package-99b0a55c-785e5cf1.js","./clock-0a32af33-121834d9.js","./truck-a0071c63-090d128d.js","./pencil-b145156d-81e39600.js","./map-pin-4396fd6c-98f8e615.js"],import.meta.url),["./OrdersManagementTab-74307886.js","./index-3101bb07.js","./index-dc19931e.css","./badge-34bdff7c.js","./select-03f52418.js","./check-78166ef5.js","./useStoreDashboard-6cfa5bdd.js","./index-6c60542e.js","./triangle-alert-5ea4272b.js","./package-99b0a55c.js","./clock-0a32af33.js","./truck-a0071c63.js","./pencil-b145156d.js","./map-pin-4396fd6c.js"],import.meta.url)),Ie=_.lazy(()=>w(()=>S(()=>import("./ProfileTab-fd4f3500-9e2db3bd.js"),["./ProfileTab-fd4f3500-9e2db3bd.js","./index-4834c6e1.js","./index-dc19931e.css","./input-977568de-bea10295.js","./label-6ced007b-31f64b09.js","./useStoreDashboard-6cfa5bdd-a014cfe4.js"],import.meta.url),["./ProfileTab-fd4f3500.js","./index-3101bb07.js","./index-dc19931e.css","./input-977568de.js","./label-6ced007b.js","./useStoreDashboard-6cfa5bdd.js"],import.meta.url)),Pe=_.lazy(()=>w(()=>S(()=>import("./AdminTab-1ef2bbd0-38fe81f3.js"),["./AdminTab-1ef2bbd0-38fe81f3.js","./index-4834c6e1.js","./index-dc19931e.css","./user-plus-74362f50-3e37ce73.js","./users-93d0d9a2-82ed9403.js"],import.meta.url),["./AdminTab-1ef2bbd0.js","./index-3101bb07.js","./index-dc19931e.css","./user-plus-74362f50.js","./users-93d0d9a2.js"],import.meta.url)),Le=_.lazy(()=>w(()=>S(()=>import("./FinancialsTab-e07ef4f8-cb7c3ea0.js"),["./FinancialsTab-e07ef4f8-cb7c3ea0.js","./index-4834c6e1.js","./index-dc19931e.css","./useStoreDashboard-6cfa5bdd-a014cfe4.js","./index-6c60542e-1f0cc56c.js","./triangle-alert-5ea4272b-316ec065.js","./settings-96af137d-f461a4db.js","./trending-up-147c55bb-4628ab85.js","./credit-card-bcc8ac59-e0a7eb79.js","./circle-alert-58769497-aeae36dd.js"],import.meta.url),["./FinancialsTab-e07ef4f8.js","./index-3101bb07.js","./index-dc19931e.css","./useStoreDashboard-6cfa5bdd.js","./index-6c60542e.js","./triangle-alert-5ea4272b.js","./settings-96af137d.js","./trending-up-147c55bb.js","./credit-card-bcc8ac59.js","./circle-alert-58769497.js"],import.meta.url)),xa=({store:s})=>{const o=[{path:"",label:"Resumen",icon:ne,element:e.jsx(ke,{storeId:s.id})},{path:"caja",label:"Caja",icon:fe,element:e.jsx(de,{useStore:H,title:"Restaurante - Caja"})},{path:"pedidos",label:"Cocina y Pedidos",icon:ce,element:e.jsx(Oe,{storeId:s.id})},{path:"menu",label:"Menú Digital",icon:ye,element:e.jsx(le,{})},{path:"mesas",label:"Mesas",icon:Ce,element:e.jsx(qe,{storeId:s.id})},{path:"mantenimiento",label:"Mantenimiento",icon:q,element:e.jsx(Te,{storeId:s.id})},{path:"importar",label:"Importar",icon:ve,element:e.jsx(re,{storeId:s.id})},{path:"finanzas",label:"Finanzas",icon:Ne,element:e.jsx(Le,{storeId:s.id})},{path:"equipo",label:"Equipo",icon:we,element:e.jsx(Pe,{storeId:s.id})},{path:"configuracion",label:"Configuración",icon:_e,element:e.jsx(Ie,{})}];return e.jsx(oe,{store:s,tabs:o})};export{xa as default};
