import{E as ee,y as e,Z as se,d as v,f as x,w as N,K as D,o as ae,p as re,I as te,S as ie,H as O,V as le,m as ne,a as ce,h as k}from"./index-bea51c07.js";import{P as oe,_ as de}from"./BaseStoreDashboard-9ad5c13e-d7a1a933-4e4e637d-e46edf80.js";import me from"./OverviewTab-a01a807a-07dd1735-5ada0bfc-c4caa4a6.js";import{a as w}from"./input-977568de-bea10295-4adb3258-368f21ef.js";import{I as V,T as I,H as A,_ as L,k as g}from"./select-03f52418-c5111b6c-af5e7482-637f31c9.js";import{u as p}from"./label-6ced007b-31f64b09-71156226-1e4e75c4.js";import{l as xe}from"./textarea-03a75c76-69040bf5-35a9782e-8e0ca7dd.js";import{d as pe}from"./badge-34bdff7c-b2c90fce-efd43af8-f7a84e83.js";import{u as he}from"./useStoreDashboard-6cfa5bdd-a014cfe4-c8bff8db-4123484f.js";import{o as ue}from"./search-566f00ed-c3babbf0-ad60b5b7-3e645f27.js";import{o as R}from"./shirt-3c4181b9-6f1496dd-9b94e2f9-dafe5f0d.js";import{o as ge}from"./pencil-b145156d-81e39600-5a684db5-7834b695.js";import fe from"./OrdersManagementTab-74307886-48065a75-18a01665-f134e541.js";import je from"./FinancialsTab-e07ef4f8-cb7c3ea0-71aba4e2-cf3d1041.js";import{I as ve,z as Ne}from"./StoreCustomersTab-ce620322-3ebc43ae-d65f30bd-3e3d1ad2.js";import{r as ye}from"./users-93d0d9a2-82ed9403-42cfbbc5-b53a716c.js";import{t as be,o as we}from"./settings-96af137d-f461a4db-8933cd88-d7585a9f.js";import"./Helmet-d9a99439-17d17245-80416325-0a82370e.js";import"./log-out-1de3e3ee-53ee1d6f-be22ed5f-31659d2d.js";import"./index-6c60542e-1f0cc56c-a6179bc2-c5eb0dfa.js";import"./triangle-alert-5ea4272b-316ec065-d63fb5c5-7c95de1a.js";import"./package-99b0a55c-785e5cf1-bac652b0-c1d00408.js";import"./trending-up-147c55bb-4628ab85-e3b835f1-1f811d81.js";import"./check-78166ef5-9630779a-ee565adf-12fad7f6.js";import"./clock-0a32af33-121834d9-4cd0de5d-d758c7ab.js";import"./truck-a0071c63-090d128d-9cfc595e-b33772c3.js";import"./map-pin-4396fd6c-98f8e615-be2face5-18973d83.js";import"./credit-card-bcc8ac59-e0a7eb79-9e00e665-407b30eb.js";import"./circle-alert-58769497-aeae36dd-aab7d564-c8980787.js";const T={_parseVariants(a){var l;if(!a)return a;let n=[];const t=(l=a.description)==null?void 0:l.match(/VARIANTS_JSON:\s*(\[.*\])/s);let c=a.description||"";if(t)try{n=JSON.parse(t[1]),c=a.description.replace(/\n\nVARIANTS_JSON:\s*\[.*\]/s,"")}catch(r){console.error("Error parsing variants",r)}return{...a,variants:n,description:c,full_description:a.description}},async getClothingProducts(a){const{data:l,error:n}=await v.from("products").select("*").eq("store_id",a).order("created_at",{ascending:!1});if(n)throw n;return l.map(this._parseVariants)},async saveClothingProduct(a){const{variants:l,description:n,...t}=a;let c=n||"";if(l&&l.length>0){const d=JSON.stringify(l);c=`${n||""}

VARIANTS_JSON: ${d}`}let r=t.stock;l&&l.length>0&&(r=l.reduce((d,m)=>d+(Number(m.qty)||0),0));const u={...t,description:c,stock:r,product_type:"physical",requires_shipping:!0};if(u.id){const{data:d,error:m}=await v.from("products").update(u).eq("id",u.id).select().single();if(m)throw m;return this._parseVariants(d)}else{const{data:d,error:m}=await v.from("products").insert(u).select().single();if(m)throw m;return this._parseVariants(d)}},async deleteClothingProduct(a){const{error:l}=await v.from("products").delete().eq("id",a);if(l)throw l}},Ce=ee((a,l)=>({products:[],isLoading:!1,error:null,fetchProducts:async n=>{a({isLoading:!0,error:null});try{const t=await T.getClothingProducts(n);a({products:t})}catch(t){a({error:t.message})}finally{a({isLoading:!1})}},saveProduct:async n=>{try{const t=await T.saveClothingProduct(n);return a(c=>c.products.find(r=>r.id===t.id)?{products:c.products.map(r=>r.id===t.id?t:r)}:{products:[t,...c.products]}),t}catch(t){throw t}},deleteProduct:async n=>{try{await T.deleteClothingProduct(n),a(t=>({products:t.products.filter(c=>c.id!==n)}))}catch(t){throw t}}})),_e=({product:a,onEdit:l,onDelete:n})=>{const t=a.variants||[],c=[...new Set(t.map(r=>r.size))].sort();return e.jsxs(ne,{className:"rounded-none overflow-hidden border-0 shadow-sm hover:shadow-xl transition-all group bg-white h-full flex flex-col",children:[e.jsxs("div",{className:"relative aspect-[3/4] bg-gray-100 overflow-hidden",children:[a.image_url?e.jsx("img",{src:a.image_url,alt:a.name,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-gray-300",children:[e.jsx(R,{className:"h-16 w-16 mb-2"}),e.jsx("span",{className:"text-xs",children:"Sin imagen"})]}),e.jsx("div",{className:"absolute top-2 left-2 flex flex-col gap-1",children:a.discount>0&&e.jsxs(pe,{className:"bg-red-500 hover:bg-red-600 text-white border-0 text-xs",children:["-",a.discount,"% OFF"]})}),e.jsxs("div",{className:"absolute bottom-4 right-4 flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity translate-y-2 group-hover:translate-y-0 duration-300",children:[e.jsx(N,{variant:"secondary",size:"icon",className:"h-9 w-9 rounded-full shadow-lg bg-white hover:bg-gray-50 text-black",onClick:r=>{r.stopPropagation(),l(a)},children:e.jsx(ge,{className:"h-4 w-4"})}),e.jsx(N,{variant:"destructive",size:"icon",className:"h-9 w-9 rounded-full shadow-lg",onClick:r=>{r.stopPropagation(),n(a.id)},children:e.jsx(O,{className:"h-4 w-4"})})]})]}),e.jsxs(ce,{className:"p-4 flex-1 flex flex-col",children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-widest mb-1",children:a.category||"Colección General"}),e.jsx("h3",{className:"font-serif text-lg text-slate-900 leading-tight mb-2 truncate",children:a.name}),e.jsx("div",{className:"flex flex-wrap gap-1 mb-3 min-h-[1.5rem]",children:c.length>0?c.map(r=>e.jsx("span",{className:"text-[10px] border border-gray-200 px-1.5 py-0.5 rounded text-gray-600",children:r},r)):e.jsx("span",{className:"text-[10px] text-gray-400 italic",children:"Talla única"})}),e.jsxs("div",{className:"mt-auto flex justify-between items-end border-t pt-3",children:[e.jsx("div",{className:"flex flex-col",children:e.jsxs("span",{className:"text-sm font-medium text-slate-900",children:["$",Number(a.price).toLocaleString()]})}),e.jsxs("span",{className:"text-xs text-gray-400",children:["Total: ",a.stock," un."]})]})]})]})},Pe=["XS","S","M","L","XL","XXL","Única"],Se=[{name:"Negro",hex:"#000000"},{name:"Blanco",hex:"#FFFFFF"},{name:"Rojo",hex:"#EF4444"},{name:"Azul",hex:"#3B82F6"},{name:"Verde",hex:"#22C55E"},{name:"Amarillo",hex:"#EAB308"},{name:"Rosa",hex:"#EC4899"},{name:"Gris",hex:"#6B7280"},{name:"Beige",hex:"#F5F5DC"}],ke=()=>{const{products:a,fetchProducts:l,saveProduct:n,deleteProduct:t,isLoading:c}=Ce(),{store:r}=he(),[u,d]=x.useState(""),[m,C]=x.useState(!1),[G,B]=x.useState(!1),[_,$]=x.useState(null),[f,P]=x.useState([]),[y,S]=x.useState({size:"M",color:"Negro",qty:1}),[o,b]=x.useState({name:"",price:"",description:"",category:"General",image_url:""}),[z,E]=x.useState(null);x.useEffect(()=>{r!=null&&r.id&&l(r.id)},[r==null?void 0:r.id,l]);const H=a.filter(s=>s.name.toLowerCase().includes(u.toLowerCase())),J=()=>{P([...f,{...y,id:Date.now()}]),S({...y,qty:1})},M=s=>{P(f.filter(i=>i.id!==s))},X=()=>{$(null),b({name:"",price:"",description:"",category:"General",image_url:""}),P([]),E(null),C(!0)},Z=s=>{$(s);let i=s.variants||[];i=i.map(h=>({...h,id:h.id||Math.random()})),b({name:s.name,price:s.price,description:s.description||"",category:s.category||"General",image_url:s.image_url||""}),P(i),E(null),C(!0)},F=s=>{const{name:i,value:h}=s.target;b(j=>({...j,[i]:h}))},K=s=>{s.target.files&&s.target.files[0]&&E(s.target.files[0])},U=async(s,i,h)=>{const{error:j,data:q}=await v.storage.from(i).upload(h,s);if(j)throw new Error(`Error upload: ${j.message}`);const{data:Y}=v.storage.from(i).getPublicUrl(q.path);return Y.publicUrl},Q=async s=>{s.preventDefault(),B(!0);try{let i=o.image_url;if(z&&r!=null&&r.id){const j=z.name.replace(/[^a-zA-Z0-9.]/g,"_"),q=`${r.id}/${Date.now()}_fashion_${j}`;i=await U(z,"product-images",q)}const h={id:_?_.id:void 0,name:o.name,price:parseFloat(o.price),stock:0,variants:f,image_url:i,description:o.description,category:o.category,store_id:r==null?void 0:r.id};await n(h),k({title:_?"Prenda actualizada":"Prenda añadida",description:"Inventario sincronizado."}),C(!1),$(null),b({name:"",price:"",description:"",category:"General",image_url:""})}catch(i){console.error(i),k({title:"Error",description:"Fallo al guardar.",variant:"destructive"})}finally{B(!1)}},W=async s=>{if(window.confirm("¿Retirar prenda del catálogo?"))try{await t(s),k({title:"Prenda eliminada"})}catch{k({title:"Error",variant:"destructive"})}};return e.jsxs("div",{className:"space-y-8 font-sans",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-end md:items-center gap-4 border-b border-slate-100 pb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-serif text-slate-900 mb-2",children:"Colección & Stock"}),e.jsx("p",{className:"text-slate-500 font-light",children:"Gestiona tallas, colores y disponiblidad de tus prendas."})]}),e.jsxs(N,{className:"bg-slate-900 text-white hover:bg-slate-800 rounded-none px-8 py-6 uppercase tracking-wider text-xs",onClick:X,children:[e.jsx(D,{className:"h-4 w-4 mr-2"})," Nueva Prenda"]})]}),e.jsx("div",{className:"flex gap-4 items-center bg-white p-1",children:e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(ue,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-300"}),e.jsx(w,{placeholder:"Buscar referencia...",className:"pl-10 border-slate-200 rounded-none focus-visible:ring-0 focus-visible:border-slate-400",value:u,onChange:s=>d(s.target.value)})]})}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-x-8 gap-y-12",children:H.map(s=>e.jsx(_e,{product:{...s,discount:0},onEdit:Z,onDelete:W},s.id))}),e.jsx(ae,{open:m,onOpenChange:C,children:e.jsxs(re,{className:"sm:max-w-[700px] max-h-[90vh] overflow-y-auto",children:[e.jsx(te,{children:e.jsx(ie,{className:"font-serif text-2xl",children:_?"Editar Prenda":"Nueva Prenda"})}),e.jsxs("form",{onSubmit:Q,className:"space-y-6 py-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Nombre / Referencia"}),e.jsx(w,{name:"name",value:o.name,onChange:F,placeholder:"Ej: Camisa Lino Blanca",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Precio"}),e.jsx(w,{name:"price",type:"number",value:o.price,onChange:F,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Categoría / Colección"}),e.jsxs(V,{name:"category",value:o.category,onValueChange:s=>b(i=>({...i,category:s})),children:[e.jsx(I,{children:e.jsx(A,{})}),e.jsxs(L,{children:[e.jsx(g,{value:"General",children:"General"}),e.jsx(g,{value:"Hombre",children:"Hombre"}),e.jsx(g,{value:"Mujer",children:"Mujer"}),e.jsx(g,{value:"Niños",children:"Niños"}),e.jsx(g,{value:"Accesorios",children:"Accesorios"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Imagen"}),e.jsx(w,{type:"file",accept:"image/*",onChange:K}),o.image_url&&e.jsx("img",{src:o.image_url,alt:"Preview",className:"h-20 w-auto object-contain border mt-2"})]})]}),e.jsxs("div",{className:"bg-slate-50 p-4 rounded-lg space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(p,{className:"font-bold",children:"Variantes de Stock"}),e.jsxs("span",{className:"text-xs text-slate-500",children:["Total: ",f.reduce((s,i)=>s+Number(i.qty),0)," un."]})]}),e.jsxs("div",{className:"flex gap-2 items-end",children:[e.jsxs("div",{className:"w-20",children:[e.jsx(p,{className:"text-xs",children:"Talla"}),e.jsxs(V,{value:y.size,onValueChange:s=>S(i=>({...i,size:s})),children:[e.jsx(I,{className:"h-8 text-xs",children:e.jsx(A,{})}),e.jsx(L,{children:Pe.map(s=>e.jsx(g,{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx(p,{className:"text-xs",children:"Color"}),e.jsxs(V,{value:y.color,onValueChange:s=>S(i=>({...i,color:s})),children:[e.jsx(I,{className:"h-8 text-xs",children:e.jsx(A,{})}),e.jsx(L,{children:Se.map(s=>e.jsx(g,{value:s.name,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full border",style:{backgroundColor:s.hex}}),s.name]})},s.name))})]})]}),e.jsxs("div",{className:"w-20",children:[e.jsx(p,{className:"text-xs",children:"Cant."}),e.jsx(w,{type:"number",className:"h-8 text-xs",value:y.qty,onChange:s=>S(i=>({...i,qty:s.target.value}))})]}),e.jsx(N,{type:"button",size:"sm",onClick:J,className:"h-8 bg-black text-white",children:e.jsx(D,{className:"h-3 w-3"})})]}),e.jsxs("div",{className:"space-y-1 max-h-[200px] overflow-y-auto",children:[f.map(s=>e.jsxs("div",{className:"flex justify-between items-center text-sm bg-white p-2 rounded border",children:[e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("span",{className:"font-bold w-6",children:s.size}),e.jsx("span",{className:"text-slate-500",children:s.color})]}),e.jsxs("div",{className:"flex gap-3 items-center",children:[e.jsx("span",{className:"font-mono bg-slate-100 px-1",children:s.qty}),e.jsx(N,{variant:"ghost",size:"icon",className:"h-5 w-5 hover:text-red-500",onClick:()=>M(s.id),children:e.jsx(O,{className:"h-3 w-3"})})]})]},s.id)),f.length===0&&e.jsx("p",{className:"text-xs text-gray-400 text-center py-2",children:"Sin variantes definidas"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Descripción Pública"}),e.jsx(xe,{name:"description",value:o.description,onChange:F,placeholder:"Detalles de la tela, cuidados, etc."})]}),e.jsx(N,{type:"submit",className:"w-full bg-slate-900 text-white rounded-none py-6 uppercase tracking-widest font-bold hover:bg-slate-800",disabled:G,children:G?e.jsx(le,{className:"animate-spin"}):"Guardar Prenda"})]})]})})]})},ts=({store:a})=>{const l=[{path:"",label:"Resumen",icon:oe,element:e.jsx(me,{storeId:a.id})},{path:"coleccion",label:"Colección",icon:R,element:e.jsx(ke,{})},{path:"pedidos",label:"Pedidos",icon:se,element:e.jsx(fe,{storeId:a.id})},{path:"clientes",label:"Clientes",icon:ye,element:e.jsx(ve,{})},{path:"finanzas",label:"Finanzas",icon:be,element:e.jsx(je,{storeId:a.id})},{path:"configuracion",label:"Configuración",icon:we,element:e.jsx(Ne,{})}];return e.jsx(de,{store:a,tabs:l})};export{ts as default};
