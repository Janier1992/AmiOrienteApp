import{d as v,y as e,h as S,f as A,p as D,m as z,c as E,b as r,A as O,Y as k,l as T,G as I,N as W,Q as q,E as p}from"./index-8e3c4911.js";import{d as j}from"./badge-34bdff7c-b2c90fce-efd43af8.js";import{H as V,T as F,$ as G,D as H,_ as m}from"./select-03f52418-c5111b6c-af5e7482.js";import{u as J}from"./useStoreDashboard-6cfa5bdd-a014cfe4-c8bff8db.js";import{L as Y}from"./index-6c60542e-1f0cc56c-a6179bc2.js";import{p as M}from"./package-99b0a55c-785e5cf1-bac652b0.js";import{l as Q}from"./clock-0a32af33-121834d9-4cd0de5d.js";import{a as R}from"./truck-a0071c63-090d128d-9cfc595e.js";import{p as B}from"./pencil-b145156d-81e39600-5a684db5.js";import{e as K}from"./map-pin-4396fd6c-98f8e615-be2face5.js";import"./check-78166ef5-9630779a-ee565adf.js";import"./triangle-alert-5ea4272b-316ec065-d63fb5c5.js";const ce=({storeId:u})=>{var N;const{orders:g,fetchOrders:f,updateOrderStatus:C,isLoadingOrders:b,deleteOrder:_}=J(),[a,y]=v.useState(null),[P,x]=v.useState(!1),$=async s=>{if(window.confirm("¿Estás seguro de que deseas eliminar este pedido? Esta acción no se puede deshacer."))try{await _(s),p({title:"Pedido eliminado"}),(a==null?void 0:a.id)===s&&x(!1)}catch{p({title:"Error al eliminar",variant:"destructive"})}};v.useEffect(()=>{u&&f(u)},[u,f]);const h=async(s,t)=>{try{await C(s,t),p({title:"Estado Actualizado",description:`El pedido ahora está: ${t}`}),(a==null?void 0:a.id)===s&&y({...a,status:t})}catch{p({title:"Error",description:"No se pudo actualizar el estado.",variant:"destructive"})}},w=s=>{y(s),x(!0)},L=s=>{const t={Pendiente:"bg-yellow-100 text-yellow-800",Confirmado:"bg-blue-100 text-blue-800","En preparación":"bg-purple-100 text-purple-800","Listo para recogida":"bg-indigo-100 text-indigo-800","En curso":"bg-cyan-100 text-cyan-800",Entregado:"bg-green-100 text-green-800",Cancelado:"bg-red-100 text-red-800"};return e.jsx(j,{variant:"outline",className:`${t[s]||"bg-gray-100"} px-2 py-1`,children:s})};return b&&g.length===0?e.jsx(Y,{text:"Cargando pedidos..."}):e.jsxs(S,{className:"animate-in fade-in duration-300",children:[e.jsxs(A,{className:"flex flex-row items-center justify-between",children:[e.jsx(D,{children:"Gestión de Pedidos"}),b&&e.jsx(j,{variant:"secondary",className:"animate-pulse",children:"Actualizando..."})]}),e.jsxs(z,{children:[g.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(M,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{children:"No tienes pedidos activos."})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"hidden md:grid grid-cols-12 gap-4 px-4 py-2 bg-slate-100 font-semibold text-sm text-slate-600 rounded-t-lg",children:[e.jsx("div",{className:"col-span-2",children:"ID Pedido"}),e.jsx("div",{className:"col-span-3",children:"Cliente"}),e.jsx("div",{className:"col-span-2",children:"Fecha"}),e.jsx("div",{className:"col-span-2",children:"Total / Items"}),e.jsx("div",{className:"col-span-3 text-center",children:"Estado / Acciones"})]}),g.map(s=>{var t,d,n;let c=((t=s.profiles)==null?void 0:t.full_name)||"Cliente Mostrador",l=((d=s.profiles)==null?void 0:d.phone)||"N/A";try{if(s.delivery_address&&(s.delivery_address.startsWith("{")||s.delivery_address.startsWith("["))){const i=JSON.parse(s.delivery_address);i.guest&&(c=i.guest.name||c,l=i.guest.phone||l)}}catch{}return e.jsxs("div",{className:"border rounded-lg p-3 grid grid-cols-1 md:grid-cols-12 gap-4 items-center bg-white hover:bg-slate-50 transition-colors shadow-sm",children:[e.jsxs("div",{className:"col-span-2 font-mono font-bold text-slate-700",children:["#",s.id.substring(0,8)]}),e.jsxs("div",{className:"col-span-3",children:[e.jsx("div",{className:"font-medium text-slate-900",children:c}),e.jsxs("div",{className:"text-xs text-slate-500 flex items-center gap-1",children:[e.jsx(E,{className:"h-3 w-3"})," ",l]})]}),e.jsxs("div",{className:"col-span-2 text-sm text-slate-600",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Q,{className:"h-3 w-3"})," ",new Date(s.created_at).toLocaleDateString()]}),e.jsx("div",{className:"text-xs text-gray-400",children:new Date(s.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsxs("div",{className:"font-bold text-slate-800",children:["$",Number(s.total).toLocaleString()]}),e.jsxs("div",{className:"text-xs text-slate-500",children:[((n=s.order_items)==null?void 0:n.length)||0," ítems"]})]}),e.jsxs("div",{className:"col-span-3 flex flex-col gap-2 items-center justify-center",children:[L(s.status),e.jsx(r,{variant:"ghost",size:"sm",className:"h-6 text-xs text-blue-600 hover:text-blue-800",onClick:()=>w(s),children:"Ver Detalles"}),e.jsxs("div",{className:"flex gap-1 items-center",children:[["Pendiente","Pendiente de pago en efectivo"].includes(s.status)&&e.jsx(r,{size:"sm",className:"h-7 text-xs bg-blue-600 hover:bg-blue-700",onClick:()=>h(s.id,"Confirmado"),children:"Confirmar"}),s.status==="Confirmado"&&e.jsx(r,{size:"sm",className:"h-7 text-xs bg-purple-600 hover:bg-purple-700",onClick:()=>h(s.id,"En preparación"),children:"Preparar"}),s.status==="En preparación"&&e.jsxs(r,{size:"sm",className:"h-7 text-xs bg-indigo-600 hover:bg-indigo-700",onClick:()=>h(s.id,"Listo para recogida"),children:[e.jsx(R,{className:"h-3 w-3 mr-1"})," Listo"]}),e.jsx(r,{size:"sm",variant:"outline",className:"h-7 w-7 p-0",onClick:i=>{i.stopPropagation(),w(s)},children:e.jsx(B,{className:"h-4 w-4"})}),e.jsx(r,{size:"sm",variant:"destructive",className:"h-7 w-7 p-0",onClick:i=>{i.stopPropagation(),$(s.id)},children:e.jsx(O,{className:"h-4 w-4"})})]})]})]},s.id)})]}),e.jsx(k,{open:P,onOpenChange:x,children:e.jsxs(T,{className:"max-w-2xl",children:[e.jsxs(I,{children:[e.jsxs(W,{children:["Pedido #",a==null?void 0:a.id.substring(0,8)]}),e.jsxs(q,{children:["Estado actual: ",e.jsx("span",{className:"font-semibold",children:a==null?void 0:a.status})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 py-4",children:[e.jsx("div",{children:(()=>{var s,t;let d=((s=a==null?void 0:a.profiles)==null?void 0:s.full_name)||"N/A",n=((t=a==null?void 0:a.profiles)==null?void 0:t.phone)||"N/A",c="N/A",l="N/A",i=!1;try{if(a!=null&&a.delivery_address&&(a.delivery_address.startsWith("{")||a.delivery_address.startsWith("["))){const o=JSON.parse(a.delivery_address);o.guest&&(i=!0,d=o.guest.name||d,n=o.guest.phone||n,c=o.guest.doc_id||"N/A",l=o.guest.email||"N/A")}}catch{}return e.jsxs(e.Fragment,{children:[e.jsxs("h4",{className:"font-semibold mb-2 flex items-center gap-2",children:[e.jsx(E,{className:"h-4 w-4"})," Datos del Cliente"]}),e.jsxs("div",{className:"space-y-1 text-sm text-slate-600",children:[e.jsxs("div",{className:"grid grid-cols-[80px_1fr]",children:[e.jsx("span",{className:"font-medium text-slate-800",children:"Nombre:"}),e.jsx("span",{children:d})]}),e.jsxs("div",{className:"grid grid-cols-[80px_1fr]",children:[e.jsx("span",{className:"font-medium text-slate-800",children:"Documento:"}),e.jsx("span",{children:c})]}),e.jsxs("div",{className:"grid grid-cols-[80px_1fr]",children:[e.jsx("span",{className:"font-medium text-slate-800",children:"Teléfono:"}),e.jsx("span",{children:n})]}),e.jsxs("div",{className:"grid grid-cols-[80px_1fr]",children:[e.jsx("span",{className:"font-medium text-slate-800",children:"Email:"}),e.jsx("span",{className:"truncate",title:l,children:l})]}),i&&e.jsx(j,{variant:"secondary",className:"mt-2 text-xs",children:"Venta POS / Invitado"})]})]})})()}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold mb-2 flex items-center gap-2",children:[e.jsx(K,{className:"h-4 w-4"})," Detalle Entrega"]}),e.jsx("p",{className:"text-sm text-slate-600 bg-slate-50 p-2 rounded border",children:(()=>{var s;try{return(s=a==null?void 0:a.delivery_address)!=null&&s.includes('"guest":')?"Entrega inmediata en tienda (POS)":(a==null?void 0:a.delivery_address)||"Recogida en tienda"}catch{return(a==null?void 0:a.delivery_address)||"N/A"}})()})]})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h4",{className:"font-semibold mb-3",children:"Productos"}),e.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto pr-2",children:(N=a==null?void 0:a.order_items)==null?void 0:N.map(s=>{var t;return e.jsxs("div",{className:"flex justify-between items-center text-sm p-3 border rounded-lg bg-slate-50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"font-mono bg-white px-2 py-1 rounded border text-xs font-bold",children:[s.quantity,"x"]}),e.jsx("span",{className:"font-medium text-slate-700",children:(t=s.products)==null?void 0:t.name})]}),e.jsxs("span",{className:"font-bold text-slate-800",children:["$",(s.price*s.quantity).toLocaleString()]})]},s.id)})}),e.jsxs("div",{className:"flex justify-between items-center mt-4 p-4 bg-slate-100 rounded-lg",children:[e.jsx("span",{className:"font-bold text-lg text-slate-700",children:"Total a Pagar"}),e.jsxs("span",{className:"font-bold text-2xl text-slate-900",children:["$",Number(a==null?void 0:a.total).toLocaleString()]})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 border-t pt-4",children:[e.jsx(r,{variant:"outline",onClick:()=>x(!1),children:"Cerrar"}),(a==null?void 0:a.status)!=="Cancelado"&&(a==null?void 0:a.status)!=="Entregado"&&e.jsxs(V,{onValueChange:s=>h(a.id,s),children:[e.jsx(F,{className:"w-[180px]",children:e.jsx(G,{placeholder:"Cambiar Estado"})}),e.jsxs(H,{children:[e.jsx(m,{value:"Confirmado",children:"Confirmar"}),e.jsx(m,{value:"En preparación",children:"En preparación"}),e.jsx(m,{value:"Listo para recogida",children:"Listo para recogida"}),e.jsx(m,{value:"Entregado",children:"Entregado"}),e.jsx(m,{value:"Cancelado",children:"Cancelar Pedido"})]})]})]})]})})]})]})};export{ce as default};
