import{r as t,j as e,B as f,P as U,b as R,T as M,t as u,e as k}from"./index-1004543a.js";import{I as c}from"./input-a76da225.js";import{C as Z,a as J,b as K,d as Q,c as V}from"./card-2a69ef9f.js";import{T as W,a as X,b as v,c as h,d as Y,e as o}from"./table-b7b38c17.js";import{D as ee,f as se,a as ae,b as re,c as te}from"./dialog-4e5e5dd7.js";import{L as n}from"./label-d8349a8f.js";import{T as ie}from"./textarea-e00ca30c.js";import{useStoreDashboard as le}from"./useStoreDashboard-597dd6f0.js";import{L as ce}from"./index-5c7dd775.js";import{S as oe}from"./search-b4265b90.js";import{F as ne}from"./file-image-047941c8.js";import{P as de}from"./pencil-1e3aeda4.js";import"./triangle-alert-2d5d9142.js";const Ce=({storeId:d})=>{const{products:y,fetchProducts:w,addProduct:D,updateProduct:T,deleteProduct:E,isLoadingProducts:F}=le(),[C,L]=t.useState(""),[I,x]=t.useState(!1),[P,S]=t.useState(!1),[g,b]=t.useState(null),[a,p]=t.useState({name:"",price:"",description:"",stock:"1",category:"General",image_url:""}),[N,j]=t.useState(null),A=s=>{s.target.files&&s.target.files[0]&&j(s.target.files[0])},G=async(s,r,i)=>{const{error:l,data:B}=await k.storage.from(r).upload(i,s);if(l)throw new Error(`Error al subir archivo: ${l.message}`);const{data:O}=k.storage.from(r).getPublicUrl(B.path);return O.publicUrl};t.useEffect(()=>{d&&w(d)},[d,w]);const _=y.filter(s=>s.name.toLowerCase().includes(C.toLowerCase())),m=s=>{const{name:r,value:i}=s.target;p(l=>({...l,[r]:i}))},$=()=>{b(null),p({name:"",price:"",description:"",stock:"1",category:"General",image_url:""}),j(null),x(!0)},z=s=>{b(s.id),p({name:s.name,price:s.price,description:s.description||"",stock:s.stock,category:s.category||"General",image_url:s.image_url||""}),j(null),x(!0)},H=async s=>{s.preventDefault(),S(!0);try{let r=a.image_url;if(N){const l=`${d}/${Date.now()}_${N.name.replace(/[^a-zA-Z0-9.]/g,"_")}`;r=await G(N,"product-images",l)}const i={...a,store_id:d,price:parseFloat(a.price),stock:parseInt(a.stock),product_type:"physical",requires_shipping:!0,image_url:r};g?(await T(g,i),u({title:"Producto actualizado",description:"Los cambios se han guardado correctamente."})):(await D(i),u({title:"Producto creado",description:"El producto se ha añadido correctamente."})),x(!1),b(null),p({name:"",price:"",description:"",stock:"1",category:"General",image_url:""}),j(null)}catch(r){u({title:"Error",description:r.message,variant:"destructive"})}finally{S(!1)}},q=async s=>{if(window.confirm("¿Estás seguro de eliminar este producto?"))try{await E(s),u({title:"Producto eliminado"})}catch{u({title:"Error",description:"No se pudo eliminar el producto.",variant:"destructive"})}};return F&&y.length===0?e.jsx(ce,{text:"Cargando inventario..."}):e.jsxs(Z,{className:"h-full border-none shadow-none sm:border sm:shadow-sm animate-in fade-in duration-300",children:[e.jsxs(J,{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 px-4 sm:px-6",children:[e.jsxs("div",{children:[e.jsx(K,{children:"Inventario de Productos"}),e.jsx(Q,{children:"Gestiona tus productos, precios y existencias."})]}),e.jsxs(ee,{open:I,onOpenChange:x,children:[e.jsx(se,{asChild:!0,children:e.jsxs(f,{className:"w-full sm:w-auto bg-green-600 hover:bg-green-700",onClick:$,children:[e.jsx(U,{className:"h-4 w-4 mr-2"})," Nuevo Producto"]})}),e.jsxs(ae,{children:[e.jsx(re,{children:e.jsx(te,{children:g?"Editar Producto":"Agregar Nuevo Producto"})}),e.jsxs("form",{onSubmit:H,className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"name",children:"Nombre del Producto"}),e.jsx(c,{id:"name",name:"name",required:!0,value:a.name,onChange:m,placeholder:"Ej: Aguacates Hass"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"price",children:"Precio"}),e.jsx(c,{id:"price",name:"price",type:"number",required:!0,value:a.price,onChange:m,placeholder:"0.00"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"stock",children:"Stock Disponible"}),e.jsx(c,{id:"stock",name:"stock",type:"number",required:!0,value:a.stock,onChange:m})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"category",children:"Categoría"}),e.jsx(c,{id:"category",name:"category",value:a.category,onChange:m})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"image_upload",children:"Imagen del Producto"}),e.jsxs("div",{className:"flex items-center gap-4",children:[a.image_url&&e.jsx("img",{src:a.image_url,alt:"Preview",className:"h-10 w-10 object-cover rounded border"}),e.jsx(c,{id:"image_upload",type:"file",accept:"image/*",onChange:A,className:"cursor-pointer"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"description",children:"Descripción"}),e.jsx(ie,{id:"description",name:"description",value:a.description,onChange:m,rows:3})]}),e.jsx(f,{type:"submit",className:"w-full bg-green-600 hover:bg-green-700",disabled:P,children:P?e.jsx(R,{className:"h-4 w-4 animate-spin"}):g?"Actualizar Producto":"Guardar Producto"})]})]})]})]}),e.jsxs(V,{className:"px-0 sm:px-6",children:[e.jsx("div",{className:"flex items-center py-4 px-4 sm:px-0",children:e.jsxs("div",{className:"relative w-full max-w-sm",children:[e.jsx(oe,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(c,{placeholder:"Buscar productos...",value:C,onChange:s=>L(s.target.value),className:"pl-8"})]})}),e.jsx("div",{className:"rounded-md border overflow-hidden",children:e.jsxs(W,{children:[e.jsx(X,{children:e.jsxs(v,{children:[e.jsx(h,{className:"w-[80px] hidden sm:table-cell",children:"Imagen"}),e.jsx(h,{children:"Nombre"}),e.jsx(h,{className:"text-right",children:"Precio"}),e.jsx(h,{className:"text-center",children:"Stock"}),e.jsx(h,{className:"text-right",children:"Acciones"})]})}),e.jsx(Y,{children:_.length===0?e.jsx(v,{children:e.jsx(o,{colSpan:5,className:"h-24 text-center text-muted-foreground",children:"No se encontraron productos."})}):_.map(s=>e.jsxs(v,{children:[e.jsx(o,{className:"hidden sm:table-cell",children:s.image_url?e.jsx("img",{src:s.image_url,alt:s.name,className:"h-10 w-10 rounded-md object-cover"}):e.jsx("div",{className:"h-10 w-10 rounded-md bg-slate-100 flex items-center justify-center text-slate-400",children:e.jsx(ne,{className:"h-5 w-5"})})}),e.jsx(o,{className:"font-medium",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{children:s.name}),e.jsx("span",{className:"text-xs text-muted-foreground sm:hidden",children:s.category})]})}),e.jsxs(o,{className:"text-right",children:["$",Number(s.price).toLocaleString()]}),e.jsx(o,{className:"text-center",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${s.stock>0?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:s.stock})}),e.jsx(o,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(f,{variant:"ghost",size:"icon",onClick:()=>z(s),className:"text-blue-500 hover:text-blue-700 hover:bg-blue-50",children:e.jsx(de,{className:"h-4 w-4"})}),e.jsx(f,{variant:"ghost",size:"icon",onClick:()=>q(s.id),className:"text-red-500 hover:text-red-700 hover:bg-red-50",children:e.jsx(M,{className:"h-4 w-4"})})]})})]},s.id))})]})})]})]})};export{Ce as default};
