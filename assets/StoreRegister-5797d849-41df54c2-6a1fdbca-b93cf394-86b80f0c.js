import{f as s,M,D as k,r as q,k as E,N as o,y as e,x as y,q as N,s as F,a as D,b as O,c as T,o as _,d as H,W as z}from"./index-87ab05f1.js";import{K as G}from"./Helmet-d9a99439-17d17245-80416325-0a82370e-5a6bde15.js";import{a as t}from"./input-977568de-bea10295-4adb3258-368f21ef-dd0395aa.js";import{u as i}from"./label-6ced007b-31f64b09-71156226-1e4e75c4-8af8544c.js";const W=()=>{const[h,f]=s.useState(""),[x,b]=s.useState(""),[g,w]=s.useState(""),[d,R]=s.useState(""),[p,v]=s.useState(!1),n=M(),{signUp:C,user:l}=k(),j=q();s.useEffect(()=>{(async()=>{if(l){const{data:a}=await E.from("stores").select("category").eq("owner_id",l.id).maybeSingle();a&&(n("/tienda/dashboard"),o({title:"Acceso Redirigido",description:`Ya tienes registrado un negocio de tipo "${a.category}".`}))}})()},[l,n,j.search]);const c=new URLSearchParams(j.search).get("service")||"General",S={Restaurante:"Restaurante",Hotel:"Hotel",Ropa:"Tienda de Ropa / Moda",Farmacia:"Farmacia / Droguería",Papelería:"Papelería / Miscelánea",Panadería:"Panadería / Repostería",Supermercado:"Supermercado / Abarrotes",Cultivador:"Cultivadores",General:"Otro Comercio"},P=async a=>{a.preventDefault(),v(!0);try{const{user:m,error:u}=await C(h,x,{data:{role:"tienda",store_name:g,address:d,address:d,category:c,service_category:S[c]||"Domicilios"}},!0);if(u){let r=u.message;u.code==="user_already_exists"||r==="User already registered"||r.includes("already registered")?r="Este correo electrónico ya está registrado. Por favor intenta iniciar sesión.":r.includes("Password should be")&&(r="La contraseña debe tener al menos 6 caracteres."),o({title:"Error de Registro",description:r,variant:"destructive"})}else m&&(o({title:"Registro Exitoso",description:"¡Bienvenido! Hemos enviado un correo de confirmación. Por favor, revisa tu bandeja de entrada."}),n("/tienda/dashboard"))}catch(m){console.error(m),o({title:"Error Inesperado",description:"Ha ocurrido un error inesperado. Por favor, inténtalo de nuevo.",variant:"destructive"})}finally{v(!1)}};return e.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center bg-gray-50 dark:bg-gray-900 p-4 relative",children:[e.jsxs(G,{children:[e.jsx("title",{children:"Registro de Negocio | MiOriente"}),e.jsx("meta",{name:"description",content:"Registra tu tienda, restaurante o servicio en MiOriente."})]}),e.jsx("div",{className:"absolute top-4 left-4 z-10",children:e.jsx(y,{variant:"outline",size:"icon",asChild:!0,className:"bg-white/80 backdrop-blur-sm hover:bg-white shadow-sm",children:e.jsxs(N,{to:"/",children:[e.jsx(F,{className:"h-5 w-5 text-gray-700 dark:text-gray-300"}),e.jsx("span",{className:"sr-only",children:"Volver al Inicio"})]})})}),e.jsxs(D,{className:"w-full max-w-md shadow-lg rounded-lg",children:[e.jsxs(O,{className:"text-center",children:[e.jsx(T,{className:"text-3xl font-bold",children:"Registrar Negocio"}),e.jsx(_,{className:"text-muted-foreground mt-2",children:"Únete a MiOriente y empieza a vender tus productos/servicios."})]}),e.jsx(H,{children:e.jsxs("form",{onSubmit:P,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"serviceType",children:"Tipo de Negocio"}),e.jsx(t,{id:"serviceType",type:"text",value:c,readOnly:!0,className:"mt-1 bg-gray-100 dark:bg-gray-800"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"storeName",children:"Nombre del Negocio"}),e.jsx(t,{id:"storeName",type:"text",placeholder:"Mi Tienda de Ejemplo",value:g,onChange:a=>w(a.target.value),required:!0,className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"address",children:"Dirección del Negocio"}),e.jsx(t,{id:"address",type:"text",placeholder:"Calle 123 #45-67",value:d,onChange:a=>R(a.target.value),required:!0,className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"email",children:"Email"}),e.jsx(t,{id:"email",type:"email",placeholder:"email@ejemplo.com",value:h,onChange:a=>f(a.target.value),required:!0,className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"password",children:"Contraseña"}),e.jsx(t,{id:"password",type:"password",placeholder:"••••••••",value:x,onChange:a=>b(a.target.value),required:!0,className:"mt-1"})]}),e.jsx(y,{type:"submit",className:"w-full",disabled:p,children:p?e.jsx(z,{className:"mr-2 h-4 w-4 animate-spin"}):"Registrar Negocio"}),e.jsxs("p",{className:"text-center text-sm text-muted-foreground",children:["¿Ya tienes cuenta?"," ",e.jsx(N,{to:"/tienda/login",className:"text-primary hover:underline",children:"Ingresar"})]})]})})]})]})};export{W as default};
