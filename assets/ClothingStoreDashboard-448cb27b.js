import{k as v,Q as ee,r as h,j as e,B as N,P as R,D as ae,v as se,z as te,E as re,T as G,f as ie,C as ne,c as le,t as D,g as oe}from"./index-dc7f1cf1.js";import{L as ce,B as de}from"./BaseStoreDashboard-309f7a6b.js";import me from"./OverviewTab-c3d5933b.js";import{I as w}from"./input-d4c7e221.js";import{S as A,a as I,b as L,c as z,d as g}from"./select-37a35d51.js";import{L as p}from"./label-21562bd6.js";import{T as xe}from"./textarea-385c103a.js";import{B as he}from"./badge-1d2a7dc0.js";import{useStoreDashboard as pe}from"./useStoreDashboard-8587e03d.js";import{S as ue}from"./search-3987990a.js";import{S as M}from"./shirt-e6e93b3b.js";import{P as ge}from"./pencil-d18f2cb4.js";import fe from"./OrdersTab-6c4e970e.js";import je from"./FinancialsTab-63001316.js";import{S as ve,a as Ne}from"./StoreCustomersTab-b6077f3d.js";import{U as be}from"./users-f825be4c.js";import{D as ye,S as we}from"./settings-32dd1f84.js";import"./Helmet-4b27b46c.js";import"./log-out-92be1f5b.js";import"./index-b2f4b39b.js";import"./triangle-alert-32ee3fb6.js";import"./package-e8519bdc.js";import"./trending-up-9f29547c.js";import"./check-0c83caba.js";import"./clock-8175ed76.js";import"./truck-044bfd35.js";import"./map-pin-10c801f4.js";import"./credit-card-0c959c84.js";import"./circle-alert-927ef83a.js";const B={_parseVariants(s){var o;if(!s)return s;let n=[];const l=(o=s.description)==null?void 0:o.match(/VARIANTS_JSON:\s*(\[.*\])/s);let i=s.description||"";if(l)try{n=JSON.parse(l[1]),i=s.description.replace(/\n\nVARIANTS_JSON:\s*\[.*\]/s,"")}catch(t){console.error("Error parsing variants",t)}return{...s,variants:n,description:i,full_description:s.description}},async getClothingProducts(s){const{data:n,error:l}=await v.from("products").select("*").eq("store_id",s).order("created_at",{ascending:!1});if(l)throw l;return n.map(this._parseVariants)},async saveClothingProduct(s){const{variants:n,description:l,...i}=s;let o=l||"";if(n&&n.length>0){const m=JSON.stringify(n);o=`${l||""}

VARIANTS_JSON: ${m}`}let t=i.stock;n&&n.length>0&&(t=n.reduce((m,x)=>m+(Number(x.qty)||0),0));const c={...i,description:o,stock:t,product_type:"physical",requires_shipping:!0};if(c.id){const{data:m,error:x}=await v.from("products").update(c).eq("id",c.id).select().single();if(x)throw x;return this._parseVariants(m)}else{const{data:m,error:x}=await v.from("products").insert(c).select().single();if(x)throw x;return this._parseVariants(m)}},async deleteClothingProduct(s){const{error:n}=await v.from("products").delete().eq("id",s);if(n)throw n}},Se=ee((s,n)=>({products:[],isLoading:!1,error:null,fetchProducts:async l=>{s({isLoading:!0,error:null});try{const i=await B.getClothingProducts(l);s({products:i})}catch(i){s({error:i.message})}finally{s({isLoading:!1})}},saveProduct:async l=>{try{const i=await B.saveClothingProduct(l);return s(o=>o.products.find(c=>c.id===i.id)?{products:o.products.map(c=>c.id===i.id?i:c)}:{products:[i,...o.products]}),i}catch(i){throw i}},deleteProduct:async l=>{try{await B.deleteClothingProduct(l),s(i=>({products:i.products.filter(o=>o.id!==l)}))}catch(i){throw i}}})),Ce=({product:s,onEdit:n,onDelete:l})=>{const i=s.variants||[],o=[...new Set(i.map(t=>t.size))].sort();return e.jsxs(ne,{className:"rounded-none overflow-hidden border-0 shadow-sm hover:shadow-xl transition-all group bg-white h-full flex flex-col",children:[e.jsxs("div",{className:"relative aspect-[3/4] bg-gray-100 overflow-hidden",children:[s.image_url?e.jsx("img",{src:s.image_url,alt:s.name,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-gray-300",children:[e.jsx(M,{className:"h-16 w-16 mb-2"}),e.jsx("span",{className:"text-xs",children:"Sin imagen"})]}),e.jsx("div",{className:"absolute top-2 left-2 flex flex-col gap-1",children:s.discount>0&&e.jsxs(he,{className:"bg-red-500 hover:bg-red-600 text-white border-0 text-xs",children:["-",s.discount,"% OFF"]})}),e.jsxs("div",{className:"absolute bottom-4 right-4 flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity translate-y-2 group-hover:translate-y-0 duration-300",children:[e.jsx(N,{variant:"secondary",size:"icon",className:"h-9 w-9 rounded-full shadow-lg bg-white hover:bg-gray-50 text-black",onClick:t=>{t.stopPropagation(),n(s)},children:e.jsx(ge,{className:"h-4 w-4"})}),e.jsx(N,{variant:"destructive",size:"icon",className:"h-9 w-9 rounded-full shadow-lg",onClick:t=>{t.stopPropagation(),l(s.id)},children:e.jsx(G,{className:"h-4 w-4"})})]})]}),e.jsxs(le,{className:"p-4 flex-1 flex flex-col",children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-widest mb-1",children:s.category||"Colección General"}),e.jsx("h3",{className:"font-serif text-lg text-slate-900 leading-tight mb-2 truncate",children:s.name}),e.jsx("div",{className:"flex flex-wrap gap-1 mb-3 min-h-[1.5rem]",children:o.length>0?o.map(t=>e.jsx("span",{className:"text-[10px] border border-gray-200 px-1.5 py-0.5 rounded text-gray-600",children:t},t)):e.jsx("span",{className:"text-[10px] text-gray-400 italic",children:"Talla única"})}),e.jsxs("div",{className:"mt-auto flex justify-between items-end border-t pt-3",children:[e.jsx("div",{className:"flex flex-col",children:e.jsxs("span",{className:"text-sm font-medium text-slate-900",children:["$",Number(s.price).toLocaleString()]})}),e.jsxs("span",{className:"text-xs text-gray-400",children:["Total: ",s.stock," un."]})]})]})]})},Pe=["XS","S","M","L","XL","XXL","Única"],_e=[{name:"Negro",hex:"#000000"},{name:"Blanco",hex:"#FFFFFF"},{name:"Rojo",hex:"#EF4444"},{name:"Azul",hex:"#3B82F6"},{name:"Verde",hex:"#22C55E"},{name:"Amarillo",hex:"#EAB308"},{name:"Rosa",hex:"#EC4899"},{name:"Gris",hex:"#6B7280"},{name:"Beige",hex:"#F5F5DC"}],De=()=>{const{products:s,fetchProducts:n,saveProduct:l,deleteProduct:i,isLoading:o}=Se(),{store:t}=pe(),[c,m]=h.useState(""),[x,S]=h.useState(!1),[q,O]=h.useState(!1),[C,T]=h.useState(null),[f,P]=h.useState([]),[b,_]=h.useState({size:"M",color:"Negro",qty:1}),[d,y]=h.useState({name:"",price:"",description:"",category:"General",image_url:""}),[V,F]=h.useState(null);h.useEffect(()=>{t!=null&&t.id&&n(t.id)},[t==null?void 0:t.id,n]);const $=s.filter(a=>a.name.toLowerCase().includes(c.toLowerCase())),J=()=>{P([...f,{...b,id:Date.now()}]),_({...b,qty:1})},U=a=>{P(f.filter(r=>r.id!==a))},X=()=>{T(null),y({name:"",price:"",description:"",category:"General",image_url:""}),P([]),F(null),S(!0)},H=a=>{T(a);let r=a.variants||[];r=r.map(u=>({...u,id:u.id||Math.random()})),y({name:a.name,price:a.price,description:a.description||"",category:a.category||"General",image_url:a.image_url||""}),P(r),F(null),S(!0)},E=a=>{const{name:r,value:u}=a.target;y(j=>({...j,[r]:u}))},Z=a=>{a.target.files&&a.target.files[0]&&F(a.target.files[0])},Q=async(a,r,u)=>{const{error:j,data:k}=await v.storage.from(r).upload(u,a);if(j)throw new Error(`Error upload: ${j.message}`);const{data:Y}=v.storage.from(r).getPublicUrl(k.path);return Y.publicUrl},K=async a=>{a.preventDefault(),O(!0);try{let r=d.image_url;if(V&&(t!=null&&t.id)){const j=V.name.replace(/[^a-zA-Z0-9.]/g,"_"),k=`${t.id}/${Date.now()}_fashion_${j}`;r=await Q(V,"product-images",k)}const u={id:C?C.id:void 0,name:d.name,price:parseFloat(d.price),stock:0,variants:f,image_url:r,description:d.description,category:d.category,store_id:t==null?void 0:t.id};await l(u),D({title:C?"Prenda actualizada":"Prenda añadida",description:"Inventario sincronizado."}),S(!1),T(null),y({name:"",price:"",description:"",category:"General",image_url:""})}catch(r){console.error(r),D({title:"Error",description:"Fallo al guardar.",variant:"destructive"})}finally{O(!1)}},W=async a=>{if(window.confirm("¿Retirar prenda del catálogo?"))try{await i(a),D({title:"Prenda eliminada"})}catch{D({title:"Error",variant:"destructive"})}};return e.jsxs("div",{className:"space-y-8 font-sans",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-end md:items-center gap-4 border-b border-slate-100 pb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-serif text-slate-900 mb-2",children:"Colección & Stock"}),e.jsx("p",{className:"text-slate-500 font-light",children:"Gestiona tallas, colores y disponiblidad de tus prendas."})]}),e.jsxs(N,{className:"bg-slate-900 text-white hover:bg-slate-800 rounded-none px-8 py-6 uppercase tracking-wider text-xs",onClick:X,children:[e.jsx(R,{className:"h-4 w-4 mr-2"})," Nueva Prenda"]})]}),e.jsx("div",{className:"flex gap-4 items-center bg-white p-1",children:e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(ue,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-300"}),e.jsx(w,{placeholder:"Buscar referencia...",className:"pl-10 border-slate-200 rounded-none focus-visible:ring-0 focus-visible:border-slate-400",value:c,onChange:a=>m(a.target.value)})]})}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-x-8 gap-y-12",children:$.map(a=>e.jsx(Ce,{product:{...a,discount:0},onEdit:H,onDelete:W},a.id))}),e.jsx(ae,{open:x,onOpenChange:S,children:e.jsxs(se,{className:"sm:max-w-[700px] max-h-[90vh] overflow-y-auto",children:[e.jsx(te,{children:e.jsx(re,{className:"font-serif text-2xl",children:C?"Editar Prenda":"Nueva Prenda"})}),e.jsxs("form",{onSubmit:K,className:"space-y-6 py-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Nombre / Referencia"}),e.jsx(w,{name:"name",value:d.name,onChange:E,placeholder:"Ej: Camisa Lino Blanca",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Precio"}),e.jsx(w,{name:"price",type:"number",value:d.price,onChange:E,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Categoría / Colección"}),e.jsxs(A,{name:"category",value:d.category,onValueChange:a=>y(r=>({...r,category:a})),children:[e.jsx(I,{children:e.jsx(L,{})}),e.jsxs(z,{children:[e.jsx(g,{value:"General",children:"General"}),e.jsx(g,{value:"Hombre",children:"Hombre"}),e.jsx(g,{value:"Mujer",children:"Mujer"}),e.jsx(g,{value:"Niños",children:"Niños"}),e.jsx(g,{value:"Accesorios",children:"Accesorios"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Imagen"}),e.jsx(w,{type:"file",accept:"image/*",onChange:Z}),d.image_url&&e.jsx("img",{src:d.image_url,alt:"Preview",className:"h-20 w-auto object-contain border mt-2"})]})]}),e.jsxs("div",{className:"bg-slate-50 p-4 rounded-lg space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(p,{className:"font-bold",children:"Variantes de Stock"}),e.jsxs("span",{className:"text-xs text-slate-500",children:["Total: ",f.reduce((a,r)=>a+Number(r.qty),0)," un."]})]}),e.jsxs("div",{className:"flex gap-2 items-end",children:[e.jsxs("div",{className:"w-20",children:[e.jsx(p,{className:"text-xs",children:"Talla"}),e.jsxs(A,{value:b.size,onValueChange:a=>_(r=>({...r,size:a})),children:[e.jsx(I,{className:"h-8 text-xs",children:e.jsx(L,{})}),e.jsx(z,{children:Pe.map(a=>e.jsx(g,{value:a,children:a},a))})]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx(p,{className:"text-xs",children:"Color"}),e.jsxs(A,{value:b.color,onValueChange:a=>_(r=>({...r,color:a})),children:[e.jsx(I,{className:"h-8 text-xs",children:e.jsx(L,{})}),e.jsx(z,{children:_e.map(a=>e.jsx(g,{value:a.name,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full border",style:{backgroundColor:a.hex}}),a.name]})},a.name))})]})]}),e.jsxs("div",{className:"w-20",children:[e.jsx(p,{className:"text-xs",children:"Cant."}),e.jsx(w,{type:"number",className:"h-8 text-xs",value:b.qty,onChange:a=>_(r=>({...r,qty:a.target.value}))})]}),e.jsx(N,{type:"button",size:"sm",onClick:J,className:"h-8 bg-black text-white",children:e.jsx(R,{className:"h-3 w-3"})})]}),e.jsxs("div",{className:"space-y-1 max-h-[200px] overflow-y-auto",children:[f.map(a=>e.jsxs("div",{className:"flex justify-between items-center text-sm bg-white p-2 rounded border",children:[e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("span",{className:"font-bold w-6",children:a.size}),e.jsx("span",{className:"text-slate-500",children:a.color})]}),e.jsxs("div",{className:"flex gap-3 items-center",children:[e.jsx("span",{className:"font-mono bg-slate-100 px-1",children:a.qty}),e.jsx(N,{variant:"ghost",size:"icon",className:"h-5 w-5 hover:text-red-500",onClick:()=>U(a.id),children:e.jsx(G,{className:"h-3 w-3"})})]})]},a.id)),f.length===0&&e.jsx("p",{className:"text-xs text-gray-400 text-center py-2",children:"Sin variantes definidas"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Descripción Pública"}),e.jsx(xe,{name:"description",value:d.description,onChange:E,placeholder:"Detalles de la tela, cuidados, etc."})]}),e.jsx(N,{type:"submit",className:"w-full bg-slate-900 text-white rounded-none py-6 uppercase tracking-widest font-bold hover:bg-slate-800",disabled:q,children:q?e.jsx(ie,{className:"animate-spin"}):"Guardar Prenda"})]})]})})]})},ra=({store:s})=>{const n=[{path:"",label:"Resumen",icon:ce,element:e.jsx(me,{storeId:s.id})},{path:"coleccion",label:"Colección",icon:M,element:e.jsx(De,{})},{path:"pedidos",label:"Pedidos",icon:oe,element:e.jsx(fe,{storeId:s.id})},{path:"clientes",label:"Clientes",icon:be,element:e.jsx(ve,{})},{path:"finanzas",label:"Finanzas",icon:ye,element:e.jsx(je,{storeId:s.id})},{path:"configuracion",label:"Configuración",icon:we,element:e.jsx(Ne,{})}];return e.jsx(de,{store:s,tabs:n})};export{ra as default};
