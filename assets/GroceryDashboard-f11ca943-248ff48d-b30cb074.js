import{x as X,z as Y,w as D,W as J,d as n,Z as Q,$ as W,y as e,a0 as B,a1 as z,a6 as Z,j as O,r as ee,s as ae,t as te,X as se,b as N,B as re,A as ie,Y as oe,l as ce,G as ne,N as de,E}from"./index-8e3c4911.js";import{$ as le,L as me}from"./BaseStoreDashboard-9ad5c13e-d7a1a933-4e4e637d.js";import{s as R,u as ue}from"./useStoreDashboard-6cfa5bdd-a014cfe4-c8bff8db.js";import pe from"./OverviewTab-a01a807a-07dd1735-5ada0bfc.js";import{a as S}from"./input-977568de-bea10295-4adb3258.js";import{H as he,T as xe,$ as fe,D as je,_ as be}from"./select-03f52418-c5111b6c-af5e7482.js";import{u as _}from"./label-6ced007b-31f64b09-71156226.js";import"./textarea-03a75c76-69040bf5-35a9782e.js";import{b as ye,l as ge}from"./index-e23a302d-1b9287b5-b6450a0d.js";import{o as ve}from"./check-78166ef5-9630779a-ee565adf.js";import{d as ke}from"./badge-34bdff7c-b2c90fce-efd43af8.js";import{o as Ne,d as we,f as A,b as C,m as Ce,i as $}from"./table-d515a05c-fec441de-a95c27a2.js";import{e as K}from"./shopping-cart-8aca5ef3-095b1616-112594bf.js";import{o as $e}from"./search-566f00ed-c3babbf0-ad60b5b7.js";import{p as Pe}from"./pencil-b145156d-81e39600-5a684db5.js";import Se from"./OrdersManagementTab-74307886-48065a75-18a01665.js";import{B as _e}from"./BulkUploadTab-0fe3efc4-824a62de-987b67e9.js";import qe from"./FinancialsTab-e07ef4f8-cb7c3ea0-71aba4e2.js";import Ee from"./AdminTab-1ef2bbd0-38fe81f3-dd6c0adf.js";import Le from"./ProfileTab-fd4f3500-9e2db3bd-31628205.js";import{y as Ie}from"./credit-card-bcc8ac59-e0a7eb79-9e00e665.js";import{p as Me}from"./upload-8259cec2-21216fe4-eb25a68c.js";import{y as De,o as ze}from"./settings-96af137d-f461a4db-8933cd88.js";import{t as Oe}from"./users-93d0d9a2-82ed9403-42cfbbc5.js";import"./Helmet-d9a99439-17d17245-80416325.js";import"./log-out-1de3e3ee-53ee1d6f-be22ed5f.js";import"./index-6c60542e-1f0cc56c-a6179bc2.js";import"./triangle-alert-5ea4272b-316ec065-d63fb5c5.js";import"./package-99b0a55c-785e5cf1-bac652b0.js";import"./trending-up-147c55bb-4628ab85-e3b835f1.js";import"./clock-0a32af33-121834d9-4cd0de5d.js";import"./truck-a0071c63-090d128d-9cfc595e.js";import"./map-pin-4396fd6c-98f8e615-be2face5.js";import"./circle-alert-58769497-aeae36dd-aab7d564.js";import"./user-plus-74362f50-3e37ce73-40475d04.js";/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Re=[["path",{d:"M3 5v14",key:"1nt18q"}],["path",{d:"M8 5v14",key:"1ybrkv"}],["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"M17 5v14",key:"ycjyhj"}],["path",{d:"M21 5v14",key:"nzette"}]],Ae=X("barcode",Re),Be=Y((t,d)=>({products:[],cart:[],isLoadingProducts:!1,isLoadingCheckout:!1,error:null,fetchProducts:async r=>{t({isLoadingProducts:!0});try{const o=await R.obtenerProductos(r);t({products:o||[]})}catch(o){t({error:o.message})}finally{t({isLoadingProducts:!1})}},addToCart:r=>{const o=d().cart,l=o.find(s=>s.id===r.id);return t(l?{cart:o.map(s=>s.id===r.id?{...s,qty:s.qty+1}:s)}:{cart:[...o,{...r,qty:1}]}),!0},removeFromCart:r=>t(o=>({cart:o.cart.filter(l=>l.id!==r)})),updateCartQty:(r,o)=>t(l=>({cart:l.cart.map(s=>s.id===r?{...s,qty:Math.max(1,s.qty+o)}:s)})),clearCart:()=>t({cart:[]}),processCheckout:async(r,o,l,s)=>{const m=d().cart;if(m.length===0)return;const p=typeof o=="object"?{...o,method:l,type:"POS"}:{name:o,method:l,type:"POS"};t({isLoadingCheckout:!0});try{const{data:f,error:h}=await D.from("orders").insert({store_id:r,customer_id:null,status:"Entregado",total:s,delivery_address:JSON.stringify({guest:p,items:m.map(i=>({id:i.id,name:i.name,qty:i.qty,price:i.price}))})}).select().single();if(h)throw h;const j=m.map(i=>({order_id:f.id,product_id:i.id,quantity:i.qty,price:i.price})),{error:b}=await D.from("order_items").insert(j);if(b)throw b;for(const i of m)i.stock!==void 0&&await R.actualizarProducto(i.id,{stock:Math.max(0,i.stock-i.qty)});return d().clearCart(),!0}catch(f){throw f}finally{t({isLoadingCheckout:!1})}}}));var I="Checkbox",[Ke,qa]=J(I),[Te,Ue]=Ke(I),T=n.forwardRef((t,d)=>{const{__scopeCheckbox:r,name:o,checked:l,defaultChecked:s,required:m,disabled:p,value:f="on",onCheckedChange:h,form:j,...b}=t,[i,w]=n.useState(null),c=Q(d,u=>w(u)),x=n.useRef(!1),q=i?j||!!i.closest("form"):!0,[y=!1,P]=W({prop:l,defaultProp:s,onChange:h}),L=n.useRef(y);return n.useEffect(()=>{const u=i==null?void 0:i.form;if(u){const v=()=>P(L.current);return u.addEventListener("reset",v),()=>u.removeEventListener("reset",v)}},[i,P]),e.jsxs(Te,{scope:r,state:y,disabled:p,children:[e.jsx(B.button,{type:"button",role:"checkbox","aria-checked":g(y)?"mixed":y,"aria-required":m,"data-state":V(y),"data-disabled":p?"":void 0,disabled:p,value:f,...b,ref:c,onKeyDown:z(t.onKeyDown,u=>{u.key==="Enter"&&u.preventDefault()}),onClick:z(t.onClick,u=>{P(v=>g(v)?!0:!v),q&&(x.current=u.isPropagationStopped(),x.current||u.stopPropagation())})}),q&&e.jsx(Ge,{control:i,bubbles:!x.current,name:o,value:f,checked:y,required:m,disabled:p,form:j,style:{transform:"translateX(-100%)"},defaultChecked:g(s)?!1:s})]})});T.displayName=I;var U="CheckboxIndicator",G=n.forwardRef((t,d)=>{const{__scopeCheckbox:r,forceMount:o,...l}=t,s=Ue(U,r);return e.jsx(Z,{present:o||g(s.state)||s.state===!0,children:e.jsx(B.span,{"data-state":V(s.state),"data-disabled":s.disabled?"":void 0,...l,ref:d,style:{pointerEvents:"none",...t.style}})})});G.displayName=U;var Ge=t=>{const{control:d,checked:r,bubbles:o=!0,defaultChecked:l,...s}=t,m=n.useRef(null),p=ye(r),f=ge(d);n.useEffect(()=>{const j=m.current,b=window.HTMLInputElement.prototype,i=Object.getOwnPropertyDescriptor(b,"checked").set;if(p!==r&&i){const w=new Event("click",{bubbles:o});j.indeterminate=g(r),i.call(j,g(r)?!1:r),j.dispatchEvent(w)}},[p,r,o]);const h=n.useRef(g(r)?!1:r);return e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:l??h.current,...s,tabIndex:-1,ref:m,style:{...t.style,...f,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function g(t){return t==="indeterminate"}function V(t){return g(t)?"indeterminate":t?"checked":"unchecked"}var F=T,Ve=G;const Fe=n.forwardRef(({className:t,...d},r)=>e.jsx(F,{ref:r,className:O("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",t),...d,children:e.jsx(Ve,{className:O("flex items-center justify-center text-current"),children:e.jsx(ve,{className:"h-4 w-4"})})}));Fe.displayName=F.displayName;const He=()=>{const{products:t,fetchProducts:d,addProduct:r,updateProduct:o,deleteProduct:l,store:s}=ue(),[m,p]=n.useState(""),[f,h]=n.useState(!1),[j,b]=n.useState(!1),[i,w]=n.useState(null),[c,x]=n.useState({name:"",price:"",stock:"",description:"",category:"Abarrotes",sku:"",image_url:""});n.useEffect(()=>{s!=null&&s.id&&d(s.id)},[s==null?void 0:s.id,d]);const q=t.filter(a=>a.name.toLowerCase().includes(m.toLowerCase())||a.sku&&a.sku.includes(m)),y=["Abarrotes","Lácteos","Carnes","Frutas/Verduras","Limpieza","Bebidas","Cuidado Personal"],P=()=>{w(null),x({name:"",price:"",stock:"50",description:"",category:"Abarrotes",sku:"",image_url:""}),h(!0)},L=a=>{w(a),x({name:a.name,price:a.price,stock:a.stock,description:a.description||"",category:a.category||"Abarrotes",sku:a.sku||"",image_url:a.image_url||""}),h(!0)},u=async(a,k)=>{try{await o(a.id,{stock:parseInt(k)}),E({title:"Stock actualizado"})}catch{}},v=async a=>{a.preventDefault(),b(!0);try{const k={name:c.name,price:parseFloat(c.price),stock:parseInt(c.stock),sku:c.sku,description:c.sku?`${c.description}

SKU:${c.sku}`:c.description,category:c.category,store_id:s==null?void 0:s.id,product_type:"physical",requires_shipping:!0};i?(await o(i.id,k),E({title:"Producto actualizado"})):(await r(k),E({title:"Producto registrado"})),h(!1)}catch{E({title:"Error",variant:"destructive"})}finally{b(!1)}},H=async a=>{confirm("¿Eliminar producto?")&&await l(a)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-emerald-50 border border-emerald-100 p-6 rounded-t-xl flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-emerald-900 flex items-center gap-2",children:[e.jsx(K,{className:"h-8 w-8 text-emerald-600"}),"Inventario Máster"]}),e.jsx("p",{className:"text-emerald-700",children:"Gestión masiva de referencias, precios y existencias."})]}),e.jsxs(N,{className:"bg-emerald-700 hover:bg-emerald-800",onClick:P,children:[e.jsx(re,{className:"h-4 w-4 mr-2"})," Nuevo Producto"]})]}),e.jsxs("div",{className:"flex gap-4 items-center bg-white p-2 border-b",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx($e,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(S,{placeholder:"Buscar por nombre, código de barras...",className:"pl-10",value:m,onChange:a=>p(a.target.value)})]}),e.jsxs(N,{variant:"outline",children:[e.jsx(Ae,{className:"h-4 w-4 mr-2"})," Escanear"]})]}),e.jsx("div",{className:"bg-white border rounded-lg overflow-hidden shadow-sm",children:e.jsxs(Ne,{children:[e.jsx(we,{children:e.jsxs(A,{className:"bg-gray-50",children:[e.jsx(C,{className:"w-[100px]",children:"Código/SKU"}),e.jsx(C,{children:"Producto"}),e.jsx(C,{children:"Categoría"}),e.jsx(C,{className:"text-right",children:"Precio"}),e.jsx(C,{className:"text-center w-[150px]",children:"Stock"}),e.jsx(C,{className:"text-right",children:"Acciones"})]})}),e.jsx(Ce,{children:q.map(a=>{var k,M;return e.jsxs(A,{children:[e.jsx($,{className:"font-mono text-xs text-gray-500",children:a.sku||((M=(k=a.description)==null?void 0:k.match(/SKU:(\w+)/))==null?void 0:M[1])||"---"}),e.jsx($,{className:"font-medium text-slate-800",children:a.name}),e.jsx($,{children:e.jsx(ke,{variant:"outline",className:"font-normal",children:a.category})}),e.jsxs($,{className:"text-right font-bold text-emerald-700",children:["$",Number(a.price).toLocaleString()]}),e.jsx($,{className:"text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(N,{variant:"ghost",className:"h-6 w-6 rounded-full p-0",onClick:()=>u(a,Math.max(0,a.stock-1)),children:"-"}),e.jsx("span",{className:"w-8 text-center",children:a.stock}),e.jsx(N,{variant:"ghost",className:"h-6 w-6 rounded-full p-0",onClick:()=>u(a,a.stock+1),children:"+"})]})}),e.jsxs($,{className:"text-right",children:[e.jsx(N,{variant:"ghost",size:"sm",onClick:()=>L(a),children:e.jsx(Pe,{className:"h-4 w-4 text-blue-500"})}),e.jsx(N,{variant:"ghost",size:"sm",onClick:()=>H(a.id),children:e.jsx(ie,{className:"h-4 w-4 text-red-500"})})]})]},a.id)})})]})}),e.jsx(oe,{open:f,onOpenChange:h,children:e.jsxs(ce,{children:[e.jsx(ne,{children:e.jsx(de,{children:"Producto de Supermercado"})}),e.jsxs("form",{onSubmit:v,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2 col-span-2",children:[e.jsx(_,{children:"Nombre Producto"}),e.jsx(S,{value:c.name,onChange:a=>x({...c,name:a.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{children:"Código Barras / SKU"}),e.jsx(S,{value:c.sku,onChange:a=>x({...c,sku:a.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{children:"Categoría"}),e.jsxs(he,{value:c.category,onValueChange:a=>x({...c,category:a}),children:[e.jsx(xe,{children:e.jsx(fe,{})}),e.jsx(je,{children:y.map(a=>e.jsx(be,{value:a,children:a},a))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{children:"Precio"}),e.jsx(S,{type:"number",value:c.price,onChange:a=>x({...c,price:a.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{children:"Stock Inicial"}),e.jsx(S,{type:"number",value:c.stock,onChange:a=>x({...c,stock:a.target.value}),required:!0})]})]}),e.jsx(N,{type:"submit",className:"w-full bg-emerald-600 hover:bg-emerald-700",disabled:j,children:"Guardar"})]})]})})]})},Xe=n.lazy(()=>ee(()=>ae(()=>te(()=>import("./GenericPOSView-65865e30-e48d2479-1f7364f9.js"),["./GenericPOSView-65865e30-e48d2479-1f7364f9.js","./index-8e3c4911.js","./index-dc19931e.css","./input-977568de-bea10295-4adb3258.js","./badge-34bdff7c-b2c90fce-efd43af8.js","./scroll-area-d0c9b1aa-5d11dc0b-4a9e3f1e.js","./label-6ced007b-31f64b09-71156226.js","./useStoreDashboard-6cfa5bdd-a014cfe4-c8bff8db.js","./shopping-cart-8aca5ef3-095b1616-112594bf.js","./search-566f00ed-c3babbf0-ad60b5b7.js","./circle-check-big-68527463-8ad93454-9bdb44d7.js"],import.meta.url),["./GenericPOSView-65865e30-e48d2479.js","./index-4834c6e1.js","./index-dc19931e.css","./input-977568de-bea10295.js","./badge-34bdff7c-b2c90fce.js","./scroll-area-d0c9b1aa-5d11dc0b.js","./label-6ced007b-31f64b09.js","./useStoreDashboard-6cfa5bdd-a014cfe4.js","./shopping-cart-8aca5ef3-095b1616.js","./search-566f00ed-c3babbf0.js","./circle-check-big-68527463-8ad93454.js"],import.meta.url),["./GenericPOSView-65865e30.js","./index-3101bb07.js","./index-dc19931e.css","./input-977568de.js","./badge-34bdff7c.js","./scroll-area-d0c9b1aa.js","./label-6ced007b.js","./useStoreDashboard-6cfa5bdd.js","./shopping-cart-8aca5ef3.js","./search-566f00ed.js","./circle-check-big-68527463.js"],import.meta.url)),Ea=n.memo(({store:t})=>{const d=[{path:"",label:"Resumen",icon:le,element:e.jsx(pe,{storeId:t.id})},{path:"caja",label:"Caja (POS)",icon:Ie,element:e.jsx(Xe,{useStore:Be,title:"Caja Registradora"})},{path:"inventario",label:"Inventario",icon:K,element:e.jsx(He,{})},{path:"pedidos",label:"Pedidos",icon:se,element:e.jsx(Se,{storeId:t.id})},{path:"importar",label:"Carga Masiva",icon:Me,element:e.jsx(_e,{storeId:t.id,onProductsUploaded:()=>{}})},{path:"finanzas",label:"Finanzas",icon:De,element:e.jsx(qe,{storeId:t.id})},{path:"equipo",label:"Cajeros",icon:Oe,element:e.jsx(Ee,{storeId:t.id})},{path:"configuracion",label:"Ajustes",icon:ze,element:e.jsx(Le,{})}];return e.jsx(me,{store:t,tabs:d})});export{Ea as default};
