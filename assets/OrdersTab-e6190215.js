import{r as m,j as s,U as f,B as t,t as N}from"./index-4020e339.js";import{C as E,a as S,b as D,c as L}from"./card-cc9cfd5e.js";import{B as b}from"./badge-54788017.js";import{D as P,a as k,b as T,c as z,d as _}from"./dialog-d2829896.js";import{S as B,a as $,b as A,c as U,d as n}from"./select-31cdb233.js";import{useStoreDashboard as V}from"./useStoreDashboard-092a1cc0.js";import{L as q}from"./index-a6eb7b0d.js";import{P as H}from"./package-1cc03608.js";import{C as M}from"./clock-f4d06a64.js";import{T as R}from"./truck-45a9dcb6.js";import{M as G}from"./map-pin-865d1b33.js";import"./check-8b5d22b0.js";import"./triangle-alert-30e3235d.js";const is=({storeId:r})=>{var g,j,u;const{orders:o,fetchOrders:x,updateOrderStatus:v,isLoadingOrders:p}=V(),[e,h]=m.useState(null),[C,c]=m.useState(!1);m.useEffect(()=>{r&&x(r)},[r,x]);const l=async(a,i)=>{try{await v(a,i),N({title:"Estado Actualizado",description:`El pedido ahora está: ${i}`}),(e==null?void 0:e.id)===a&&h({...e,status:i})}catch{N({title:"Error",description:"No se pudo actualizar el estado.",variant:"destructive"})}},y=a=>{h(a),c(!0)},w=a=>{const i={Pendiente:"bg-yellow-100 text-yellow-800",Confirmado:"bg-blue-100 text-blue-800","En preparación":"bg-purple-100 text-purple-800","Listo para recogida":"bg-indigo-100 text-indigo-800","En curso":"bg-cyan-100 text-cyan-800",Entregado:"bg-green-100 text-green-800",Cancelado:"bg-red-100 text-red-800"};return s.jsx(b,{variant:"outline",className:`${i[a]||"bg-gray-100"} px-2 py-1`,children:a})};return p&&o.length===0?s.jsx(q,{text:"Cargando pedidos..."}):s.jsxs(E,{className:"animate-in fade-in duration-300",children:[s.jsxs(S,{className:"flex flex-row items-center justify-between",children:[s.jsx(D,{children:"Gestión de Pedidos"}),p&&s.jsx(b,{variant:"secondary",className:"animate-pulse",children:"Actualizando..."})]}),s.jsxs(L,{children:[o.length===0?s.jsxs("div",{className:"text-center py-12",children:[s.jsx(H,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),s.jsx("p",{children:"No tienes pedidos activos."})]}):s.jsx("div",{className:"space-y-4",children:o.map(a=>{var i,d;return s.jsxs("div",{className:"border rounded-lg p-4 flex flex-col md:flex-row justify-between gap-4 items-start md:items-center bg-white hover:bg-slate-50 transition-colors",children:[s.jsxs("div",{className:"flex-grow space-y-1",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs("span",{className:"font-bold text-lg",children:["#",a.id.substring(0,8)]}),w(a.status)]}),s.jsxs("div",{className:"text-sm text-muted-foreground flex items-center gap-4",children:[s.jsxs("span",{className:"flex items-center",children:[s.jsx(f,{className:"h-3 w-3 mr-1"})," ",(i=a.profiles)==null?void 0:i.full_name]}),s.jsxs("span",{className:"flex items-center",children:[s.jsx(M,{className:"h-3 w-3 mr-1"})," ",new Date(a.created_at).toLocaleDateString()]})]}),s.jsxs("div",{className:"text-sm font-medium",children:["Total: $",Number(a.total).toLocaleString()," • Items: ",(d=a.order_items)==null?void 0:d.length]})]}),s.jsxs("div",{className:"flex items-center gap-2 self-end md:self-center",children:[s.jsx(t,{variant:"outline",size:"sm",onClick:()=>y(a),children:"Ver Detalles"}),["Pendiente","Pendiente de pago en efectivo"].includes(a.status)&&s.jsx(t,{size:"sm",onClick:()=>l(a.id,"Confirmado"),children:"Confirmar"}),a.status==="Confirmado"&&s.jsx(t,{size:"sm",onClick:()=>l(a.id,"En preparación"),children:"Preparar"}),a.status==="En preparación"&&s.jsxs(t,{size:"sm",className:"bg-indigo-600 hover:bg-indigo-700 text-white",onClick:()=>l(a.id,"Listo para recogida"),children:[s.jsx(R,{className:"h-4 w-4 mr-2"})," Domiciliario"]})]})]},a.id)})}),s.jsx(P,{open:C,onOpenChange:c,children:s.jsxs(k,{className:"max-w-2xl",children:[s.jsxs(T,{children:[s.jsxs(z,{children:["Pedido #",e==null?void 0:e.id.substring(0,8)]}),s.jsxs(_,{children:["Estado actual: ",s.jsx("span",{className:"font-semibold",children:e==null?void 0:e.status})]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 py-4",children:[s.jsxs("div",{children:[s.jsxs("h4",{className:"font-semibold mb-2 flex items-center",children:[s.jsx(f,{className:"h-4 w-4 mr-2"})," Cliente"]}),s.jsx("p",{className:"text-sm",children:(g=e==null?void 0:e.profiles)==null?void 0:g.full_name}),s.jsx("p",{className:"text-sm",children:((j=e==null?void 0:e.profiles)==null?void 0:j.phone)||"N/A"})]}),s.jsxs("div",{children:[s.jsxs("h4",{className:"font-semibold mb-2 flex items-center",children:[s.jsx(G,{className:"h-4 w-4 mr-2"})," Entrega"]}),s.jsx("p",{className:"text-sm",children:(e==null?void 0:e.delivery_address)||"Recogida en tienda"})]})]}),s.jsxs("div",{className:"border-t pt-4",children:[s.jsx("h4",{className:"font-semibold mb-3",children:"Productos"}),s.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:(u=e==null?void 0:e.order_items)==null?void 0:u.map(a=>{var i;return s.jsxs("div",{className:"flex justify-between items-center text-sm p-2 border rounded",children:[s.jsx("div",{className:"flex items-center gap-3",children:s.jsxs("span",{children:[a.quantity,"x ",(i=a.products)==null?void 0:i.name]})}),s.jsxs("span",{className:"font-medium",children:["$",(a.price*a.quantity).toLocaleString()]})]},a.id)})}),s.jsxs("div",{className:"flex justify-between items-center mt-4 text-lg font-bold",children:[s.jsx("span",{children:"Total"}),s.jsxs("span",{children:["$",Number(e==null?void 0:e.total).toLocaleString()]})]})]}),s.jsxs("div",{className:"flex justify-end gap-2 border-t pt-4",children:[s.jsx(t,{variant:"outline",onClick:()=>c(!1),children:"Cerrar"}),(e==null?void 0:e.status)!=="Cancelado"&&(e==null?void 0:e.status)!=="Entregado"&&s.jsxs(B,{onValueChange:a=>l(e.id,a),children:[s.jsx($,{className:"w-[180px]",children:s.jsx(A,{placeholder:"Cambiar Estado"})}),s.jsxs(U,{children:[s.jsx(n,{value:"Confirmado",children:"Confirmar"}),s.jsx(n,{value:"En preparación",children:"En preparación"}),s.jsx(n,{value:"Listo para recogida",children:"Listo para recogida"}),s.jsx(n,{value:"Entregado",children:"Entregado"}),s.jsx(n,{value:"Cancelado",children:"Cancelar Pedido"})]})]})]})]})})]})]})};export{is as default};
