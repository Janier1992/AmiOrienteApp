import{f as _,r as c,j as e,h as x,K as R,B as v,a0 as M,t as d,e as P}from"./index-e56a20f4.js";import{C as U,a as B,b as H,c as V}from"./card-5b190897.js";import{U as k}from"./upload-f9e6ce2f.js";import{C as z}from"./circle-alert-28b3f54c.js";/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],L=_("file-text",G),q=R("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),A=c.forwardRef(({className:i,variant:o,...s},m)=>e.jsx("div",{ref:m,role:"alert",className:x(q({variant:o}),i),...s}));A.displayName="Alert";const D=c.forwardRef(({className:i,...o},s)=>e.jsx("h5",{ref:s,className:x("mb-1 font-medium leading-none tracking-tight",i),...o}));D.displayName="AlertTitle";const F=c.forwardRef(({className:i,...o},s)=>e.jsx("div",{ref:s,className:x("text-sm [&_p]:leading-relaxed",i),...o}));F.displayName="AlertDescription";const J=({onProductsUploaded:i,storeId:o})=>{const[s,m]=c.useState(null),[h,f]=c.useState(!1),[g,b]=c.useState([]),S=a=>{if(a.target.files&&a.target.files[0]){const t=a.target.files[0];t.type==="text/csv"||t.name.endsWith(".csv")?(m(t),E(t)):d({title:"Formato incorrecto",description:"Por favor, sube un archivo .csv",variant:"destructive"})}},E=a=>{const t=new FileReader;t.onload=r=>{const n=r.target.result.split(`
`).slice(1).filter(l=>l.trim()!=="").slice(0,3);b(n)},t.readAsText(a)},I=()=>{const t=encodeURI(`data:text/csv;charset=utf-8,name,description,price,category,stock,discount
Ejemplo Producto,Descripción del producto,15000,General,50,0`),r=document.createElement("a");r.setAttribute("href",t),r.setAttribute("download","plantilla_inventario.csv"),document.body.appendChild(r),r.click(),document.body.removeChild(r)},T=async()=>{if(!s||!o)return;f(!0);const a=new FileReader;a.onload=async t=>{try{const j=t.target.result.split(`
`).slice(1),n=[];for(const l of j){if(l.trim()==="")continue;const[y,u,N,p,w,C]=l.split(",");y&&N&&w&&n.push({store_id:o,name:y.trim(),description:(u==null?void 0:u.trim())||"",price:parseFloat(N)||0,category:(p==null?void 0:p.trim())||"General",stock:parseInt(w,10)||0,discount:C?parseFloat(C):0,product_type:"physical",requires_shipping:!0,created_at:new Date().toISOString()})}if(n.length>0){const{error:l}=await P.from("products").insert(n);l?d({title:"Error en la carga",description:l.message,variant:"destructive"}):(d({title:"¡Carga Exitosa!",description:`${n.length} productos han sido añadidos a tu inventario.`,className:"bg-green-50 border-green-200 text-green-800"}),i&&i(),m(null),b([]))}else d({title:"Archivo vacío",description:"No se encontraron datos válidos.",variant:"destructive"})}catch{d({title:"Error al procesar",description:"El archivo no tiene el formato correcto.",variant:"destructive"})}finally{f(!1)}},a.readAsText(s)};return e.jsxs(U,{children:[e.jsxs(B,{children:[e.jsxs(H,{className:"flex items-center gap-2",children:[e.jsx(k,{className:"h-5 w-5 text-primary"}),"Importación Masiva de Inventario"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Sube tu inventario completo usando un archivo Excel (.csv)."})]}),e.jsxs(V,{className:"space-y-6",children:[e.jsxs(A,{className:"bg-blue-50 border-blue-200",children:[e.jsx(z,{className:"h-4 w-4 text-blue-600"}),e.jsx(D,{className:"text-blue-800",children:"Instrucciones"}),e.jsxs(F,{className:"text-blue-700 text-sm mt-1",children:["1. Descarga la plantilla de ejemplo.",e.jsx("br",{}),"2. Llena los datos de tus productos.",e.jsx("br",{}),"3. Guarda el archivo como .CSV.",e.jsx("br",{}),"4. Sube el archivo aquí."]})]}),e.jsxs("div",{className:"flex flex-col items-center justify-center border-2 border-dashed border-gray-200 rounded-lg p-8 bg-gray-50/50 hover:bg-gray-50 transition-colors",children:[e.jsx(k,{className:"h-10 w-10 text-gray-400 mb-4"}),e.jsxs("div",{className:"flex gap-4 mb-4",children:[e.jsxs("label",{htmlFor:"file-upload",className:"cursor-pointer",children:[e.jsx(v,{variant:"outline",className:"pointer-events-none",tabIndex:-1,children:"Seleccionar Archivo"}),e.jsx("input",{id:"file-upload",type:"file",className:"hidden",accept:".csv",onChange:S})]}),e.jsxs(v,{variant:"ghost",onClick:I,className:"text-primary hover:text-primary/90",children:[e.jsx(M,{className:"mr-2 h-4 w-4"})," Descargar Plantilla"]})]}),s&&e.jsxs("div",{className:"w-full max-w-sm bg-white p-4 rounded border shadow-sm mt-4",children:[e.jsxs("div",{className:"flex items-center gap-2 font-medium text-sm mb-2",children:[e.jsx(L,{className:"h-4 w-4 text-blue-500"}),s.name]}),g.length>0&&e.jsx("div",{className:"text-xs text-gray-500 bg-gray-100 p-2 rounded font-mono",children:g.map((a,t)=>e.jsx("div",{className:"truncate",children:a},t))})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(v,{onClick:T,disabled:!s||h,className:"w-full sm:w-auto",children:h?"Procesando...":"Importar Productos"})})]})]})};export{J as BulkUploadTab,J as default};
