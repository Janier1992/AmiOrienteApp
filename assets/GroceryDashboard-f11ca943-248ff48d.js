import{S as J,u as X,w as R,T as Y,b as n,U as Q,V as Z,y as e,$ as F,a0 as z,a5 as W,l as O,Z as ee,t as re,Y as se,x as N,F as te,X as ae,q as oe,i as ie,H as ce,J as ne,_ as E}from"./index-4834c6e1.js";import{R as de,_ as le}from"./BaseStoreDashboard-9ad5c13e-d7a1a933.js";import{s as A,u as me}from"./useStoreDashboard-6cfa5bdd-a014cfe4.js";import ue from"./OverviewTab-a01a807a-07dd1735.js";import{l as _}from"./input-977568de-bea10295.js";import{k as pe,O as he,V as xe,I as fe,M as je}from"./select-03f52418-c5111b6c.js";import{u as q}from"./label-6ced007b-31f64b09.js";import"./textarea-03a75c76-69040bf5.js";import{h as be,z as ge}from"./index-e23a302d-1b9287b5.js";import{t as ye}from"./check-78166ef5-9630779a.js";import{d as ve}from"./badge-34bdff7c-b2c90fce.js";import{r as ke,d as Ne,c as D,f as C,m as we,i as P}from"./table-d515a05c-fec441de.js";import{r as K}from"./shopping-cart-8aca5ef3-095b1616.js";import{o as Ce}from"./search-566f00ed-c3babbf0.js";import{c as Pe}from"./pencil-b145156d-81e39600.js";import Se from"./OrdersManagementTab-74307886-48065a75.js";import{B as _e}from"./BulkUploadTab-0fe3efc4-824a62de.js";import qe from"./FinancialsTab-e07ef4f8-cb7c3ea0.js";import $e from"./AdminTab-1ef2bbd0-38fe81f3.js";import Ee from"./ProfileTab-fd4f3500-9e2db3bd.js";import{c as Ie}from"./credit-card-bcc8ac59-e0a7eb79.js";import{t as Le}from"./upload-8259cec2-21216fe4.js";import{a as Me,n as Re}from"./settings-96af137d-f461a4db.js";import{r as ze}from"./users-93d0d9a2-82ed9403.js";import"./Helmet-d9a99439-17d17245.js";import"./log-out-1de3e3ee-53ee1d6f.js";import"./index-6c60542e-1f0cc56c.js";import"./triangle-alert-5ea4272b-316ec065.js";import"./package-99b0a55c-785e5cf1.js";import"./trending-up-147c55bb-4628ab85.js";import"./clock-0a32af33-121834d9.js";import"./truck-a0071c63-090d128d.js";import"./map-pin-4396fd6c-98f8e615.js";import"./circle-alert-58769497-aeae36dd.js";import"./user-plus-74362f50-3e37ce73.js";/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oe=[["path",{d:"M3 5v14",key:"1nt18q"}],["path",{d:"M8 5v14",key:"1ybrkv"}],["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"M17 5v14",key:"ycjyhj"}],["path",{d:"M21 5v14",key:"nzette"}]],Ae=J("barcode",Oe),De=X((s,d)=>({products:[],cart:[],isLoadingProducts:!1,isLoadingCheckout:!1,error:null,fetchProducts:async a=>{s({isLoadingProducts:!0});try{const i=await A.obtenerProductos(a);s({products:i||[]})}catch(i){s({error:i.message})}finally{s({isLoadingProducts:!1})}},addToCart:a=>{const i=d().cart,l=i.find(t=>t.id===a.id);return s(l?{cart:i.map(t=>t.id===a.id?{...t,qty:t.qty+1}:t)}:{cart:[...i,{...a,qty:1}]}),!0},removeFromCart:a=>s(i=>({cart:i.cart.filter(l=>l.id!==a)})),updateCartQty:(a,i)=>s(l=>({cart:l.cart.map(t=>t.id===a?{...t,qty:Math.max(1,t.qty+i)}:t)})),clearCart:()=>s({cart:[]}),processCheckout:async(a,i,l,t)=>{const m=d().cart;if(m.length===0)return;const p=typeof i=="object"?{...i,method:l,type:"POS"}:{name:i,method:l,type:"POS"};s({isLoadingCheckout:!0});try{const{data:f,error:h}=await R.from("orders").insert({store_id:a,customer_id:null,status:"Entregado",total:t,delivery_address:JSON.stringify({guest:p,items:m.map(o=>({id:o.id,name:o.name,qty:o.qty,price:o.price}))})}).select().single();if(h)throw h;const j=m.map(o=>({order_id:f.id,product_id:o.id,quantity:o.qty,price:o.price})),{error:b}=await R.from("order_items").insert(j);if(b)throw b;for(const o of m)o.stock!==void 0&&await A.actualizarProducto(o.id,{stock:Math.max(0,o.stock-o.qty)});return d().clearCart(),!0}catch(f){throw f}finally{s({isLoadingCheckout:!1})}}}));var L="Checkbox",[Fe,qr]=Y(L),[Ke,Ve]=Fe(L),V=n.forwardRef((s,d)=>{const{__scopeCheckbox:a,name:i,checked:l,defaultChecked:t,required:m,disabled:p,value:f="on",onCheckedChange:h,form:j,...b}=s,[o,w]=n.useState(null),c=Q(d,u=>w(u)),x=n.useRef(!1),$=o?j||!!o.closest("form"):!0,[g=!1,S]=Z({prop:l,defaultProp:t,onChange:h}),I=n.useRef(g);return n.useEffect(()=>{const u=o==null?void 0:o.form;if(u){const v=()=>S(I.current);return u.addEventListener("reset",v),()=>u.removeEventListener("reset",v)}},[o,S]),e.jsxs(Ke,{scope:a,state:g,disabled:p,children:[e.jsx(F.button,{type:"button",role:"checkbox","aria-checked":y(g)?"mixed":g,"aria-required":m,"data-state":G(g),"data-disabled":p?"":void 0,disabled:p,value:f,...b,ref:c,onKeyDown:z(s.onKeyDown,u=>{u.key==="Enter"&&u.preventDefault()}),onClick:z(s.onClick,u=>{S(v=>y(v)?!0:!v),$&&(x.current=u.isPropagationStopped(),x.current||u.stopPropagation())})}),$&&e.jsx(Ue,{control:o,bubbles:!x.current,name:i,value:f,checked:g,required:m,disabled:p,form:j,style:{transform:"translateX(-100%)"},defaultChecked:y(t)?!1:t})]})});V.displayName=L;var U="CheckboxIndicator",B=n.forwardRef((s,d)=>{const{__scopeCheckbox:a,forceMount:i,...l}=s,t=Ve(U,a);return e.jsx(W,{present:i||y(t.state)||t.state===!0,children:e.jsx(F.span,{"data-state":G(t.state),"data-disabled":t.disabled?"":void 0,...l,ref:d,style:{pointerEvents:"none",...s.style}})})});B.displayName=U;var Ue=s=>{const{control:d,checked:a,bubbles:i=!0,defaultChecked:l,...t}=s,m=n.useRef(null),p=be(a),f=ge(d);n.useEffect(()=>{const j=m.current,b=window.HTMLInputElement.prototype,o=Object.getOwnPropertyDescriptor(b,"checked").set;if(p!==a&&o){const w=new Event("click",{bubbles:i});j.indeterminate=y(a),o.call(j,y(a)?!1:a),j.dispatchEvent(w)}},[p,a,i]);const h=n.useRef(y(a)?!1:a);return e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:l??h.current,...t,tabIndex:-1,ref:m,style:{...s.style,...f,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function y(s){return s==="indeterminate"}function G(s){return y(s)?"indeterminate":s?"checked":"unchecked"}var H=V,Be=B;const Ge=n.forwardRef(({className:s,...d},a)=>e.jsx(H,{ref:a,className:O("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",s),...d,children:e.jsx(Be,{className:O("flex items-center justify-center text-current"),children:e.jsx(ye,{className:"h-4 w-4"})})}));Ge.displayName=H.displayName;const He=()=>{const{products:s,fetchProducts:d,addProduct:a,updateProduct:i,deleteProduct:l,store:t}=me(),[m,p]=n.useState(""),[f,h]=n.useState(!1),[j,b]=n.useState(!1),[o,w]=n.useState(null),[c,x]=n.useState({name:"",price:"",stock:"",description:"",category:"Abarrotes",sku:"",image_url:""});n.useEffect(()=>{t!=null&&t.id&&d(t.id)},[t==null?void 0:t.id,d]);const $=s.filter(r=>r.name.toLowerCase().includes(m.toLowerCase())||r.sku&&r.sku.includes(m)),g=["Abarrotes","Lácteos","Carnes","Frutas/Verduras","Limpieza","Bebidas","Cuidado Personal"],S=()=>{w(null),x({name:"",price:"",stock:"50",description:"",category:"Abarrotes",sku:"",image_url:""}),h(!0)},I=r=>{w(r),x({name:r.name,price:r.price,stock:r.stock,description:r.description||"",category:r.category||"Abarrotes",sku:r.sku||"",image_url:r.image_url||""}),h(!0)},u=async(r,k)=>{try{await i(r.id,{stock:parseInt(k)}),E({title:"Stock actualizado"})}catch{}},v=async r=>{r.preventDefault(),b(!0);try{const k={name:c.name,price:parseFloat(c.price),stock:parseInt(c.stock),sku:c.sku,description:c.sku?`${c.description}

SKU:${c.sku}`:c.description,category:c.category,store_id:t==null?void 0:t.id,product_type:"physical",requires_shipping:!0};o?(await i(o.id,k),E({title:"Producto actualizado"})):(await a(k),E({title:"Producto registrado"})),h(!1)}catch{E({title:"Error",variant:"destructive"})}finally{b(!1)}},T=async r=>{confirm("¿Eliminar producto?")&&await l(r)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-emerald-50 border border-emerald-100 p-6 rounded-t-xl flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-emerald-900 flex items-center gap-2",children:[e.jsx(K,{className:"h-8 w-8 text-emerald-600"}),"Inventario Máster"]}),e.jsx("p",{className:"text-emerald-700",children:"Gestión masiva de referencias, precios y existencias."})]}),e.jsxs(N,{className:"bg-emerald-700 hover:bg-emerald-800",onClick:S,children:[e.jsx(te,{className:"h-4 w-4 mr-2"})," Nuevo Producto"]})]}),e.jsxs("div",{className:"flex gap-4 items-center bg-white p-2 border-b",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Ce,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(_,{placeholder:"Buscar por nombre, código de barras...",className:"pl-10",value:m,onChange:r=>p(r.target.value)})]}),e.jsxs(N,{variant:"outline",children:[e.jsx(Ae,{className:"h-4 w-4 mr-2"})," Escanear"]})]}),e.jsx("div",{className:"bg-white border rounded-lg overflow-hidden shadow-sm",children:e.jsxs(ke,{children:[e.jsx(Ne,{children:e.jsxs(D,{className:"bg-gray-50",children:[e.jsx(C,{className:"w-[100px]",children:"Código/SKU"}),e.jsx(C,{children:"Producto"}),e.jsx(C,{children:"Categoría"}),e.jsx(C,{className:"text-right",children:"Precio"}),e.jsx(C,{className:"text-center w-[150px]",children:"Stock"}),e.jsx(C,{className:"text-right",children:"Acciones"})]})}),e.jsx(we,{children:$.map(r=>{var k,M;return e.jsxs(D,{children:[e.jsx(P,{className:"font-mono text-xs text-gray-500",children:r.sku||((M=(k=r.description)==null?void 0:k.match(/SKU:(\w+)/))==null?void 0:M[1])||"---"}),e.jsx(P,{className:"font-medium text-slate-800",children:r.name}),e.jsx(P,{children:e.jsx(ve,{variant:"outline",className:"font-normal",children:r.category})}),e.jsxs(P,{className:"text-right font-bold text-emerald-700",children:["$",Number(r.price).toLocaleString()]}),e.jsx(P,{className:"text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(N,{variant:"ghost",className:"h-6 w-6 rounded-full p-0",onClick:()=>u(r,Math.max(0,r.stock-1)),children:"-"}),e.jsx("span",{className:"w-8 text-center",children:r.stock}),e.jsx(N,{variant:"ghost",className:"h-6 w-6 rounded-full p-0",onClick:()=>u(r,r.stock+1),children:"+"})]})}),e.jsxs(P,{className:"text-right",children:[e.jsx(N,{variant:"ghost",size:"sm",onClick:()=>I(r),children:e.jsx(Pe,{className:"h-4 w-4 text-blue-500"})}),e.jsx(N,{variant:"ghost",size:"sm",onClick:()=>T(r.id),children:e.jsx(ae,{className:"h-4 w-4 text-red-500"})})]})]},r.id)})})]})}),e.jsx(oe,{open:f,onOpenChange:h,children:e.jsxs(ie,{children:[e.jsx(ce,{children:e.jsx(ne,{children:"Producto de Supermercado"})}),e.jsxs("form",{onSubmit:v,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2 col-span-2",children:[e.jsx(q,{children:"Nombre Producto"}),e.jsx(_,{value:c.name,onChange:r=>x({...c,name:r.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{children:"Código Barras / SKU"}),e.jsx(_,{value:c.sku,onChange:r=>x({...c,sku:r.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{children:"Categoría"}),e.jsxs(pe,{value:c.category,onValueChange:r=>x({...c,category:r}),children:[e.jsx(he,{children:e.jsx(xe,{})}),e.jsx(fe,{children:g.map(r=>e.jsx(je,{value:r,children:r},r))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{children:"Precio"}),e.jsx(_,{type:"number",value:c.price,onChange:r=>x({...c,price:r.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{children:"Stock Inicial"}),e.jsx(_,{type:"number",value:c.stock,onChange:r=>x({...c,stock:r.target.value}),required:!0})]})]}),e.jsx(N,{type:"submit",className:"w-full bg-emerald-600 hover:bg-emerald-700",disabled:j,children:"Guardar"})]})]})})]})},Te=n.lazy(()=>ee(()=>re(()=>import("./GenericPOSView-65865e30-e48d2479.js"),["./GenericPOSView-65865e30-e48d2479.js","./index-4834c6e1.js","./index-dc19931e.css","./input-977568de-bea10295.js","./badge-34bdff7c-b2c90fce.js","./scroll-area-d0c9b1aa-5d11dc0b.js","./label-6ced007b-31f64b09.js","./useStoreDashboard-6cfa5bdd-a014cfe4.js","./shopping-cart-8aca5ef3-095b1616.js","./search-566f00ed-c3babbf0.js","./circle-check-big-68527463-8ad93454.js"],import.meta.url),["./GenericPOSView-65865e30.js","./index-3101bb07.js","./index-dc19931e.css","./input-977568de.js","./badge-34bdff7c.js","./scroll-area-d0c9b1aa.js","./label-6ced007b.js","./useStoreDashboard-6cfa5bdd.js","./shopping-cart-8aca5ef3.js","./search-566f00ed.js","./circle-check-big-68527463.js"],import.meta.url)),$r=n.memo(({store:s})=>{const d=[{path:"",label:"Resumen",icon:de,element:e.jsx(ue,{storeId:s.id})},{path:"caja",label:"Caja (POS)",icon:Ie,element:e.jsx(Te,{useStore:De,title:"Caja Registradora"})},{path:"inventario",label:"Inventario",icon:K,element:e.jsx(He,{})},{path:"pedidos",label:"Pedidos",icon:se,element:e.jsx(Se,{storeId:s.id})},{path:"importar",label:"Carga Masiva",icon:Le,element:e.jsx(_e,{storeId:s.id,onProductsUploaded:()=>{}})},{path:"finanzas",label:"Finanzas",icon:Me,element:e.jsx(qe,{storeId:s.id})},{path:"equipo",label:"Cajeros",icon:ze,element:e.jsx($e,{storeId:s.id})},{path:"configuracion",label:"Ajustes",icon:Re,element:e.jsx(Ee,{})}];return e.jsx(le,{store:s,tabs:d})});export{$r as default};
