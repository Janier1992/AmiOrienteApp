import{E as C,M as te,D as re,Q as ae,f as x,k as p,N as g,y as e,W as R,x as j,G as ie,p as le,S as L,s as ne,a as y,b as w,c as _,o as S,d as k,H as oe,B as D,m as V,F as de,Z as G,n as H,I as U,T as F,P as W,g as ce,R as me}from"./index-87ab05f1.js";import{K as xe}from"./Helmet-d9a99439-17d17245-80416325-0a82370e-5a6bde15.js";import{e as ue}from"./log-out-1de3e3ee-53ee1d6f-be22ed5f-31659d2d-18bff071.js";import{e as Z}from"./map-pin-4396fd6c-98f8e615-be2face5-18973d83-0f5a17cb.js";import{y as B}from"./credit-card-bcc8ac59-e0a7eb79-9e00e665-407b30eb-fd4bd701.js";import{r as Q}from"./star-228904cf-a4a173ca-0fd05dd1-af89d176-898657de.js";import{d as he}from"./badge-34bdff7c-b2c90fce-efd43af8-f7a84e83-2020d777.js";import{P as pe,k as fe,$ as I,V as A}from"./tabs-60a3e460-388ba4b9-0edee604-4ea2a7bb-c8aa8d8a.js";import{P as je,b as q,L as ge,z as ve,T as P,M as z,X as be,l as Ne,a as ye}from"./TileLayer-164134ad-df0d834a-6bb097bb-bdcec7e8-1e611d18.js";import{p as X}from"./package-99b0a55c-785e5cf1-bac652b0-c1d00408-aa7462ee.js";import{a as O}from"./truck-a0071c63-090d128d-9cfc595e-b33772c3-de5cb612.js";import{m as we}from"./circle-x-27d4e477-36967287-d1c6dd24-20fb8d85-c3392906.js";import{p as _e}from"./circle-check-big-68527463-8ad93454-9bdb44d7-ad5a0975-66385ab6.js";import{e as ke}from"./clock-0a32af33-121834d9-4cd0de5d-d758c7ab-1bf2afff.js";import{a as E}from"./input-977568de-bea10295-4adb3258-368f21ef-dd0395aa.js";import{e as Ce}from"./shopping-cart-8aca5ef3-095b1616-112594bf-3a6e2763-072beeee.js";import{k as Ee}from"./check-78166ef5-9630779a-ee565adf-12fad7f6-47c88872.js";import{l as Se}from"./textarea-03a75c76-69040bf5-35a9782e-8e0ca7dd-b23a1c90.js";/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Me=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]],K=C("bell",Me);/**
* @license lucide-react v0.561.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const $e=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],Pe=C("copy",$e);/**
* @license lucide-react v0.561.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const ze=[["path",{d:"M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5",key:"mvr1a0"}]],J=C("heart",ze);/**
* @license lucide-react v0.561.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const De=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],qe=C("info",De);/**
* @license lucide-react v0.561.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const Te=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],Le=C("shield-check",Te);/**
* @license lucide-react v0.561.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const Ie=[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]],Ae=C("tag",Ie);/**
* @license lucide-react v0.561.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const Oe=[["path",{d:"M2 9a3 3 0 0 1 0 6v2a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-2a3 3 0 0 1 0-6V7a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z",key:"qn84l0"}],["path",{d:"M13 5v2",key:"dyzc3o"}],["path",{d:"M13 17v2",key:"1ont0d"}],["path",{d:"M13 11v2",key:"1wjjxi"}]],Y=C("ticket",Oe),Re=je(function({positions:s,...r},o){const n=new be.Polyline(s,r);return Ne(n,ye(o,{overlayContainer:n}))},function(s,r,o){r.positions!==o.positions&&s.setLatLngs(r.positions)}),Ve=({profile:s,activeTab:r,onTabChange:o,onLogout:n,onHome:d,isOpen:h,onClose:m})=>{const a=[{id:"pedidos",label:"Mis Pedidos",icon:ce},{id:"perfil",label:"Mi Perfil",icon:L},{id:"deseos",label:"Lista de Deseos",icon:J},{id:"direcciones",label:"Mis Direcciones",icon:Z},{id:"pagos",label:"Métodos de Pago",icon:B},{id:"notificaciones",label:"Notificaciones",icon:K},{id:"resenas",label:"Reseñas",icon:Q},{id:"cupones",label:"Cupones",icon:Y}];return e.jsxs(e.Fragment,{children:[h&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-40 md:hidden backdrop-blur-sm transition-opacity",onClick:m}),e.jsx("aside",{className:`
          fixed md:relative top-0 left-0 z-50 h-full w-64 bg-card text-card-foreground border-r border-border shrink-0
          transform transition-transform duration-300 ease-in-out md:transform-none shadow-lg md:shadow-none
          ${h?"translate-x-0":"-translate-x-full"}
        `,children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"p-6 border-b border-border relative",children:[e.jsx(j,{variant:"ghost",size:"icon",className:"absolute top-2 right-2 md:hidden",onClick:m,children:e.jsx(le,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex flex-col items-center text-center mt-2 md:mt-0",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-primary/10 flex items-center justify-center mb-4 text-primary",children:e.jsx(L,{className:"h-10 w-10"})}),e.jsx("h2",{className:"text-lg font-bold truncate w-full px-2",children:(s==null?void 0:s.full_name)||"Usuario"}),e.jsx("p",{className:"text-xs text-muted-foreground truncate w-full px-2",children:s==null?void 0:s.email})]})]}),e.jsx("div",{className:"p-4 space-y-1 overflow-y-auto flex-1",children:a.map(t=>{const i=t.icon,u=r===t.id;return e.jsxs(j,{variant:u?"secondary":"ghost",className:`w-full justify-start ${u?"bg-primary/10 text-primary":""}`,onClick:()=>{o(t.id),m()},children:[e.jsx(i,{className:"mr-2 h-4 w-4 shrink-0"}),t.label]},t.id)})}),e.jsxs("div",{className:"p-4 border-t border-border space-y-2 bg-muted/20",children:[e.jsxs(j,{variant:"outline",className:"w-full justify-start",onClick:d,children:[e.jsx(ne,{className:"mr-2 h-4 w-4 shrink-0"})," Volver al inicio"]}),e.jsxs(j,{variant:"destructive",className:"w-full justify-start",onClick:n,children:[e.jsx(ue,{className:"mr-2 h-4 w-4 shrink-0"})," Salir"]})]})]})})]})},Ge=({order:s,isOpen:r,onClose:o})=>{var n;return e.jsx(V,{open:r,onOpenChange:o,children:e.jsxs(H,{children:[e.jsxs(U,{children:[e.jsxs(F,{children:["Detalles del Pedido #",s==null?void 0:s.id.substring(0,8)]}),e.jsxs(me,{children:["Realizado el ",new Date(s==null?void 0:s.created_at).toLocaleString()," en ",(n=s==null?void 0:s.stores)==null?void 0:n.name,"."]})]}),e.jsx("div",{className:"space-y-4 max-h-[60vh] overflow-y-auto pr-2",children:s==null?void 0:s.order_items.map(d=>{var h,m,a;return e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("img",{src:((h=d.products)==null?void 0:h.image_url)||"https://placehold.co/64",alt:(m=d.products)==null?void 0:m.name,className:"w-16 h-16 rounded-md object-cover"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:(a=d.products)==null?void 0:a.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Cantidad: ",d.quantity]})]})]}),e.jsxs("p",{className:"font-semibold",children:["$",(d.price*d.quantity).toLocaleString()]})]},d.id)})}),e.jsx(W,{className:"pt-4 border-t",children:e.jsxs("div",{className:"w-full flex justify-between font-bold text-lg",children:[e.jsx("span",{children:"Total del Pedido:"}),e.jsxs("span",{children:["$",Number(s==null?void 0:s.total).toLocaleString()]})]})})]})})};delete q.Icon.Default.prototype._getIconUrl;q.Icon.Default.mergeOptions({iconRetinaUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-2x.png",iconUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png"});const He=new q.Icon({iconUrl:"https://cdn-icons-png.flaticon.com/512/3448/3448620.png",iconSize:[35,35],iconAnchor:[17,35],popupAnchor:[0,-35]}),Ue=({delivery:s})=>{const[r,o]=x.useState(null);if(x.useEffect(()=>{if(!s||!s.delivery_person_id)return;(async()=>{const{data:i,error:u}=await p.from("delivery_locations").select("*").eq("delivery_person_id",s.delivery_person_id).single();i&&o({lat:i.lat,lng:i.lng})})();const t=p.channel(`delivery-location-${s.delivery_person_id}`).on("postgres_changes",{event:"*",schema:"public",table:"delivery_locations",filter:`delivery_person_id=eq.${s.delivery_person_id}`},i=>{o({lat:i.new.lat,lng:i.new.lng})}).subscribe();return()=>{p.removeChannel(t)}},[s]),!(s!=null&&s.delivery_coords)||!(s!=null&&s.pickup_coords))return e.jsx("div",{className:"text-center text-sm text-gray-500",children:"No hay información de ubicación disponible para este pedido."});const n=[s.pickup_coords[0],s.pickup_coords[1]],d=[s.delivery_coords[0],s.delivery_coords[1]],h=r?[r.lat,r.lng]:null,m=h||d,a=h?[h,d]:[];return e.jsx("div",{className:"h-64 w-full rounded-lg overflow-hidden border",children:e.jsxs(ge,{center:m,zoom:14,scrollWheelZoom:!1,style:{height:"100%",width:"100%"},children:[e.jsx(ve,{attribution:'© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),e.jsx(P,{position:n,children:e.jsx(z,{children:"Punto de Recogida"})}),e.jsx(P,{position:d,children:e.jsx(z,{children:"Tu Ubicación"})}),h&&e.jsx(P,{position:h,icon:He,children:e.jsx(z,{children:"Domiciliario"})}),a.length>0&&e.jsx(Re,{pathOptions:{color:"blue"},positions:a})]})})},Fe=({orders:s})=>{const[r,o]=x.useState(null),n=s.filter(t=>["Pendiente","Pendiente de pago en efectivo","En curso"].includes(t.status)),d=s.filter(t=>["Entregado","Cancelado"].includes(t.status)),h=t=>{switch(t){case"Pendiente":case"Pendiente de pago en efectivo":return{icon:e.jsx(ke,{className:"h-4 w-4"}),color:"bg-yellow-100 text-yellow-800",text:"Preparando"};case"En curso":return{icon:e.jsx(O,{className:"h-4 w-4"}),color:"bg-blue-100 text-blue-800",text:"En Camino"};case"Entregado":return{icon:e.jsx(_e,{className:"h-4 w-4"}),color:"bg-green-100 text-green-800",text:"Entregado"};default:return{icon:e.jsx(we,{className:"h-4 w-4"}),color:"bg-red-100 text-red-800",text:t}}},m=t=>{const i=new Date(t);return new Date(i.getTime()+45*6e4).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})},a=({order:t,isActive:i})=>{var u,c;const l=h(t.status);return e.jsxs("div",{className:"border rounded-lg p-5 bg-card hover:bg-accent/5 transition-colors cursor-pointer",onClick:()=>o(t),children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-4",children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center shrink-0 ${l.color}`,children:l.icon}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"font-bold text-lg",children:(u=t.stores)==null?void 0:u.name}),e.jsx(he,{variant:"outline",className:"text-xs",children:l.text})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Pedido #",t.id.substring(0,8)," • ",new Date(t.created_at).toLocaleDateString()]}),e.jsxs("p",{className:"font-medium mt-1 text-primary",children:[((c=t.order_items)==null?void 0:c.length)||0," productos • $",Number(t.total).toLocaleString()]})]})]}),i&&t.status==="En curso"&&e.jsxs("div",{className:"text-right flex flex-col justify-center",children:[e.jsx("span",{className:"text-xs text-muted-foreground uppercase tracking-wide",children:"Entrega Estimada"}),e.jsx("span",{className:"text-2xl font-bold text-blue-600",children:m(t.created_at)})]})]}),i&&t.status==="En curso"&&t.deliveries&&e.jsxs("div",{className:"mt-6 border-t pt-4",children:[e.jsxs("p",{className:"text-xs font-bold text-muted-foreground uppercase mb-3 flex items-center gap-2",children:[e.jsx(O,{className:"h-3 w-3"})," Rastreo en Tiempo Real"]}),e.jsx(Ue,{delivery:t.deliveries})]})]})};return e.jsxs(y,{className:"border-none shadow-none",children:[e.jsxs(w,{className:"px-0 pt-0",children:[e.jsx(_,{className:"text-2xl",children:"Mis Pedidos"}),e.jsx(S,{children:"Rastrea tus envíos y revisa tu historial."})]}),e.jsx(k,{className:"px-0",children:e.jsxs(pe,{defaultValue:"activos",className:"w-full",children:[e.jsxs(fe,{className:"grid w-full grid-cols-2 mb-6",children:[e.jsxs(I,{value:"activos",children:["En Curso (",n.length,")"]}),e.jsxs(I,{value:"historial",children:["Historial (",d.length,")"]})]}),e.jsx(A,{value:"activos",className:"space-y-4",children:n.length===0?e.jsxs("div",{className:"text-center py-12 border-2 border-dashed rounded-xl",children:[e.jsx(X,{className:"h-12 w-12 mx-auto text-muted-foreground mb-3 opacity-20"}),e.jsx("p",{className:"text-muted-foreground",children:"No tienes pedidos activos en este momento."}),e.jsx(j,{variant:"link",className:"mt-2 text-primary",children:"Ir a comprar"})]}):n.map(t=>e.jsx(a,{order:t,isActive:!0},t.id))}),e.jsx(A,{value:"historial",className:"space-y-4",children:d.map(t=>e.jsx(a,{order:t,isActive:!1},t.id))})]})}),r&&e.jsx(Ge,{order:r,isOpen:!!r,onClose:()=>o(null)})]})},We=({profile:s,onInputChange:r,onProfileUpdate:o})=>e.jsxs(y,{children:[e.jsx(w,{children:e.jsx(_,{children:"Mi Perfil"})}),e.jsx(k,{children:e.jsxs("form",{onSubmit:o,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nombre"}),e.jsx(E,{name:"full_name",value:s.full_name,onChange:r})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),e.jsx(E,{name:"email",type:"email",value:s.email,onChange:r,readOnly:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Teléfono"}),e.jsx(E,{name:"phone",type:"tel",value:s.phone,onChange:r})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Dirección de Entrega"}),e.jsx(E,{name:"address",type:"text",value:s.address,onChange:r,placeholder:"Ej: Calle 123 #45-67, Apto 890"})]}),e.jsx(j,{type:"submit",children:"Guardar Cambios"})]})})]}),Ze=({userId:s})=>{const[r,o]=x.useState([]),[n,d]=x.useState(!0),{addToCart:h}=oe();x.useEffect(()=>{m()},[s]);const m=async()=>{try{const{data:i,error:u}=await p.from("wishlist").select(`
          id,
          products (
            id, name, price, image_url, description, stock, store_id, stores(name)
          )
        `).eq("user_id",s);if(u)throw u;o(i||[])}catch(i){console.error("Error fetching wishlist:",i)}finally{d(!1)}},a=async i=>{try{const{error:u}=await p.from("wishlist").delete().eq("id",i);if(u)throw u;o(r.filter(c=>c.id!==i)),g({title:"Eliminado",description:"Producto eliminado de la lista de deseos."})}catch{g({variant:"destructive",title:"Error",description:"No se pudo eliminar el producto."})}},t=i=>{h(i,1),g({title:"Agregado",description:"Producto agregado al carrito."})};return n?e.jsx("div",{className:"flex justify-center p-8",children:e.jsx(R,{className:"animate-spin"})}):e.jsxs(y,{children:[e.jsxs(w,{children:[e.jsx(_,{children:"Mi Lista de Deseos"}),e.jsx(S,{children:"Guarda tus productos favoritos para después."})]}),e.jsx(k,{children:r.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(J,{className:"h-12 w-12 mx-auto mb-4 opacity-20"}),e.jsx("p",{children:"No tienes productos guardados aún."})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:r.map(i=>{var u;const c=i.products;return e.jsxs("div",{className:"border rounded-lg overflow-hidden flex flex-col",children:[e.jsx("div",{className:"h-40 overflow-hidden bg-gray-100",children:e.jsx("img",{src:c.image_url||"https://placehold.co/400x300",alt:c.name,className:"w-full h-full object-cover transition-transform hover:scale-105"})}),e.jsxs("div",{className:"p-4 flex flex-col flex-grow",children:[e.jsx("h3",{className:"font-semibold truncate",title:c.name,children:c.name}),e.jsx("p",{className:"text-xs text-muted-foreground mb-2",children:(u=c.stores)==null?void 0:u.name}),e.jsxs("p",{className:"font-bold text-lg mb-4",children:["$",Number(c.price).toLocaleString()]}),e.jsxs("div",{className:"mt-auto flex gap-2",children:[e.jsxs(j,{className:"flex-1",size:"sm",onClick:()=>t(c),disabled:c.stock<=0,children:[e.jsx(Ce,{className:"h-4 w-4 mr-2"}),c.stock>0?"Agregar":"Agotado"]}),e.jsx(j,{variant:"outline",size:"icon",className:"text-destructive hover:text-destructive",onClick:()=>a(i.id),children:e.jsx(D,{className:"h-4 w-4"})})]})]})]},i.id)})})})]})},Be=({userId:s})=>{const[r,o]=x.useState([]),[n,d]=x.useState(!0),[h,m]=x.useState(!1),[a,t]=x.useState({name:"",address_line:"",city:"Rionegro",is_default:!1});x.useEffect(()=>{i()},[s]);const i=async()=>{try{const{data:l,error:f}=await p.from("user_addresses").select("*").eq("user_id",s).order("is_default",{ascending:!1});if(f)throw f;o(l||[])}catch(l){console.error(l)}finally{d(!1)}},u=async()=>{if(!a.address_line||!a.name){g({variant:"destructive",title:"Error",description:"Completa los campos obligatorios."});return}try{a.is_default&&r.length>0&&await p.from("user_addresses").update({is_default:!1}).eq("user_id",s);const{data:l,error:f}=await p.from("user_addresses").insert([{...a,user_id:s}]).select();if(f)throw f;o([...a.is_default?[]:r,l[0],...a.is_default?r:[]]),m(!1),t({name:"",address_line:"",city:"Rionegro",is_default:!1}),g({title:"Dirección agregada",description:"Tu nueva dirección ha sido guardada."}),i()}catch(l){g({variant:"destructive",title:"Error",description:l.message})}},c=async l=>{try{const{error:f}=await p.from("user_addresses").delete().eq("id",l);if(f)throw f;o(r.filter(v=>v.id!==l)),g({title:"Eliminado",description:"Dirección eliminada correctamente."})}catch{g({variant:"destructive",title:"Error",description:"No se pudo eliminar."})}};return e.jsxs(y,{children:[e.jsxs(w,{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(_,{children:"Mis Direcciones"}),e.jsx(S,{children:"Gestiona tus lugares de entrega frecuentes."})]}),e.jsxs(V,{open:h,onOpenChange:m,children:[e.jsx(de,{asChild:!0,children:e.jsxs(j,{size:"sm",children:[e.jsx(G,{className:"h-4 w-4 mr-2"})," Nueva Dirección"]})}),e.jsxs(H,{children:[e.jsx(U,{children:e.jsx(F,{children:"Agregar Nueva Dirección"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Nombre (ej. Casa, Trabajo)"}),e.jsx(E,{value:a.name,onChange:l=>t({...a,name:l.target.value}),placeholder:"Ej: Apartamento Centro"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Dirección Completa"}),e.jsx(E,{value:a.address_line,onChange:l=>t({...a,address_line:l.target.value}),placeholder:"Calle 123 # 45-67"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"default-addr",checked:a.is_default,onChange:l=>t({...a,is_default:l.target.checked}),className:"rounded border-gray-300"}),e.jsx("label",{htmlFor:"default-addr",className:"text-sm",children:"Establecer como predeterminada"})]})]}),e.jsx(W,{children:e.jsx(j,{onClick:u,children:"Guardar Dirección"})})]})]})]}),e.jsx(k,{children:e.jsxs("div",{className:"grid gap-4",children:[r.map(l=>e.jsxs("div",{className:"flex items-start justify-between p-4 border rounded-lg bg-card hover:bg-accent/5 transition-colors",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:`p-2 rounded-full ${l.is_default?"bg-primary/10 text-primary":"bg-secondary"}`,children:e.jsx(Z,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"font-semibold",children:l.name}),l.is_default&&e.jsx("span",{className:"text-xs bg-primary/10 text-primary px-2 py-0.5 rounded-full font-medium",children:"Predeterminada"})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:l.address_line}),e.jsx("p",{className:"text-xs text-muted-foreground",children:l.city})]})]}),e.jsx(j,{variant:"ghost",size:"icon",className:"text-destructive hover:bg-destructive/10",onClick:()=>c(l.id),children:e.jsx(D,{className:"h-4 w-4"})})]},l.id)),!n&&r.length===0&&e.jsx("p",{className:"text-center text-muted-foreground py-8",children:"No tienes direcciones guardadas."})]})})]})},Qe=({userId:s})=>{const[r,o]=x.useState([]),[n,d]=x.useState(!0);x.useEffect(()=>{h()},[s]);const h=async()=>{try{const{data:t,error:i}=await p.from("user_payment_methods").select("*").eq("user_id",s).order("is_default",{ascending:!1});if(i)throw i;o(t||[])}catch(t){console.error(t)}finally{d(!1)}},m=async t=>{try{const{error:i}=await p.from("user_payment_methods").delete().eq("id",t);if(i)throw i;o(r.filter(u=>u.id!==t)),g({title:"Método eliminado",description:"La tarjeta ha sido removida."})}catch{g({variant:"destructive",title:"Error",description:"No se pudo eliminar."})}},a=async()=>{const t={user_id:s,last_four:Math.floor(1e3+Math.random()*9e3).toString(),brand:Math.random()>.5?"Visa":"Mastercard",exp_month:12,exp_year:2028,is_default:r.length===0},{data:i,error:u}=await p.from("user_payment_methods").insert([t]).select();!u&&i&&(o([...r,i[0]]),g({title:"Tarjeta Agregada",description:"Método de pago guardado exitosamente."}))};return e.jsxs(y,{children:[e.jsxs(w,{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(_,{children:"Métodos de Pago"}),e.jsx(S,{children:"Gestiona tus tarjetas para compras rápidas."})]}),e.jsxs(j,{size:"sm",onClick:a,children:[e.jsx(G,{className:"h-4 w-4 mr-2"})," Agregar Tarjeta"]})]}),e.jsx(k,{children:e.jsxs("div",{className:"grid gap-4",children:[r.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg bg-card",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"bg-slate-100 p-2 rounded",children:e.jsx(B,{className:"h-6 w-6 text-slate-700"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-semibold flex items-center gap-2",children:[t.brand," •••• ",t.last_four,t.is_default&&e.jsx("span",{className:"text-xs bg-green-100 text-green-700 px-2 rounded-full",children:"Principal"})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Expira: ",t.exp_month,"/",t.exp_year]})]})]}),e.jsx(j,{variant:"ghost",size:"icon",className:"text-destructive",onClick:()=>m(t.id),children:e.jsx(D,{className:"h-4 w-4"})})]},t.id)),r.length===0&&e.jsxs("div",{className:"text-center py-8 text-muted-foreground border-2 border-dashed rounded-lg",children:[e.jsx(Le,{className:"h-10 w-10 mx-auto mb-2 opacity-20"}),e.jsx("p",{children:"No tienes métodos de pago guardados."}),e.jsx("p",{className:"text-xs mt-1",children:"Tus datos están protegidos con encriptación SSL."})]})]})})]})},Xe=({userId:s})=>{const[r,o]=x.useState([]);x.useEffect(()=>{n();const a=p.channel(`notifications-${s}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"user_notifications",filter:`user_id=eq.${s}`},t=>{o(i=>[t.new,...i])}).subscribe();return()=>p.removeChannel(a)},[s]);const n=async()=>{const{data:a}=await p.from("user_notifications").select("*").eq("user_id",s).order("created_at",{ascending:!1}).limit(20);o(a||[])},d=async a=>{await p.from("user_notifications").update({read:!0}).eq("id",a),o(r.map(t=>t.id===a?{...t,read:!0}:t))},h=async()=>{await p.from("user_notifications").update({read:!0}).eq("user_id",s),o(r.map(a=>({...a,read:!0})))},m=a=>{switch(a){case"order":return e.jsx(X,{className:"h-5 w-5 text-blue-500"});case"promo":return e.jsx(Ae,{className:"h-5 w-5 text-purple-500"});default:return e.jsx(qe,{className:"h-5 w-5 text-gray-500"})}};return e.jsxs(y,{children:[e.jsxs(w,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(_,{className:"text-xl",children:"Notificaciones"}),r.some(a=>!a.read)&&e.jsx(j,{variant:"ghost",size:"sm",onClick:h,children:"Marcar todo como leído"})]}),e.jsx(k,{children:e.jsx("div",{className:"space-y-2",children:r.length===0?e.jsxs("div",{className:"text-center py-10 text-muted-foreground",children:[e.jsx(K,{className:"h-10 w-10 mx-auto mb-2 opacity-20"}),e.jsx("p",{children:"No tienes notificaciones nuevas."})]}):r.map(a=>e.jsxs("div",{className:`flex items-start gap-4 p-4 rounded-lg border transition-colors ${a.read?"bg-background":"bg-blue-50/50 border-blue-100"}`,children:[e.jsx("div",{className:"mt-1",children:m(a.type)}),e.jsxs("div",{className:"flex-grow",children:[e.jsx("h4",{className:`text-sm ${a.read?"font-medium":"font-bold"}`,children:a.title}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:a.message}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:new Date(a.created_at).toLocaleString()})]}),!a.read&&e.jsx(j,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>d(a.id),children:e.jsx(Ee,{className:"h-4 w-4"})})]},a.id))})})]})},Ke=({userId:s})=>{const[r,o]=x.useState([]),[n,d]=x.useState(5),[h,m]=x.useState(""),[a,t]=x.useState(null);x.useEffect(()=>{i()},[s]);const i=async()=>{const{data:c,error:l}=await p.from("orders").select("id, created_at, order_items(id, product_id, products!order_items_product_id_fkey(name, image_url))").eq("customer_id",s).eq("status","Entregado").order("created_at",{ascending:!1}).limit(5);if(l){console.error("Error fetching reviews:",l);return}if(c){const f=c.flatMap(v=>v.order_items.map(N=>({...N,order_date:v.created_at})));o(f)}},u=async c=>{t(c.id);try{const{error:l}=await p.from("reviews").insert([{user_id:s,rating:n,comment:h}]);if(l)throw l;g({title:"Reseña enviada",description:"¡Gracias por tu opinión!"}),o(f=>f.filter(v=>v.id!==c.id)),m(""),d(5)}catch(l){console.error(l),g({title:"Error",description:"Intenta nuevamente."})}finally{t(null)}};return e.jsxs(y,{children:[e.jsxs(w,{children:[e.jsx(_,{children:"Reseñas Pendientes"}),e.jsx(S,{children:"Califica los productos que has comprado recientemente."})]}),e.jsx(k,{children:e.jsx("div",{className:"space-y-6",children:r.length===0?e.jsx("p",{className:"text-center text-muted-foreground py-8",children:"No tienes productos pendientes por calificar."}):r.map(c=>{var l,f,v;return e.jsxs("div",{className:"flex gap-4 p-4 border rounded-lg bg-card",children:[e.jsx("img",{src:((l=c.products)==null?void 0:l.image_url)||"https://placehold.co/64",className:"w-20 h-20 object-cover rounded",alt:(f=c.products)==null?void 0:f.name}),e.jsxs("div",{className:"flex-grow",children:[e.jsx("h4",{className:"font-semibold",children:(v=c.products)==null?void 0:v.name}),e.jsxs("p",{className:"text-xs text-muted-foreground mb-3",children:["Comprado el ",new Date(c.order_date).toLocaleDateString()]}),e.jsx("div",{className:"flex items-center gap-1 mb-2",children:[1,2,3,4,5].map(N=>e.jsx("button",{onClick:()=>d(N),type:"button",children:e.jsx(Q,{className:`h-5 w-5 ${N<=n?"fill-yellow-400 text-yellow-400":"text-gray-300"}`})},N))}),e.jsx(Se,{placeholder:"Escribe tu opinión...",value:h,onChange:N=>m(N.target.value),className:"mb-2 h-20"}),e.jsx(j,{size:"sm",onClick:()=>u(c),disabled:a===c.id,children:a===c.id?"Enviando...":"Enviar Calificación"})]})]},c.id)})})})]})},Je=()=>{const[s,r]=x.useState([]);x.useEffect(()=>{(async()=>{const{data:n}=await p.from("discounts").select("*, stores(name, logo_url)").gt("expires_at",new Date().toISOString()).limit(10);r(n||[])})()},[]);const o=n=>{navigator.clipboard.writeText(n),g({title:"Código copiado",description:"Úsalo al finalizar tu compra."})};return e.jsxs(y,{children:[e.jsxs(w,{children:[e.jsx(_,{children:"Cupones y Promociones"}),e.jsx(S,{children:"Aprovecha estos descuentos exclusivos."})]}),e.jsx(k,{children:e.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:s.length===0?e.jsxs("div",{className:"col-span-full text-center py-12 text-muted-foreground border-2 border-dashed rounded-xl",children:[e.jsx(Y,{className:"h-12 w-12 mx-auto mb-3 opacity-20"}),e.jsx("p",{children:"No hay cupones disponibles en este momento."})]}):s.map(n=>{var d;return e.jsxs("div",{className:"relative overflow-hidden border rounded-xl bg-gradient-to-br from-primary/5 to-primary/10 p-5 flex flex-col justify-between",children:[e.jsx("div",{className:"absolute -right-4 -top-4 w-16 h-16 bg-primary/20 rounded-full blur-xl"}),e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg text-primary",children:n.code}),e.jsx("p",{className:"text-sm text-gray-600",children:(d=n.stores)==null?void 0:d.name})]}),e.jsxs("div",{className:"bg-white p-2 rounded-lg shadow-sm border",children:[e.jsx("span",{className:"font-bold text-xl text-primary",children:n.discount_type==="percentage"?`${n.value}%`:`$${n.value}`}),e.jsx("span",{className:"text-[10px] block text-center uppercase",children:"OFF"})]})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-primary/10 flex justify-between items-center",children:[e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Vence: ",new Date(n.expires_at).toLocaleDateString()]}),e.jsxs(j,{size:"sm",variant:"outline",className:"h-8",onClick:()=>o(n.code),children:[e.jsx(Pe,{className:"h-3 w-3 mr-2"})," Copiar"]})]})]},n.id)})})})]})},js=()=>{const s=te(),{user:r,signOut:o,loading:n}=re(),[d,h]=ae(),[m,a]=x.useState("pedidos"),[t,i]=x.useState([]),[u,c]=x.useState(null),[l,f]=x.useState(!0),[v,N]=x.useState(!1);x.useEffect(()=>{const b=d.get("tab");b&&a(b)},[d]);const T=x.useCallback(async b=>{f(!0);try{const[M,$]=await Promise.all([p.from("orders").select(`
            *, 
            stores (name), 
            deliveries (*), 
            order_items (*, products!order_items_product_id_fkey(name, image_url))
          `).eq("customer_id",b).order("created_at",{ascending:!1}),p.from("profiles").select("*").eq("id",b).single()]);if(M.error)throw M.error;if(i(M.data||[]),$.error)throw $.error;c($.data)}catch(M){console.error("Error fetching dashboard data:",M),g({title:"Error",description:"No se pudieron cargar tus datos.",variant:"destructive"})}finally{f(!1)}},[]);x.useEffect(()=>{var b;if(!n){if(!r){s("/cliente/login");return}if(((b=r.user_metadata)==null?void 0:b.role)!=="cliente"){s("/"),g({title:"Acceso no autorizado",description:"Esta sección es solo para clientes.",variant:"destructive"});return}T(r.id)}},[r,s,n,T]);const ee=async()=>{await o(),g({title:"Sesión cerrada",description:"Has cerrado sesión exitosamente."})},se=b=>{a(b),h({tab:b})};return n||l?e.jsxs("div",{className:"min-h-screen bg-background flex items-center justify-center",children:[e.jsx(R,{className:"h-8 w-8 animate-spin text-primary"}),e.jsx("p",{className:"ml-2 text-foreground",children:"Cargando tu panel..."})]}):e.jsxs("div",{className:"min-h-screen bg-background flex flex-col md:flex-row relative",children:[e.jsx(xe,{children:e.jsx("title",{children:"Mi Panel | Cliente"})}),e.jsxs(j,{variant:"outline",size:"icon",className:"fixed top-4 left-4 z-50 md:hidden shadow-md bg-background",onClick:()=>N(!0),children:[e.jsx(ie,{className:"h-5 w-5"}),e.jsx("span",{className:"sr-only",children:"Menu"})]}),e.jsx(Ve,{profile:u,activeTab:m,onTabChange:se,onLogout:ee,onHome:()=>s("/"),isOpen:v,onClose:()=>N(!1)}),e.jsx("main",{className:"flex-1 p-4 md:p-8 overflow-y-auto max-h-screen mt-14 md:mt-0",children:e.jsxs("div",{className:"max-w-5xl mx-auto space-y-6",children:[m==="pedidos"&&e.jsx(Fe,{orders:t}),m==="perfil"&&u&&e.jsx(We,{profile:{...u,email:r.email}}),m==="deseos"&&e.jsx(Ze,{userId:r.id}),m==="direcciones"&&e.jsx(Be,{userId:r.id}),m==="pagos"&&e.jsx(Qe,{userId:r.id}),m==="notificaciones"&&e.jsx(Xe,{userId:r.id}),m==="resenas"&&e.jsx(Ke,{userId:r.id}),m==="cupones"&&e.jsx(Je,{})]})})]})};export{js as default};
