import{f as B,j as e,B as h,r as c,e as p,g as V,l as ne,t as v,b as H,o as ie,X as le,H as oe}from"./index-1004543a.js";import{C as A,c as ce}from"./card-2a69ef9f.js";import{T as de,a as me,b as C,c as I}from"./tabs-b28f01ce.js";import{H as ue}from"./Helmet-0aaa1c92.js";import{T as D}from"./truck-6890f398.js";/* empty css                */import{u as pe,L as E,M as he,T as xe,a as k,P as R}from"./TileLayer-6e6ec189.js";import{P as T}from"./package-e9a73ef2.js";import{M as $}from"./map-pin-da7b2b80.js";import{N as ge}from"./navigation-a312af5a.js";import{P as fe}from"./phone-4e17a72b.js";import{C as je}from"./check-65214e7a.js";import{D as be,a as Ne,b as ve,c as ye,d as we,e as Ee}from"./dialog-4e5e5dd7.js";import{L as _e}from"./log-out-a78cae96.js";/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const De=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],Oe=B("eye",De);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ae=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]],P=B("history",Ae);function Se(){return pe().map}const Ce=({isConnected:s,orders:a,onAcceptOrder:t,onViewDetails:r})=>s?a.length===0?e.jsxs("div",{className:"text-center py-12 bg-slate-100 rounded-lg",children:[e.jsx(D,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 font-medium",children:"No hay pedidos disponibles por ahora."})]}):e.jsx("div",{className:"space-y-4",children:a.map(n=>{var l,i;return e.jsx(A,{className:"p-4",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-bold",children:["Pedido #",n.id.substring(0,8)]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["De: ",e.jsx("span",{className:"font-semibold",children:((l=n.stores)==null?void 0:l.name)||"N/A"})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Cliente: ",e.jsx("span",{className:"font-semibold",children:((i=n.profiles)==null?void 0:i.full_name)||"N/A"})]}),e.jsxs("p",{className:"text-lg font-bold text-green-600 mt-1",children:["$",Number(n.total).toLocaleString()]}),n.status==="Pendiente de pago en efectivo"&&e.jsx("p",{className:"text-xs font-semibold text-white bg-blue-600 px-2 py-1 rounded-full inline-block mt-2",children:"Pago en Efectivo"})]}),e.jsxs("div",{className:"flex flex-col items-end gap-2",children:[e.jsx(h,{onClick:()=>t(n.id),children:"Aceptar Pedido"}),e.jsxs(h,{variant:"outline",size:"sm",onClick:()=>r(n),children:[e.jsx(Oe,{className:"mr-2 h-4 w-4"}),"Ver Detalles"]})]})]})},n.id)})}):e.jsxs("div",{className:"text-center py-12 bg-slate-100 rounded-lg",children:[e.jsx(D,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 font-medium",children:"Conéctate para ver pedidos disponibles."})]});delete E.Icon.Default.prototype._getIconUrl;E.Icon.Default.mergeOptions({iconRetinaUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-2x.png",iconUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png"});const Ie=new E.Icon({iconUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-blue.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),ke=new E.Icon({iconUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-green.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),Re=new E.Icon({iconUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-red.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),Te=({bounds:s})=>{const a=Se();return c.useEffect(()=>{s&&s.isValid()&&a.fitBounds(s,{padding:[50,50]})},[a,s]),null},Pe=({delivery:s})=>{const a=s==null?void 0:s.pickup_coords,t=s==null?void 0:s.delivery_coords,r=s==null?void 0:s.delivery_person_location,n=c.useMemo(()=>{const i=[];return a&&i.push(a),t&&i.push(t),r&&i.push([r.lat,r.lng]),i.length<2?null:E.latLngBounds(i)},[a,t,r]),l=a||[6.15515,-75.37367];return e.jsx("div",{className:"h-64 w-full rounded-lg overflow-hidden mt-4 border",children:e.jsxs(he,{center:l,zoom:13,scrollWheelZoom:!1,style:{height:"100%",width:"100%"},children:[e.jsx(xe,{attribution:'© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),a&&e.jsx(k,{position:a,icon:Ie,children:e.jsxs(R,{children:["Recoger aquí: ",s==null?void 0:s.pickup_address]})}),t&&e.jsx(k,{position:t,icon:ke,children:e.jsxs(R,{children:["Entregar aquí: ",s==null?void 0:s.delivery_address]})}),r&&e.jsx(k,{position:[r.lat,r.lng],icon:Re,children:e.jsx(R,{children:"Tu ubicación actual"})}),e.jsx(Te,{bounds:n})]})})},Le=({orders:s,onCompleteOrder:a})=>s.length===0?e.jsxs("div",{className:"text-center py-12 bg-slate-100 rounded-lg",children:[e.jsx(T,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 font-medium",children:"No tienes entregas en curso."})]}):e.jsx("div",{className:"space-y-4",children:s.map(t=>{var r,n,l,i,o,u,g,b;return e.jsxs(A,{className:"p-4 border-2 border-blue-500 shadow-lg",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-bold text-blue-700",children:["Pedido #",t.id.substring(0,8)]}),e.jsxs("p",{className:"text-sm text-gray-600 mt-2",children:[e.jsx($,{className:"inline h-4 w-4 mr-1 text-blue-500"}),"Recoger en: ",e.jsx("span",{className:"font-semibold",children:((r=t.deliveries)==null?void 0:r.pickup_address)||"N/A"})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx($,{className:"inline h-4 w-4 mr-1 text-green-500"}),"Entregar a: ",e.jsx("span",{className:"font-semibold",children:((n=t.deliveries)==null?void 0:n.delivery_address)||"N/A"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-lg font-bold text-green-600",children:["$",Number(t.total).toLocaleString()]}),t.status==="Pendiente de pago en efectivo"&&e.jsx("p",{className:"text-xs font-semibold text-white bg-blue-600 px-2 py-1 rounded-full inline-block mt-1",children:"Cobrar en Efectivo"})]})]}),e.jsx(Pe,{delivery:t.deliveries}),e.jsxs("div",{className:"flex justify-end items-center mt-4 gap-2",children:[e.jsx("a",{href:`https://www.google.com/maps/dir/?api=1&origin=${encodeURIComponent(((l=t.deliveries)==null?void 0:l.pickup_address)||"")}&destination=${encodeURIComponent(((i=t.deliveries)==null?void 0:i.delivery_address)||"")}`,target:"_blank",rel:"noopener noreferrer",children:e.jsxs(h,{variant:"outline",size:"sm",disabled:!((o=t.deliveries)!=null&&o.pickup_address)||!((u=t.deliveries)!=null&&u.delivery_address),children:[e.jsx(ge,{className:"h-4 w-4 mr-2"}),"Navegar"]})}),e.jsx("a",{href:`tel:${(g=t.profiles)==null?void 0:g.phone}`,children:e.jsxs(h,{variant:"outline",size:"sm",disabled:!((b=t.profiles)!=null&&b.phone),children:[e.jsx(fe,{className:"h-4 w-4 mr-2"}),"Llamar"]})}),e.jsxs(h,{size:"sm",className:"bg-green-600 hover:bg-green-700",onClick:()=>a(t.id),children:[e.jsx(je,{className:"h-4 w-4 mr-2"}),"Completar"]})]})]},t.id)})}),ze=({orders:s})=>s.length===0?e.jsxs("div",{className:"text-center py-12 bg-slate-100 rounded-lg",children:[e.jsx(P,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 font-medium",children:"Aún no has completado entregas."})]}):e.jsx("div",{className:"space-y-4",children:s.map(a=>e.jsx(A,{className:"p-4 bg-green-50 border-green-200",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-bold text-gray-700",children:["Pedido #",a.id.substring(0,8)]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Entregado el ",new Date(a.created_at).toLocaleDateString()]})]}),e.jsxs("p",{className:"text-lg font-bold text-green-700",children:["$",Number(a.total).toLocaleString()]})]})},a.id))}),Me=({order:s,open:a,onOpenChange:t})=>{var r,n,l;return e.jsx(be,{open:a,onOpenChange:t,children:e.jsxs(Ne,{children:[e.jsxs(ve,{children:[e.jsxs(ye,{children:["Detalles del Pedido #",s==null?void 0:s.id.substring(0,8)]}),e.jsxs(we,{children:["De ",(r=s==null?void 0:s.stores)==null?void 0:r.name," para ",(n=s==null?void 0:s.profiles)==null?void 0:n.full_name,"."]})]}),e.jsx("div",{className:"space-y-4 max-h-[60vh] overflow-y-auto pr-2",children:(l=s==null?void 0:s.order_items)==null?void 0:l.map(i=>{var o,u,g;return e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("img",{src:((o=i.products)==null?void 0:o.image_url)||"https://placehold.co/64",alt:(u=i.products)==null?void 0:u.name,className:"w-16 h-16 rounded-md object-cover"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:(g=i.products)==null?void 0:g.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Cantidad: ",i.quantity]})]})]}),e.jsxs("p",{className:"font-semibold",children:["$",(i.price*i.quantity).toLocaleString()]})]},i.id)})}),e.jsx(Ee,{className:"pt-4 border-t",children:e.jsxs("div",{className:"w-full flex justify-between font-bold text-lg",children:[e.jsx("span",{children:"Total a Recaudar:"}),e.jsxs("span",{children:["$",Number(s==null?void 0:s.total).toLocaleString()]})]})})]})})},Ge=["Listo para recogida","Pendiente","Pendiente de pago en efectivo"],m={BUSCANDO:"Buscando",ASIGNADO:"Asignado",RECOGIDO:"Recogido",EN_CAMINO:"En camino",ENTREGADO:"Entregado"},O={PEDIDOS_NO_CARGADOS:"No se pudieron cargar los pedidos disponibles",ENTREGA_NO_ENCONTRADA:"No se encontró la entrega especificada",ERROR_ACTUALIZACION:"No se pudo actualizar el estado de la entrega"};function j(s,a="ID"){if(!s||typeof s!="string"||s.trim()==="")throw new Error(`${a} es requerido y debe ser válido`)}function y(s,a){throw console.error(`[deliveryService] ${a}:`,s),new Error(s.message||a)}const w={async obtenerPedidosDisponibles(){try{const{data:s,error:a}=await p.from("orders").select(`
          id, 
          created_at, 
          total, 
          status, 
          delivery_address,
          delivery_lat,
          delivery_lng,
          stores (id, name, address, lat, lng, phone),
          profiles (full_name, phone)
        `).in("status",Ge).order("created_at",{ascending:!1});a&&y(a,O.PEDIDOS_NO_CARGADOS);const t=[];for(const r of s||[]){const{data:n}=await p.from("deliveries").select("id").eq("order_id",r.id).in("status",[m.ASIGNADO,m.RECOGIDO,m.EN_CAMINO]).maybeSingle();n||t.push(r)}return t}catch(s){y(s,O.PEDIDOS_NO_CARGADOS)}},async getAvailableDeliveries(){return this.obtenerPedidosDisponibles()},async getAvailableOrders(){return this.obtenerPedidosDisponibles()},async obtenerEntregaActual(s){j(s,"ID del domiciliario");try{const{data:a,error:t}=await p.from("deliveries").select(`
          *,
          orders (
            id, 
            total, 
            status, 
            delivery_address,
            delivery_lat,
            delivery_lng,
            created_at,
            stores (name, address, phone, lat, lng),
            profiles (full_name, phone),
            order_items (quantity, products!order_items_product_id_fkey(name))
          )
        `).eq("delivery_person_id",s).in("status",[m.ASIGNADO,m.RECOGIDO,m.EN_CAMINO]).order("created_at",{ascending:!1}).maybeSingle();return t?(console.error("[deliveryService] Error obteniendo entrega actual:",t),null):a}catch(a){return console.error("[deliveryService] Error inesperado:",a),null}},async getCurrentDelivery(s){return this.obtenerEntregaActual(s)},async aceptarEntrega(s,a){j(s,"ID del pedido"),j(a,"ID del domiciliario");try{const{data:t}=await p.from("deliveries").select("id").eq("order_id",s).not("status","eq",m.ENTREGADO).maybeSingle();if(t)throw new Error("Este pedido ya fue tomado por otro domiciliario");const{data:r,error:n}=await p.from("deliveries").insert({order_id:s,delivery_person_id:a,status:m.ASIGNADO,assigned_at:new Date().toISOString()}).select().single();return n&&y(n,"Error al aceptar la entrega"),await p.from("orders").update({status:"En curso"}).eq("id",s),r}catch(t){y(t,"Error al aceptar la entrega")}},async acceptDelivery(s,a){return this.aceptarEntrega(s,a)},async actualizarEstadoEntrega(s,a){j(s,"ID del pedido");const t=Object.values(m);if(!t.includes(a))throw new Error(`Estado inválido. Debe ser uno de: ${t.join(", ")}`);try{const r={status:a};a===m.ENTREGADO&&(r.delivered_at=new Date().toISOString()),a===m.RECOGIDO&&(r.picked_up_at=new Date().toISOString());const{data:n,error:l}=await p.from("deliveries").update(r).eq("order_id",s).select().single();return l&&y(l,O.ERROR_ACTUALIZACION),a===m.ENTREGADO&&await p.from("orders").update({status:"Entregado"}).eq("id",s),n}catch(r){y(r,O.ERROR_ACTUALIZACION)}},async updateDeliveryStatus(s,a){return this.actualizarEstadoEntrega(s,a)},async actualizarUbicacion(s,a,t){if(j(s,"ID del domiciliario"),typeof a!="number"||typeof t!="number")throw new Error("Latitud y longitud deben ser números válidos");if(a<-90||a>90||t<-180||t>180)throw new Error("Coordenadas fuera de rango válido");try{const{error:r}=await p.from("delivery_locations").upsert({delivery_person_id:s,lat:a,lng:t,updated_at:new Date().toISOString()},{onConflict:"delivery_person_id"});r&&console.error("[deliveryService] Error actualizando ubicación:",r)}catch(r){console.error("[deliveryService] Error inesperado en ubicación:",r)}},async updateLocation(s,a,t){return this.actualizarUbicacion(s,a,t)},async obtenerEstadisticas(s){j(s,"ID del domiciliario");try{const{data:a,error:t}=await p.from("deliveries").select("id, created_at, delivered_at, orders(total)").eq("delivery_person_id",s).eq("status",m.ENTREGADO);if(t)return console.error("[deliveryService] Error obteniendo estadísticas:",t),{totalEntregas:0,gananciaTotal:0};const r=(a==null?void 0:a.length)||0,n=(a==null?void 0:a.reduce((l,i)=>{var u;const o=Number((u=i.orders)==null?void 0:u.total)||0;return l+o*.1},0))||0;return{totalEntregas:r,gananciaTotal:Math.round(n)}}catch(a){return console.error("[deliveryService] Error:",a),{totalEntregas:0,gananciaTotal:0}}},async obtenerHistorialEntregas(s,a=20){j(s,"ID del domiciliario");try{const{data:t,error:r}=await p.from("deliveries").select(`
          *,
          orders (
            total, 
            delivery_address,
            stores (name)
          )
        `).eq("delivery_person_id",s).eq("status",m.ENTREGADO).order("delivered_at",{ascending:!1}).limit(a);return r?(console.error("[deliveryService] Error:",r),[]):t||[]}catch(t){return console.error("[deliveryService] Error:",t),[]}}},qe=({isOpen:s,onClose:a,activeTab:t,onTabChange:r,isConnected:n,onConnect:l,onLogout:i,user:o})=>{const u=V();return e.jsxs(e.Fragment,{children:[s&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-40 lg:hidden backdrop-blur-sm transition-opacity",onClick:a}),e.jsx("aside",{className:`
                  fixed top-0 left-0 z-50 h-full w-64 bg-card border-r shadow-lg lg:shadow-none lg:relative lg:translate-x-0
                  transform transition-transform duration-300 ease-in-out
                  ${s?"translate-x-0":"-translate-x-full"}
                `,children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"flex items-center justify-between h-16 border-b px-4 shrink-0 bg-primary/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(D,{className:"h-5 w-5 text-primary"}),e.jsx("span",{className:"font-bold text-lg",children:"Domiciliario"})]}),e.jsx(h,{variant:"ghost",size:"icon",className:"lg:hidden",onClick:a,children:e.jsx(le,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"p-4 space-y-4 flex-1",children:[e.jsxs("div",{className:"p-4 bg-muted/30 rounded-lg border",children:[e.jsxs("p",{className:"text-sm font-medium mb-2",children:["Estado: ",e.jsx("span",{className:n?"text-green-600":"text-gray-500",children:n?"Conectado":"Desconectado"})]}),e.jsx(h,{onClick:l,size:"sm",className:`w-full ${n?"bg-destructive hover:bg-destructive/80":"bg-primary hover:bg-primary/80"}`,children:n?"Desconectarse":"Conectarse"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs(h,{variant:t==="disponibles"?"secondary":"ghost",className:"w-full justify-start",onClick:()=>{r("disponibles"),a()},children:[e.jsx(T,{className:"mr-2 h-4 w-4"})," Disponibles"]}),e.jsxs(h,{variant:t==="curso"?"secondary":"ghost",className:"w-full justify-start",onClick:()=>{r("curso"),a()},children:[e.jsx(D,{className:"mr-2 h-4 w-4"})," En curso"]}),e.jsxs(h,{variant:t==="historial"?"secondary":"ghost",className:"w-full justify-start",onClick:()=>{r("historial"),a()},children:[e.jsx(P,{className:"mr-2 h-4 w-4"})," Historial"]})]})]}),e.jsxs("div",{className:"p-4 border-t space-y-2 bg-muted/10",children:[e.jsxs("div",{className:"px-2 pb-2",children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground",children:"Conectado como:"}),e.jsx("p",{className:"text-sm truncate font-semibold",title:o==null?void 0:o.email,children:o==null?void 0:o.email})]}),e.jsxs(h,{variant:"outline",className:"w-full justify-start",onClick:()=>u("/"),children:[e.jsx(oe,{className:"mr-2 h-4 w-4"})," Ir al inicio"]}),e.jsxs(h,{variant:"ghost",className:"w-full justify-start text-red-600 hover:text-red-700 hover:bg-red-50",onClick:i,children:[e.jsx(_e,{className:"mr-2 h-4 w-4"})," Cerrar Sesión"]})]})]})})]})},as=()=>{const s=V(),{user:a,signOut:t,loading:r}=ne(),[n,l]=c.useState(!1),[i,o]=c.useState("disponibles"),[u,g]=c.useState([]),[b,F]=c.useState(null),[L,Z]=c.useState([]),[W,z]=c.useState(!0),[X,J]=c.useState(null),[K,M]=c.useState(!1),[Q,G]=c.useState(!1),_=c.useRef(null),f=c.useCallback(async d=>{if(d){z(!0);try{const x=await w.obtenerPedidosDisponibles();g(x||[]);const N=await w.obtenerEntregaActual(d);let q=[];N&&N.orders&&(q=[{...N.orders,deliveries:[N]}]),F(q);const re=(await w.obtenerHistorialEntregas(d)).map(U=>({...U.orders,deliveries:[U]}));Z(re)}catch(x){console.error("Error fetching data:",x),v({title:"Error",description:"No se pudieron cargar los datos.",variant:"destructive"})}finally{z(!1)}}},[]);c.useEffect(()=>{if(!r){if(!a){s("/domiciliario/login");return}f(a.id)}},[a,s,r,f]),c.useEffect(()=>{if(!a)return;const d=p.channel("public-changes").on("postgres_changes",{event:"*",schema:"public",table:"orders"},()=>f(a.id)).on("postgres_changes",{event:"*",schema:"public",table:"deliveries"},()=>f(a.id)).subscribe();return()=>{p.removeChannel(d)}},[a,f]);const S=c.useCallback(async()=>{a&&navigator.geolocation.getCurrentPosition(async d=>{const{latitude:x,longitude:N}=d.coords;await w.actualizarUbicacion(a.id,x,N)},d=>console.error("Error getting location:",d),{enableHighAccuracy:!0})},[a]);c.useEffect(()=>(n?(S(),_.current=setInterval(S,3e4)):_.current&&clearInterval(_.current),()=>{_.current&&clearInterval(_.current)}),[n,S]);const Y=()=>l(!n),ee=async()=>{await t(),v({title:"Sesión cerrada"}),s("/")},se=async d=>{if(a)try{await w.aceptarEntrega(d,a.id),await f(a.id),v({title:"¡Pedido Aceptado!",description:"El pedido ahora está en tu lista 'En Curso'."}),o("curso")}catch(x){console.error("Error accepting order:",x),v({title:"Error",description:x.message||"No se pudo aceptar el pedido.",variant:"destructive"})}},ae=async d=>{try{await w.actualizarEstadoEntrega(d,"Entregado"),await f(a.id),v({title:"¡Entrega Completada!",description:"¡Buen trabajo!"}),o("historial")}catch(x){console.error("Error completing order:",x),v({title:"Error",description:x.message||"No se pudo completar la entrega.",variant:"destructive"})}},te=d=>{J(d),M(!0)};return r?e.jsxs("div",{className:"min-h-screen bg-background flex items-center justify-center",children:[e.jsx(H,{className:"h-8 w-8 animate-spin text-primary"}),e.jsx("p",{className:"ml-2 text-foreground",children:"Cargando..."})]}):e.jsxs("div",{className:"min-h-screen bg-background flex flex-col lg:flex-row",children:[e.jsx(ue,{children:e.jsx("title",{children:"Panel Domiciliario"})}),e.jsxs(h,{variant:"outline",size:"icon",className:"fixed top-4 left-4 z-50 lg:hidden shadow-md bg-background",onClick:()=>G(!0),children:[e.jsx(ie,{className:"h-5 w-5"}),e.jsx("span",{className:"sr-only",children:"Menu"})]}),e.jsx(qe,{isOpen:Q,onClose:()=>G(!1),activeTab:i,onTabChange:o,isConnected:n,onConnect:Y,onLogout:ee,user:a}),e.jsx("main",{className:"flex-1 p-4 sm:p-6 lg:p-8 mt-16 lg:mt-0 min-w-0 overflow-y-auto max-h-screen",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-6",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Panel de Entregas"}),e.jsx("p",{className:"text-muted-foreground",children:"Gestiona tus pedidos disponibles y entregas activas."})]})}),e.jsx(A,{className:"bg-card text-card-foreground border-border w-full",children:e.jsx(ce,{className:"p-0 sm:p-6",children:W?e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsx(H,{className:"animate-spin h-8 w-8 text-primary"})}):e.jsxs(de,{value:i,onValueChange:o,className:"w-full",children:[e.jsxs(me,{className:"grid w-full grid-cols-3 mb-6 bg-muted/50 p-1",children:[e.jsxs(C,{value:"disponibles",className:"text-xs sm:text-sm",children:[e.jsx(T,{className:"mr-1 sm:mr-2 h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Disponibles"})," (",u.length,")"]}),e.jsxs(C,{value:"curso",className:"text-xs sm:text-sm",children:[e.jsx(D,{className:"mr-1 sm:mr-2 h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"En curso"})," (",b?b.length:0,")"]}),e.jsxs(C,{value:"historial",className:"text-xs sm:text-sm",children:[e.jsx(P,{className:"mr-1 sm:mr-2 h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Historial"})," (",L.length,")"]})]}),e.jsxs("div",{className:"p-4 sm:p-0",children:[e.jsx(I,{value:"disponibles",className:"mt-0",children:e.jsx(Ce,{isConnected:n,orders:u,onAcceptOrder:se,onViewDetails:te})}),e.jsx(I,{value:"curso",className:"mt-0",children:e.jsx(Le,{orders:b||[],onCompleteOrder:ae})}),e.jsx(I,{value:"historial",className:"mt-0",children:e.jsx(ze,{orders:L})})]})]})})})]})}),e.jsx(Me,{order:X,open:K,onOpenChange:M})]})};export{as as default};
