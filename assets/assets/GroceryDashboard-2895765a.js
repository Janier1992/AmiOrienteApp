import{l as Q,Q as X,k as q,$ as J,r as n,a0 as W,a1 as Y,j as e,a3 as A,a4 as B,a5 as Z,o as M,B as S,P as ee,T as te,D as ae,v as se,z as re,E as oe,t as T,_ as ie,g as ce}from"./index-9083a265.js";import{L as ne,B as le}from"./BaseStoreDashboard-95c4e9f2.js";import{s as O,u as de}from"./useStoreDashboard-dac11d7b.js";import me from"./OverviewTab-aa2bcbfb.js";import{I as _}from"./input-f40b5322.js";import{S as ue,a as he,b as pe,c as xe,d as fe}from"./select-3fcc46eb.js";import{L as E}from"./label-9012fa84.js";import"./textarea-c7c4cb4e.js";import{u as be,a as ge}from"./index-1fbefbe4.js";import{C as je}from"./check-86a4f1d1.js";import{B as ye}from"./badge-29da9c44.js";import{T as ke,a as ve,b as z,c as N,d as Ce,e as P}from"./table-9277bd3f.js";import{S as U}from"./shopping-cart-d265392e.js";import{S as Se}from"./search-d5f724c4.js";import{P as Ne}from"./pencil-cbcb3e21.js";import Pe from"./OrdersManagementTab-3fd70c0a.js";import{B as we}from"./BulkUploadTab-c79223c9.js";import _e from"./FinancialsTab-052a94cf.js";import Ee from"./AdminTab-7a5a603d.js";import Ie from"./ProfileTab-c0832029.js";import{C as Te}from"./credit-card-e7927076.js";import{U as Le}from"./upload-52e19c26.js";import{D as De,S as Re}from"./settings-dc2a13fd.js";import{U as qe}from"./users-69003029.js";import"./Helmet-a3f46ffc.js";import"./log-out-f36dce14.js";import"./index-2823ce6c.js";import"./triangle-alert-00791701.js";import"./package-0a61c0c1.js";import"./trending-up-25d33acb.js";import"./clock-b1ebfb45.js";import"./truck-cf1d9e76.js";import"./map-pin-9a40b828.js";import"./circle-alert-7ba7cf89.js";import"./user-plus-eab42a88.js";/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Be=[["path",{d:"M3 5v14",key:"1nt18q"}],["path",{d:"M8 5v14",key:"1ybrkv"}],["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"M17 5v14",key:"ycjyhj"}],["path",{d:"M21 5v14",key:"nzette"}]],Me=Q("barcode",Be),Oe=X((a,l)=>({products:[],cart:[],isLoadingProducts:!1,isLoadingCheckout:!1,error:null,fetchProducts:async r=>{a({isLoadingProducts:!0});try{const o=await O.obtenerProductos(r);a({products:o||[]})}catch(o){a({error:o.message})}finally{a({isLoadingProducts:!1})}},addToCart:r=>{const o=l().cart,d=o.find(s=>s.id===r.id);return a(d?{cart:o.map(s=>s.id===r.id?{...s,qty:s.qty+1}:s)}:{cart:[...o,{...r,qty:1}]}),!0},removeFromCart:r=>a(o=>({cart:o.cart.filter(d=>d.id!==r)})),updateCartQty:(r,o)=>a(d=>({cart:d.cart.map(s=>s.id===r?{...s,qty:Math.max(1,s.qty+o)}:s)})),clearCart:()=>a({cart:[]}),processCheckout:async(r,o,d,s)=>{const m=l().cart;if(m.length===0)return;const h=typeof o=="object"?{...o,method:d,type:"POS"}:{name:o,method:d,type:"POS"};a({isLoadingCheckout:!0});try{const{data:f,error:p}=await q.from("orders").insert({store_id:r,customer_id:null,status:"Entregado",total:s,delivery_address:JSON.stringify({guest:h,items:m.map(i=>({id:i.id,name:i.name,qty:i.qty,price:i.price}))})}).select().single();if(p)throw p;const b=m.map(i=>({order_id:f.id,product_id:i.id,quantity:i.qty,price:i.price})),{error:g}=await q.from("order_items").insert(b);if(g)throw g;for(const i of m)i.stock!==void 0&&await O.actualizarProducto(i.id,{stock:Math.max(0,i.stock-i.qty)});return l().clearCart(),!0}catch(f){throw f}finally{a({isLoadingCheckout:!1})}}}));var R="Checkbox",[ze,_t]=J(R),[Ae,Ue]=ze(R),F=n.forwardRef((a,l)=>{const{__scopeCheckbox:r,name:o,checked:d,defaultChecked:s,required:m,disabled:h,value:f="on",onCheckedChange:p,form:b,...g}=a,[i,v]=n.useState(null),c=W(l,u=>v(u)),x=n.useRef(!1),I=i?b||!!i.closest("form"):!0,[j=!1,w]=Y({prop:d,defaultProp:s,onChange:p}),L=n.useRef(j);return n.useEffect(()=>{const u=i==null?void 0:i.form;if(u){const C=()=>w(L.current);return u.addEventListener("reset",C),()=>u.removeEventListener("reset",C)}},[i,w]),e.jsxs(Ae,{scope:r,state:j,disabled:h,children:[e.jsx(A.button,{type:"button",role:"checkbox","aria-checked":k(j)?"mixed":j,"aria-required":m,"data-state":V(j),"data-disabled":h?"":void 0,disabled:h,value:f,...g,ref:c,onKeyDown:B(a.onKeyDown,u=>{u.key==="Enter"&&u.preventDefault()}),onClick:B(a.onClick,u=>{w(C=>k(C)?!0:!C),I&&(x.current=u.isPropagationStopped(),x.current||u.stopPropagation())})}),I&&e.jsx(Fe,{control:i,bubbles:!x.current,name:o,value:f,checked:j,required:m,disabled:h,form:b,style:{transform:"translateX(-100%)"},defaultChecked:k(s)?!1:s})]})});F.displayName=R;var K="CheckboxIndicator",H=n.forwardRef((a,l)=>{const{__scopeCheckbox:r,forceMount:o,...d}=a,s=Ue(K,r);return e.jsx(Z,{present:o||k(s.state)||s.state===!0,children:e.jsx(A.span,{"data-state":V(s.state),"data-disabled":s.disabled?"":void 0,...d,ref:l,style:{pointerEvents:"none",...a.style}})})});H.displayName=K;var Fe=a=>{const{control:l,checked:r,bubbles:o=!0,defaultChecked:d,...s}=a,m=n.useRef(null),h=be(r),f=ge(l);n.useEffect(()=>{const b=m.current,g=window.HTMLInputElement.prototype,v=Object.getOwnPropertyDescriptor(g,"checked").set;if(h!==r&&v){const c=new Event("click",{bubbles:o});b.indeterminate=k(r),v.call(b,k(r)?!1:r),b.dispatchEvent(c)}},[h,r,o]);const p=n.useRef(k(r)?!1:r);return e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:d??p.current,...s,tabIndex:-1,ref:m,style:{...a.style,...f,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function k(a){return a==="indeterminate"}function V(a){return k(a)?"indeterminate":a?"checked":"unchecked"}var G=F,Ke=H;const He=n.forwardRef(({className:a,...l},r)=>e.jsx(G,{ref:r,className:M("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",a),...l,children:e.jsx(Ke,{className:M("flex items-center justify-center text-current"),children:e.jsx(je,{className:"h-4 w-4"})})}));He.displayName=G.displayName;const Ve=()=>{const{products:a,fetchProducts:l,addProduct:r,updateProduct:o,deleteProduct:d,store:s}=de(),[m,h]=n.useState(""),[f,p]=n.useState(!1),[b,g]=n.useState(!1),[i,v]=n.useState(null),[c,x]=n.useState({name:"",price:"",stock:"",description:"",category:"Abarrotes",sku:"",image_url:""});n.useEffect(()=>{s!=null&&s.id&&l(s.id)},[s==null?void 0:s.id,l]);const I=a.filter(t=>t.name.toLowerCase().includes(m.toLowerCase())||t.sku&&t.sku.includes(m)),j=["Abarrotes","Lácteos","Carnes","Frutas/Verduras","Limpieza","Bebidas","Cuidado Personal"],w=()=>{v(null),x({name:"",price:"",stock:"50",description:"",category:"Abarrotes",sku:"",image_url:""}),p(!0)},L=t=>{v(t),x({name:t.name,price:t.price,stock:t.stock,description:t.description||"",category:t.category||"Abarrotes",sku:t.sku||"",image_url:t.image_url||""}),p(!0)},u=async(t,y)=>{try{await o(t.id,{stock:parseInt(y)}),T({title:"Stock actualizado"})}catch{}},C=async t=>{t.preventDefault(),g(!0);try{const y={name:c.name,price:parseFloat(c.price),stock:parseInt(c.stock),sku:c.sku,description:c.sku?`${c.description}

SKU:${c.sku}`:c.description,category:c.category,store_id:s==null?void 0:s.id,product_type:"physical",requires_shipping:!0};i?(await o(i.id,y),T({title:"Producto actualizado"})):(await r(y),T({title:"Producto registrado"})),p(!1)}catch{T({title:"Error",variant:"destructive"})}finally{g(!1)}},$=async t=>{confirm("¿Eliminar producto?")&&await d(t)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-emerald-50 border border-emerald-100 p-6 rounded-t-xl flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-emerald-900 flex items-center gap-2",children:[e.jsx(U,{className:"h-8 w-8 text-emerald-600"}),"Inventario Máster"]}),e.jsx("p",{className:"text-emerald-700",children:"Gestión masiva de referencias, precios y existencias."})]}),e.jsxs(S,{className:"bg-emerald-700 hover:bg-emerald-800",onClick:w,children:[e.jsx(ee,{className:"h-4 w-4 mr-2"})," Nuevo Producto"]})]}),e.jsxs("div",{className:"flex gap-4 items-center bg-white p-2 border-b",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Se,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(_,{placeholder:"Buscar por nombre, código de barras...",className:"pl-10",value:m,onChange:t=>h(t.target.value)})]}),e.jsxs(S,{variant:"outline",children:[e.jsx(Me,{className:"h-4 w-4 mr-2"})," Escanear"]})]}),e.jsx("div",{className:"bg-white border rounded-lg overflow-hidden shadow-sm",children:e.jsxs(ke,{children:[e.jsx(ve,{children:e.jsxs(z,{className:"bg-gray-50",children:[e.jsx(N,{className:"w-[100px]",children:"Código/SKU"}),e.jsx(N,{children:"Producto"}),e.jsx(N,{children:"Categoría"}),e.jsx(N,{className:"text-right",children:"Precio"}),e.jsx(N,{className:"text-center w-[150px]",children:"Stock"}),e.jsx(N,{className:"text-right",children:"Acciones"})]})}),e.jsx(Ce,{children:I.map(t=>{var y,D;return e.jsxs(z,{children:[e.jsx(P,{className:"font-mono text-xs text-gray-500",children:t.sku||((D=(y=t.description)==null?void 0:y.match(/SKU:(\w+)/))==null?void 0:D[1])||"---"}),e.jsx(P,{className:"font-medium text-slate-800",children:t.name}),e.jsx(P,{children:e.jsx(ye,{variant:"outline",className:"font-normal",children:t.category})}),e.jsxs(P,{className:"text-right font-bold text-emerald-700",children:["$",Number(t.price).toLocaleString()]}),e.jsx(P,{className:"text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(S,{variant:"ghost",className:"h-6 w-6 rounded-full p-0",onClick:()=>u(t,Math.max(0,t.stock-1)),children:"-"}),e.jsx("span",{className:"w-8 text-center",children:t.stock}),e.jsx(S,{variant:"ghost",className:"h-6 w-6 rounded-full p-0",onClick:()=>u(t,t.stock+1),children:"+"})]})}),e.jsxs(P,{className:"text-right",children:[e.jsx(S,{variant:"ghost",size:"sm",onClick:()=>L(t),children:e.jsx(Ne,{className:"h-4 w-4 text-blue-500"})}),e.jsx(S,{variant:"ghost",size:"sm",onClick:()=>$(t.id),children:e.jsx(te,{className:"h-4 w-4 text-red-500"})})]})]},t.id)})})]})}),e.jsx(ae,{open:f,onOpenChange:p,children:e.jsxs(se,{children:[e.jsx(re,{children:e.jsx(oe,{children:"Producto de Supermercado"})}),e.jsxs("form",{onSubmit:C,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2 col-span-2",children:[e.jsx(E,{children:"Nombre Producto"}),e.jsx(_,{value:c.name,onChange:t=>x({...c,name:t.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{children:"Código Barras / SKU"}),e.jsx(_,{value:c.sku,onChange:t=>x({...c,sku:t.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{children:"Categoría"}),e.jsxs(ue,{value:c.category,onValueChange:t=>x({...c,category:t}),children:[e.jsx(he,{children:e.jsx(pe,{})}),e.jsx(xe,{children:j.map(t=>e.jsx(fe,{value:t,children:t},t))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{children:"Precio"}),e.jsx(_,{type:"number",value:c.price,onChange:t=>x({...c,price:t.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{children:"Stock Inicial"}),e.jsx(_,{type:"number",value:c.stock,onChange:t=>x({...c,stock:t.target.value}),required:!0})]})]}),e.jsx(S,{type:"submit",className:"w-full bg-emerald-600 hover:bg-emerald-700",disabled:b,children:"Guardar"})]})]})})]})},Ge=n.lazy(()=>ie(()=>import("./GenericPOSView-9ba79c46.js"),["./GenericPOSView-9ba79c46.js","./index-9083a265.js","./index-5de83a78.css","./input-f40b5322.js","./badge-29da9c44.js","./scroll-area-66c3347f.js","./label-9012fa84.js","./useStoreDashboard-dac11d7b.js","./shopping-cart-d265392e.js","./search-d5f724c4.js","./circle-check-big-df71119a.js"],import.meta.url)),Et=n.memo(({store:a})=>{const l=[{path:"",label:"Resumen",icon:ne,element:e.jsx(me,{storeId:a.id})},{path:"caja",label:"Caja (POS)",icon:Te,element:e.jsx(Ge,{useStore:Oe,title:"Caja Registradora"})},{path:"inventario",label:"Inventario",icon:U,element:e.jsx(Ve,{})},{path:"pedidos",label:"Pedidos",icon:ce,element:e.jsx(Pe,{storeId:a.id})},{path:"importar",label:"Carga Masiva",icon:Le,element:e.jsx(we,{storeId:a.id,onProductsUploaded:()=>{}})},{path:"finanzas",label:"Finanzas",icon:De,element:e.jsx(_e,{storeId:a.id})},{path:"equipo",label:"Cajeros",icon:qe,element:e.jsx(Ee,{storeId:a.id})},{path:"configuracion",label:"Ajustes",icon:Re,element:e.jsx(Ie,{})}];return e.jsx(le,{store:a,tabs:l})});export{Et as default};
