import{r as t,n as E,x as H,y as L,j as e,B as y,L as f,H as k,C as T,a as q,b as F,d as M,c as _,f as A,k as D,t as n}from"./index-3101bb07.js";import{H as O}from"./Helmet-d9a99439.js";import{I as i}from"./input-977568de.js";import{L as o}from"./label-6ced007b.js";const Y=()=>{const[g,N]=t.useState(""),[h,b]=t.useState(""),[p,w]=t.useState(""),[d,C]=t.useState(""),[x,v]=t.useState(!1),c=E(),{signUp:R,user:l}=H(),j=L();t.useEffect(()=>{(async()=>{if(l){const{data:r}=await D.from("stores").select("category").eq("owner_id",l.id).maybeSingle();r&&(c("/tienda/dashboard"),n({title:"Acceso Redirigido",description:`Ya tienes registrado un negocio de tipo "${r.category}".`}))}})()},[l,c,j.search]);const m=new URLSearchParams(j.search).get("service")||"General",P={Restaurante:"Restaurante",Hotel:"Hotel",Ropa:"Tienda de Ropa / Moda",Farmacia:"Farmacia / Droguería",Papelería:"Papelería / Miscelánea",Panadería:"Panadería / Repostería",Supermercado:"Supermercado / Abarrotes",Cultivador:"Cultivadores",General:"Otro Comercio"},S=async a=>{a.preventDefault(),v(!0);try{const{user:r,error:u}=await R(g,h,{data:{role:"tienda",store_name:p,address:d,address:d,category:m,service_category:P[m]||"Domicilios"}},!0);if(u){let s=u.message;u.code==="user_already_exists"||s==="User already registered"||s.includes("already registered")?s="Este correo electrónico ya está registrado. Por favor intenta iniciar sesión.":s.includes("Password should be")&&(s="La contraseña debe tener al menos 6 caracteres."),n({title:"Error de Registro",description:s,variant:"destructive"})}else r&&(n({title:"Registro Exitoso",description:"¡Bienvenido! Hemos enviado un correo de confirmación. Por favor, revisa tu bandeja de entrada."}),c("/tienda/dashboard"))}catch(r){console.error(r),n({title:"Error Inesperado",description:"Ha ocurrido un error inesperado. Por favor, inténtalo de nuevo.",variant:"destructive"})}finally{v(!1)}};return e.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center bg-gray-50 dark:bg-gray-900 p-4 relative",children:[e.jsxs(O,{children:[e.jsx("title",{children:"Registro de Negocio | MiOriente"}),e.jsx("meta",{name:"description",content:"Registra tu tienda, restaurante o servicio en MiOriente."})]}),e.jsx("div",{className:"absolute top-4 left-4 z-10",children:e.jsx(y,{variant:"outline",size:"icon",asChild:!0,className:"bg-white/80 backdrop-blur-sm hover:bg-white shadow-sm",children:e.jsxs(f,{to:"/",children:[e.jsx(k,{className:"h-5 w-5 text-gray-700 dark:text-gray-300"}),e.jsx("span",{className:"sr-only",children:"Volver al Inicio"})]})})}),e.jsxs(T,{className:"w-full max-w-md shadow-lg rounded-lg",children:[e.jsxs(q,{className:"text-center",children:[e.jsx(F,{className:"text-3xl font-bold",children:"Registrar Negocio"}),e.jsx(M,{className:"text-muted-foreground mt-2",children:"Únete a MiOriente y empieza a vender tus productos/servicios."})]}),e.jsx(_,{children:e.jsxs("form",{onSubmit:S,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"serviceType",children:"Tipo de Negocio"}),e.jsx(i,{id:"serviceType",type:"text",value:m,readOnly:!0,className:"mt-1 bg-gray-100 dark:bg-gray-800"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"storeName",children:"Nombre del Negocio"}),e.jsx(i,{id:"storeName",type:"text",placeholder:"Mi Tienda de Ejemplo",value:p,onChange:a=>w(a.target.value),required:!0,className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"address",children:"Dirección del Negocio"}),e.jsx(i,{id:"address",type:"text",placeholder:"Calle 123 #45-67",value:d,onChange:a=>C(a.target.value),required:!0,className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"email",children:"Email"}),e.jsx(i,{id:"email",type:"email",placeholder:"email@ejemplo.com",value:g,onChange:a=>N(a.target.value),required:!0,className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"password",children:"Contraseña"}),e.jsx(i,{id:"password",type:"password",placeholder:"••••••••",value:h,onChange:a=>b(a.target.value),required:!0,className:"mt-1"})]}),e.jsx(y,{type:"submit",className:"w-full",disabled:x,children:x?e.jsx(A,{className:"mr-2 h-4 w-4 animate-spin"}):"Registrar Negocio"}),e.jsxs("p",{className:"text-center text-sm text-muted-foreground",children:["¿Ya tienes cuenta?"," ",e.jsx(f,{to:"/tienda/login",className:"text-primary hover:underline",children:"Ingresar"})]})]})})]})]})};export{Y as default};
