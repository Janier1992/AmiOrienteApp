import{S as H,c as B,D as ie,b as d,_ as N,w as u,y as e,A as M,x as h,I as le,d as D,p as ne,q as oe,i as de,H as ce,J as me,M as ue,K as he,k as pe,r as xe}from"./index-2ce94096.js";import{V as ge,G as ve,k as O,L as k}from"./tabs-8fb332c0-10ad8328.js";import{G as fe}from"./Helmet-c26e192a-711588c7.js";import{r as C}from"./truck-4de66a3b-1e0700fb.js";import{P as E,T as je,M as be,b as I,C as R,h as Ne}from"./TileLayer-d24ab436-45dd9d60.js";import{t as z}from"./package-8a53cd5c-b574c2fa.js";import{o as V}from"./map-pin-4c971ad0-cfbd587c.js";import{i as ye}from"./navigation-486c38dd-b9d92327.js";import{n as we}from"./phone-a0962fdb-ede31c6e.js";import{t as Ee}from"./check-d1d3ff5a-31b10f76.js";import{e as _e}from"./log-out-8e22b546-d2fb474d.js";/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ce=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],Se=H("eye",Ce);/**
* @license lucide-react v0.561.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const De=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]],P=H("history",De);function Ae(){return Ne().map}const Oe=({isConnected:r,orders:s,onAcceptOrder:a,onViewDetails:t})=>r?s.length===0?e.jsxs("div",{className:"text-center py-12 bg-slate-100 rounded-lg",children:[e.jsx(C,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 font-medium",children:"No hay pedidos disponibles por ahora."})]}):e.jsx("div",{className:"space-y-4",children:s.map(i=>{var n,l;return e.jsx(D,{className:"p-4",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-bold",children:["Pedido #",i.id.substring(0,8)]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["De: ",e.jsx("span",{className:"font-semibold",children:((n=i.stores)==null?void 0:n.name)||"N/A"})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Cliente: ",e.jsx("span",{className:"font-semibold",children:((l=i.profiles)==null?void 0:l.full_name)||"N/A"})]}),e.jsxs("p",{className:"text-lg font-bold text-green-600 mt-1",children:["$",Number(i.total).toLocaleString()]}),i.status==="Pendiente de pago en efectivo"&&e.jsx("p",{className:"text-xs font-semibold text-white bg-blue-600 px-2 py-1 rounded-full inline-block mt-2",children:"Pago en Efectivo"})]}),e.jsxs("div",{className:"flex flex-col items-end gap-2",children:[e.jsx(h,{onClick:()=>a(i.id),children:"Aceptar Pedido"}),e.jsxs(h,{variant:"outline",size:"sm",onClick:()=>t(i),children:[e.jsx(Se,{className:"mr-2 h-4 w-4"}),"Ver Detalles"]})]})]})},i.id)})}):e.jsxs("div",{className:"text-center py-12 bg-slate-100 rounded-lg",children:[e.jsx(C,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 font-medium",children:"Conéctate para ver pedidos disponibles."})]});delete E.Icon.Default.prototype._getIconUrl;E.Icon.Default.mergeOptions({iconRetinaUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-2x.png",iconUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png"});const ke=new E.Icon({iconUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-blue.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),Ie=new E.Icon({iconUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-green.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),Re=new E.Icon({iconUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-red.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),ze=({bounds:r})=>{const s=Ae();return d.useEffect(()=>{r&&r.isValid()&&s.fitBounds(r,{padding:[50,50]})},[s,r]),null},Pe=({delivery:r})=>{const s=r==null?void 0:r.pickup_coords,a=r==null?void 0:r.delivery_coords,t=r==null?void 0:r.delivery_person_location,i=d.useMemo(()=>{const l=[];return s&&l.push(s),a&&l.push(a),t&&l.push([t.lat,t.lng]),l.length<2?null:E.latLngBounds(l)},[s,a,t]),n=s||[6.15515,-75.37367];return e.jsx("div",{className:"h-64 w-full rounded-lg overflow-hidden mt-4 border",children:e.jsxs(je,{center:n,zoom:13,scrollWheelZoom:!1,style:{height:"100%",width:"100%"},children:[e.jsx(be,{attribution:'© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),s&&e.jsx(I,{position:s,icon:ke,children:e.jsxs(R,{children:["Recoger aquí: ",r==null?void 0:r.pickup_address]})}),a&&e.jsx(I,{position:a,icon:Ie,children:e.jsxs(R,{children:["Entregar aquí: ",r==null?void 0:r.delivery_address]})}),t&&e.jsx(I,{position:[t.lat,t.lng],icon:Re,children:e.jsx(R,{children:"Tu ubicación actual"})}),e.jsx(ze,{bounds:i})]})})},Ge=({orders:r,onCompleteOrder:s})=>r.length===0?e.jsxs("div",{className:"text-center py-12 bg-slate-100 rounded-lg",children:[e.jsx(z,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 font-medium",children:"No tienes entregas en curso."})]}):e.jsx("div",{className:"space-y-4",children:r.map(a=>{var t,i,n,l,o,p,g,j;return e.jsxs(D,{className:"p-4 border-2 border-blue-500 shadow-lg",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-bold text-blue-700",children:["Pedido #",a.id.substring(0,8)]}),e.jsxs("p",{className:"text-sm text-gray-600 mt-2",children:[e.jsx(V,{className:"inline h-4 w-4 mr-1 text-blue-500"}),"Recoger en: ",e.jsx("span",{className:"font-semibold",children:((t=a.deliveries)==null?void 0:t.pickup_address)||"N/A"})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx(V,{className:"inline h-4 w-4 mr-1 text-green-500"}),"Entregar a: ",e.jsx("span",{className:"font-semibold",children:((i=a.deliveries)==null?void 0:i.delivery_address)||"N/A"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-lg font-bold text-green-600",children:["$",Number(a.total).toLocaleString()]}),a.status==="Pendiente de pago en efectivo"&&e.jsx("p",{className:"text-xs font-semibold text-white bg-blue-600 px-2 py-1 rounded-full inline-block mt-1",children:"Cobrar en Efectivo"})]})]}),e.jsx(Pe,{delivery:a.deliveries}),e.jsxs("div",{className:"flex justify-end items-center mt-4 gap-2",children:[e.jsx("a",{href:`https://www.google.com/maps/dir/?api=1&origin=${encodeURIComponent(((n=a.deliveries)==null?void 0:n.pickup_address)||"")}&destination=${encodeURIComponent(((l=a.deliveries)==null?void 0:l.delivery_address)||"")}`,target:"_blank",rel:"noopener noreferrer",children:e.jsxs(h,{variant:"outline",size:"sm",disabled:!((o=a.deliveries)!=null&&o.pickup_address)||!((p=a.deliveries)!=null&&p.delivery_address),children:[e.jsx(ye,{className:"h-4 w-4 mr-2"}),"Navegar"]})}),e.jsx("a",{href:`tel:${(g=a.profiles)==null?void 0:g.phone}`,children:e.jsxs(h,{variant:"outline",size:"sm",disabled:!((j=a.profiles)!=null&&j.phone),children:[e.jsx(we,{className:"h-4 w-4 mr-2"}),"Llamar"]})}),e.jsxs(h,{size:"sm",className:"bg-green-600 hover:bg-green-700",onClick:()=>s(a.id),children:[e.jsx(Ee,{className:"h-4 w-4 mr-2"}),"Completar"]})]})]},a.id)})}),Te=({orders:r})=>r.length===0?e.jsxs("div",{className:"text-center py-12 bg-slate-100 rounded-lg",children:[e.jsx(P,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 font-medium",children:"Aún no has completado entregas."})]}):e.jsx("div",{className:"space-y-4",children:r.map(s=>e.jsx(D,{className:"p-4 bg-green-50 border-green-200",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-bold text-gray-700",children:["Pedido #",s.id.substring(0,8)]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Entregado el ",new Date(s.created_at).toLocaleDateString()]})]}),e.jsxs("p",{className:"text-lg font-bold text-green-700",children:["$",Number(s.total).toLocaleString()]})]})},s.id))}),qe=({order:r,open:s,onOpenChange:a})=>{var t,i,n;return e.jsx(oe,{open:s,onOpenChange:a,children:e.jsxs(de,{children:[e.jsxs(ce,{children:[e.jsxs(me,{children:["Detalles del Pedido #",r==null?void 0:r.id.substring(0,8)]}),e.jsxs(ue,{children:["De ",(t=r==null?void 0:r.stores)==null?void 0:t.name," para ",(i=r==null?void 0:r.profiles)==null?void 0:i.full_name,"."]})]}),e.jsx("div",{className:"space-y-4 max-h-[60vh] overflow-y-auto pr-2",children:(n=r==null?void 0:r.order_items)==null?void 0:n.map(l=>{var o,p,g;return e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("img",{src:((o=l.products)==null?void 0:o.image_url)||"https://placehold.co/64",alt:(p=l.products)==null?void 0:p.name,className:"w-16 h-16 rounded-md object-cover"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:(g=l.products)==null?void 0:g.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Cantidad: ",l.quantity]})]})]}),e.jsxs("p",{className:"font-semibold",children:["$",(l.price*l.quantity).toLocaleString()]})]},l.id)})}),e.jsx(he,{className:"pt-4 border-t",children:e.jsxs("div",{className:"w-full flex justify-between font-bold text-lg",children:[e.jsx("span",{children:"Total a Recaudar:"}),e.jsxs("span",{children:["$",Number(r==null?void 0:r.total).toLocaleString()]})]})})]})})},Le=["Listo para recogida","Pendiente","Pendiente de pago en efectivo"],m={BUSCANDO:"Buscando",ASIGNADO:"Asignado",RECOGIDO:"Recogido",EN_CAMINO:"En camino",ENTREGADO:"Entregado"},S={PEDIDOS_NO_CARGADOS:"No se pudieron cargar los pedidos disponibles",ENTREGA_NO_ENCONTRADA:"No se encontró la entrega especificada",ERROR_ACTUALIZACION:"No se pudo actualizar el estado de la entrega"};function f(r,s="ID"){if(!r||typeof r!="string"||r.trim()==="")throw new Error(`${s} es requerido y debe ser válido`)}function y(r,s){throw console.error(`[deliveryService] ${s}:`,r),new Error(r.message||s)}const w={async obtenerPedidosDisponibles(){try{const{data:r,error:s}=await u.from("orders").select(`
          id, 
          created_at, 
          total, 
          status, 
          delivery_address,
          delivery_lat,
          delivery_lng,
          stores (id, name, address, lat, lng, phone),
          profiles (full_name, phone)
        `).in("status",Le).order("created_at",{ascending:!1});s&&y(s,S.PEDIDOS_NO_CARGADOS);const a=[];for(const t of r||[]){const{data:i}=await u.from("deliveries").select("id").eq("order_id",t.id).in("status",[m.ASIGNADO,m.RECOGIDO,m.EN_CAMINO]).maybeSingle();i||a.push(t)}return a}catch(r){y(r,S.PEDIDOS_NO_CARGADOS)}},async getAvailableDeliveries(){return this.obtenerPedidosDisponibles()},async getAvailableOrders(){return this.obtenerPedidosDisponibles()},async obtenerEntregaActual(r){f(r,"ID del domiciliario");try{const{data:s,error:a}=await u.from("deliveries").select(`
          *,
          orders (
            id, 
            total, 
            status, 
            delivery_address,
            delivery_lat,
            delivery_lng,
            created_at,
            stores (name, address, phone, lat, lng),
            profiles (full_name, phone),
            order_items (quantity, products!order_items_product_id_fkey(name))
          )
        `).eq("delivery_person_id",r).in("status",[m.ASIGNADO,m.RECOGIDO,m.EN_CAMINO]).order("created_at",{ascending:!1}).maybeSingle();return a?(console.error("[deliveryService] Error obteniendo entrega actual:",a),null):s}catch(s){return console.error("[deliveryService] Error inesperado:",s),null}},async getCurrentDelivery(r){return this.obtenerEntregaActual(r)},async aceptarEntrega(r,s){f(r,"ID del pedido"),f(s,"ID del domiciliario");try{const{data:a}=await u.from("deliveries").select("id").eq("order_id",r).not("status","eq",m.ENTREGADO).maybeSingle();if(a)throw new Error("Este pedido ya fue tomado por otro domiciliario");const{data:t,error:i}=await u.from("deliveries").insert({order_id:r,delivery_person_id:s,status:m.ASIGNADO,assigned_at:new Date().toISOString()}).select().single();return i&&y(i,"Error al aceptar la entrega"),await u.from("orders").update({status:"En curso"}).eq("id",r),t}catch(a){y(a,"Error al aceptar la entrega")}},async acceptDelivery(r,s){return this.aceptarEntrega(r,s)},async actualizarEstadoEntrega(r,s){f(r,"ID del pedido");const a=Object.values(m);if(!a.includes(s))throw new Error(`Estado inválido. Debe ser uno de: ${a.join(", ")}`);try{const t={status:s};s===m.ENTREGADO&&(t.delivered_at=new Date().toISOString()),s===m.RECOGIDO&&(t.picked_up_at=new Date().toISOString());const{data:i,error:n}=await u.from("deliveries").update(t).eq("order_id",r).select().single();return n&&y(n,S.ERROR_ACTUALIZACION),s===m.ENTREGADO&&await u.from("orders").update({status:"Entregado"}).eq("id",r),i}catch(t){y(t,S.ERROR_ACTUALIZACION)}},async updateDeliveryStatus(r,s){return this.actualizarEstadoEntrega(r,s)},async actualizarUbicacion(r,s,a){if(f(r,"ID del domiciliario"),typeof s!="number"||typeof a!="number")throw new Error("Latitud y longitud deben ser números válidos");if(s<-90||s>90||a<-180||a>180)throw new Error("Coordenadas fuera de rango válido");try{const{error:t}=await u.from("delivery_locations").upsert({delivery_person_id:r,lat:s,lng:a,updated_at:new Date().toISOString()},{onConflict:"delivery_person_id"});t&&console.error("[deliveryService] Error actualizando ubicación:",t)}catch(t){console.error("[deliveryService] Error inesperado en ubicación:",t)}},async updateLocation(r,s,a){return this.actualizarUbicacion(r,s,a)},async obtenerEstadisticas(r){f(r,"ID del domiciliario");try{const{data:s,error:a}=await u.from("deliveries").select("id, created_at, delivered_at, orders(total)").eq("delivery_person_id",r).eq("status",m.ENTREGADO);if(a)return console.error("[deliveryService] Error obteniendo estadísticas:",a),{totalEntregas:0,gananciaTotal:0};const t=(s==null?void 0:s.length)||0,i=(s==null?void 0:s.reduce((n,l)=>{var o;const p=Number((o=l.orders)==null?void 0:o.total)||0;return n+p*.1},0))||0;return{totalEntregas:t,gananciaTotal:Math.round(i)}}catch(s){return console.error("[deliveryService] Error:",s),{totalEntregas:0,gananciaTotal:0}}},async obtenerHistorialEntregas(r,s=20){f(r,"ID del domiciliario");try{const{data:a,error:t}=await u.from("deliveries").select(`
          *,
          orders (
            total, 
            delivery_address,
            stores (name)
          )
        `).eq("delivery_person_id",r).eq("status",m.ENTREGADO).order("delivered_at",{ascending:!1}).limit(s);return t?(console.error("[deliveryService] Error:",t),[]):a||[]}catch(a){return console.error("[deliveryService] Error:",a),[]}}},$e=({isOpen:r,onClose:s,activeTab:a,onTabChange:t,isConnected:i,onConnect:n,onLogout:l,user:o})=>{const p=B();return e.jsxs(e.Fragment,{children:[r&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-40 lg:hidden backdrop-blur-sm transition-opacity",onClick:s}),e.jsx("aside",{className:`
                  fixed top-0 left-0 z-50 h-full w-64 bg-card border-r shadow-lg lg:shadow-none lg:relative lg:translate-x-0
                  transform transition-transform duration-300 ease-in-out
                  ${r?"translate-x-0":"-translate-x-full"}
                `,children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"flex items-center justify-between h-16 border-b px-4 shrink-0 bg-primary/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{className:"h-5 w-5 text-primary"}),e.jsx("span",{className:"font-bold text-lg",children:"Domiciliario"})]}),e.jsx(h,{variant:"ghost",size:"icon",className:"lg:hidden",onClick:s,children:e.jsx(pe,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"p-4 space-y-4 flex-1",children:[e.jsxs("div",{id:"delivery-status-card",className:"p-4 bg-muted/30 rounded-lg border",children:[e.jsxs("p",{className:"text-sm font-medium mb-2",children:["Estado: ",e.jsx("span",{className:i?"text-green-600":"text-gray-500",children:i?"Conectado":"Desconectado"})]}),e.jsx(h,{onClick:n,size:"sm",className:`w-full ${i?"bg-destructive hover:bg-destructive/80":"bg-primary hover:bg-primary/80"}`,children:i?"Desconectarse":"Conectarse"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs(h,{variant:a==="disponibles"?"secondary":"ghost",className:"w-full justify-start",onClick:()=>{t("disponibles"),s()},children:[e.jsx(z,{className:"mr-2 h-4 w-4"})," Disponibles"]}),e.jsxs(h,{variant:a==="curso"?"secondary":"ghost",className:"w-full justify-start",onClick:()=>{t("curso"),s()},children:[e.jsx(C,{className:"mr-2 h-4 w-4"})," En curso"]}),e.jsxs(h,{variant:a==="historial"?"secondary":"ghost",className:"w-full justify-start",onClick:()=>{t("historial"),s()},children:[e.jsx(P,{className:"mr-2 h-4 w-4"})," Historial"]})]})]}),e.jsxs("div",{className:"p-4 border-t space-y-2 bg-muted/10",children:[e.jsxs("div",{className:"px-2 pb-2",children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground",children:"Conectado como:"}),e.jsx("p",{className:"text-sm truncate font-semibold",title:o==null?void 0:o.email,children:o==null?void 0:o.email})]}),e.jsxs(h,{variant:"outline",className:"w-full justify-start",onClick:()=>p("/"),children:[e.jsx(xe,{className:"mr-2 h-4 w-4"})," Ir al inicio"]}),e.jsxs(h,{variant:"ghost",className:"w-full justify-start text-red-600 hover:text-red-700 hover:bg-red-50",onClick:l,children:[e.jsx(_e,{className:"mr-2 h-4 w-4"})," Cerrar Sesión"]})]})]})})]})},Xe=()=>{const r=B(),{user:s,signOut:a,loading:t}=ie(),[i,n]=d.useState(!1),[l,o]=d.useState("disponibles"),[p,g]=d.useState([]),[j,Z]=d.useState(null),[G,F]=d.useState([]),[J,T]=d.useState(!0),[K,W]=d.useState(null),[Q,q]=d.useState(!1),[X,L]=d.useState(!1),_=d.useRef(null),v=d.useCallback(async c=>{if(c){T(!0);try{const x=await w.obtenerPedidosDisponibles();g(x||[]);const b=await w.obtenerEntregaActual(c);let $=[];b&&b.orders&&($=[{...b.orders,deliveries:[b]}]),Z($);const te=(await w.obtenerHistorialEntregas(c)).map(U=>({...U.orders,deliveries:[U]}));F(te)}catch(x){console.error("Error fetching data:",x),N({title:"Error",description:"No se pudieron cargar los datos.",variant:"destructive"})}finally{T(!1)}}},[]);d.useEffect(()=>{if(!t){if(!s){r("/domiciliario/login");return}v(s.id)}},[s,r,t,v]),d.useEffect(()=>{if(!s)return;const c=u.channel("public-changes").on("postgres_changes",{event:"*",schema:"public",table:"orders"},()=>v(s.id)).on("postgres_changes",{event:"*",schema:"public",table:"deliveries"},()=>v(s.id)).subscribe();return()=>{u.removeChannel(c)}},[s,v]);const A=d.useCallback(async()=>{s&&navigator.geolocation.getCurrentPosition(async c=>{const{latitude:x,longitude:b}=c.coords;await w.actualizarUbicacion(s.id,x,b)},c=>console.error("Error getting location:",c),{enableHighAccuracy:!0})},[s]);d.useEffect(()=>(i?(A(),_.current=setInterval(A,3e4)):_.current&&clearInterval(_.current),()=>{_.current&&clearInterval(_.current)}),[i,A]);const Y=()=>n(!i),ee=async()=>{await a(),N({title:"Sesión cerrada"})},se=async c=>{if(s)try{await w.aceptarEntrega(c,s.id),await v(s.id),N({title:"¡Pedido Aceptado!",description:"El pedido ahora está en tu lista 'En Curso'."}),o("curso")}catch(x){console.error("Error accepting order:",x),N({title:"Error",description:x.message||"No se pudo aceptar el pedido.",variant:"destructive"})}},re=async c=>{try{await w.actualizarEstadoEntrega(c,"Entregado"),await v(s.id),N({title:"¡Entrega Completada!",description:"¡Buen trabajo!"}),o("historial")}catch(x){console.error("Error completing order:",x),N({title:"Error",description:x.message||"No se pudo completar la entrega.",variant:"destructive"})}},ae=c=>{W(c),q(!0)};return t?e.jsxs("div",{className:"min-h-screen bg-background flex items-center justify-center",children:[e.jsx(M,{className:"h-8 w-8 animate-spin text-primary"}),e.jsx("p",{className:"ml-2 text-foreground",children:"Cargando..."})]}):e.jsxs("div",{className:"min-h-screen bg-background flex flex-col lg:flex-row",children:[e.jsx(fe,{children:e.jsx("title",{children:"Panel Domiciliario"})}),e.jsxs(h,{variant:"outline",size:"icon",className:"fixed top-4 left-4 z-50 lg:hidden shadow-md bg-background",onClick:()=>L(!0),children:[e.jsx(le,{className:"h-5 w-5"}),e.jsx("span",{className:"sr-only",children:"Menu"})]}),e.jsx($e,{isOpen:X,onClose:()=>L(!1),activeTab:l,onTabChange:o,isConnected:i,onConnect:Y,onLogout:ee,user:s}),e.jsx("main",{className:"flex-1 p-4 sm:p-6 lg:p-8 mt-16 lg:mt-0 min-w-0 overflow-y-auto max-h-screen",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-6",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Panel de Entregas"}),e.jsx("p",{className:"text-muted-foreground",children:"Gestiona tus pedidos disponibles y entregas activas."})]})}),e.jsx(D,{className:"bg-card text-card-foreground border-border w-full",children:e.jsx(ne,{className:"p-0 sm:p-6",children:J?e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsx(M,{className:"animate-spin h-8 w-8 text-primary"})}):e.jsxs(ge,{value:l,onValueChange:o,className:"w-full",children:[e.jsxs(ve,{className:"grid w-full grid-cols-3 mb-6 bg-muted/50 p-1",children:[e.jsxs(O,{id:"tab-trigger-disponibles",value:"disponibles",className:"text-xs sm:text-sm",children:[e.jsx(z,{className:"mr-1 sm:mr-2 h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Disponibles"})," (",p.length,")"]}),e.jsxs(O,{id:"tab-trigger-curso",value:"curso",className:"text-xs sm:text-sm",children:[e.jsx(C,{className:"mr-1 sm:mr-2 h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"En curso"})," (",j?j.length:0,")"]}),e.jsxs(O,{id:"tab-trigger-historial",value:"historial",className:"text-xs sm:text-sm",children:[e.jsx(P,{className:"mr-1 sm:mr-2 h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Historial"})," (",G.length,")"]})]}),e.jsxs("div",{className:"p-4 sm:p-0",children:[e.jsx(k,{id:"delivery-available-list",value:"disponibles",className:"mt-0",children:e.jsx(Oe,{isConnected:i,orders:p,onAcceptOrder:se,onViewDetails:ae})}),e.jsx(k,{id:"delivery-active-map",value:"curso",className:"mt-0",children:e.jsx(Ge,{orders:j||[],onCompleteOrder:re})}),e.jsx(k,{value:"historial",className:"mt-0",children:e.jsx(Te,{orders:G})})]})]})})})]})}),e.jsx(qe,{order:K,open:Q,onOpenChange:q})]})};export{Xe as default};
