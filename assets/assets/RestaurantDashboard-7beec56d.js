import{l as A,k as N,Q as Y,r as p,j as e,C as F,a as B,b as V,B as g,c as G,t as u,P as Z,q as ee,T as ae,D as k,v as R,z as P,E as D,F as te,G as I,R as _,_ as w}from"./index-3101bb07.js";import{F as re,B as se}from"./BulkUploadTab-0fe3efc4.js";import{L as ie,B as ne}from"./BaseStoreDashboard-9ad5c13e.js";import{B as H}from"./badge-34bdff7c.js";import{s as f}from"./useStoreDashboard-6cfa5bdd.js";import{C as oe,R as ce}from"./RestaurantMenuView-c52c06fd.js";import le from"./GenericPOSView-65865e30.js";import{I as j}from"./input-977568de.js";import{L as h}from"./label-6ced007b.js";import{S as de,a as me,b as pe,c as ue,d as M}from"./select-03f52418.js";import{T as xe}from"./textarea-03a75c76.js";import{L as he}from"./index-6c60542e.js";import{C as ge}from"./calendar-71354730.js";import{H as z}from"./history-a917c19b.js";import{S as je}from"./save-155183cf.js";import{C as fe}from"./credit-card-bcc8ac59.js";import{U as be}from"./utensils-crossed-8251ba29.js";import{U as ye}from"./upload-8259cec2.js";import{D as ve,S as Ne}from"./settings-96af137d.js";import{U as _e}from"./users-93d0d9a2.js";import"./circle-alert-58769497.js";import"./Helmet-d9a99439.js";import"./log-out-1de3e3ee.js";import"./switch-4dcb0898.js";import"./index-e23a302d.js";import"./search-566f00ed.js";import"./pencil-b145156d.js";import"./scroll-area-d0c9b1aa.js";import"./shopping-cart-8aca5ef3.js";import"./circle-check-big-68527463.js";import"./check-78166ef5.js";import"./triangle-alert-5ea4272b.js";/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const we=[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]],Ce=A("layout-grid",we);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ee=[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.106-3.105c.32-.322.863-.22.983.218a6 6 0 0 1-8.259 7.057l-7.91 7.91a1 1 0 0 1-2.999-3l7.91-7.91a6 6 0 0 1 7.057-8.259c.438.12.54.662.219.984z",key:"1ngwbx"}]],T=A("wrench",Ee),C={async getTables(t){const{data:o,error:r}=await N.from("restaurant_tables").select("*").eq("store_id",t).order("number");if(r)throw r;return o},async createTable(t){const{data:o,error:r}=await N.from("restaurant_tables").insert(t).select().single();if(r)throw r;return o},async updateTableStatus(t,o){const{error:r}=await N.from("restaurant_tables").update({status:o}).eq("id",t);if(r)throw r},async createPOSTransaction({orderPayload:t,items:o}){const{data:r,error:s}=await N.from("orders").insert(t).select().single();if(s)throw s;const c=o.map(n=>({order_id:r.id,product_id:n.id,quantity:n.qty,price:n.price})),{error:i}=await N.from("order_items").insert(c);if(i)throw console.error("Error creating items",i),i;return r}},U=Y((t,o)=>({tables:[],products:[],cart:[],isLoadingTables:!1,isLoadingCheckout:!1,error:null,addToCart:r=>{const s=o().cart,c=s.find(i=>i.id===r.id);if(c){if(r.stock!==void 0&&c.qty>=r.stock)return!1;t({cart:s.map(i=>i.id===r.id?{...i,qty:i.qty+1}:i)})}else t({cart:[...s,{...r,qty:1}]});return!0},removeFromCart:r=>{t(s=>({cart:s.cart.filter(c=>c.id!==r)}))},updateCartQty:(r,s)=>{t(c=>({cart:c.cart.map(i=>{if(i.id===r){const n=Math.max(1,i.qty+s);return s>0&&i.stock!==void 0&&n>i.stock?i:{...i,qty:n}}return i})}))},clearCart:()=>t({cart:[]}),processCheckout:async(r,s,c,i)=>{const n=o().cart;if(n.length===0)return;const y=typeof s=="object"?{name:s.name,doc_id:s.docId,phone:s.phone,email:s.email,method:c,type:"POS"}:{name:s,method:c,type:"POS"};t({isLoadingCheckout:!0});try{const l={store_id:r,customer_id:null,status:"Entregado",total:i,delivery_address:JSON.stringify({guest:y,items:n.map(d=>({id:d.id,name:d.name,qty:d.qty,price:d.price}))})};return await C.createPOSTransaction({orderPayload:l,items:n}),o().clearCart(),!0}catch(l){throw l}finally{t({isLoadingCheckout:!1})}},fetchTables:async r=>{t({isLoadingTables:!0,error:null});try{const s=await C.getTables(r);t({tables:s})}catch(s){t({error:s.message})}finally{t({isLoadingTables:!1})}},addTable:async r=>{try{const s=await C.createTable(r);return t(c=>({tables:[...c.tables,s]})),s}catch(s){throw s}},toggleTableStatus:async(r,s)=>{const c=s==="available"?"occupied":"available",i=o().tables;t({tables:i.map(n=>n.id===r?{...n,status:c}:n)});try{await C.updateTableStatus(r,c)}catch(n){throw t({tables:i}),n}},fetchProducts:async r=>{try{const s=await f.getProducts(r);t({products:s})}catch(s){console.error("Error fetching products for POS:",s)}}})),Se=({storeId:t})=>{const{tables:o,fetchTables:r,addTable:s,toggleTableStatus:c,isLoadingTables:i,error:n}=U();p.useEffect(()=>{t&&r(t)},[t,r]);const y=async()=>{const l=prompt("Número de mesa:");if(l)try{await s({store_id:t,number:l,capacity:4}),u({title:"Mesa agregada"})}catch(d){u({title:"Error",description:d.message,variant:"destructive"})}};return i&&o.length===0?e.jsx("div",{className:"p-4",children:"Cargando mesas..."}):e.jsxs(F,{children:[e.jsxs(B,{className:"flex flex-row items-center justify-between",children:[e.jsx(V,{children:"Gestión de Mesas"}),e.jsx(g,{onClick:y,children:"+ Agregar Mesa"})]}),e.jsxs(G,{children:[n&&e.jsxs("p",{className:"text-red-500 mb-4",children:["Error: ",n]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4",children:[o.map(l=>e.jsxs("div",{className:`p-4 rounded-lg border-2 cursor-pointer transition-all ${l.status==="occupied"?"bg-red-50 border-red-200":"bg-green-50 border-green-200"}`,onClick:()=>c(l.id,l.status),children:[e.jsx("div",{className:"text-2xl font-bold text-center mb-2",children:l.number}),e.jsx(H,{variant:l.status==="occupied"?"destructive":"default",className:"w-full justify-center",children:l.status==="occupied"?"Ocupada":"Libre"})]},l.id)),o.length===0&&!i&&e.jsx("p",{className:"col-span-full text-center text-gray-500",children:"Agrega mesas para gestionarlas aquí."})]})]})]})},Te=({storeId:t})=>{const[o,r]=p.useState([]),[s,c]=p.useState(!0),[i,n]=p.useState(!1),[y,l]=p.useState(!1),[d,$]=p.useState(null),[q,L]=p.useState([]),[Q,O]=p.useState(!1),[x,v]=p.useState({name:"",serial_number:"",purchase_date:"",status:"operational",next_maintenance_date:""}),[m,b]=p.useState({type:"preventive",description:"",cost:"",performed_by:"",date:new Date().toISOString().split("T")[0]}),E=async()=>{if(t){c(!0);try{const a=await f.getEquipment(t);r(a)}catch{u({title:"Error",description:"No se pudieron cargar los equipos.",variant:"destructive"})}finally{c(!1)}}};p.useEffect(()=>{E()},[t]);const J=async()=>{if(!x.name){u({title:"Error",description:"El nombre es requerido",variant:"destructive"});return}try{await f.addEquipment({...x,store_id:t}),u({title:"Éxito",description:"Equipo registrado correctamente."}),n(!1),v({name:"",serial_number:"",purchase_date:"",status:"operational",next_maintenance_date:""}),E()}catch{u({title:"Error",description:"No se pudo registrar el equipo.",variant:"destructive"})}},K=async a=>{if(confirm("¿Estás seguro de eliminar este equipo? Se borrará su historial."))try{await f.deleteEquipment(a),u({title:"Eliminado",description:"Equipo eliminado del sistema."}),E()}catch{u({title:"Error",description:"No se pudo eliminar.",variant:"destructive"})}},W=async a=>{$(a),l(!0),O(!0);try{const S=await f.getMaintenanceLogs(a.id);L(S)}catch{u({title:"Error",description:"No se pudo cargar la bitácora."})}finally{O(!1)}},X=async()=>{if(m.description)try{await f.addMaintenanceLog({...m,equipment_id:d.id}),u({title:"Registrado",description:"Mantenimiento registrado."});const a=await f.getMaintenanceLogs(d.id);L(a),b({type:"preventive",description:"",cost:"",performed_by:"",date:new Date().toISOString().split("T")[0]})}catch{u({title:"Error",description:"Fallo al registrar mantenimiento.",variant:"destructive"})}};return s?e.jsx(he,{text:"Cargando inventario..."}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-orange-50 border border-orange-100 p-6 rounded-2xl flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-extrabold text-orange-900 flex items-center gap-3",children:[e.jsx(T,{className:"h-8 w-8 text-orange-600"}),"Mantenimiento de Equipos"]}),e.jsx("p",{className:"text-orange-800 mt-2",children:"Gestiona el estado y cronograma de mantenimiento de tu maquinaria."})]}),e.jsxs(g,{className:"bg-orange-600 hover:bg-orange-700",onClick:()=>n(!0),children:[e.jsx(Z,{className:"h-4 w-4 mr-2"})," Registrar Equipo"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[o.length===0&&e.jsxs("div",{className:"col-span-full text-center py-12 text-gray-500",children:[e.jsx(T,{className:"h-12 w-12 mx-auto mb-4 opacity-20"}),e.jsx("p",{children:"No hay equipos registrados aún."})]}),o.map(a=>e.jsxs(F,{className:`border-l-4 shadow-sm hover:shadow-md transition-shadow ${a.status==="maintenance_needed"||a.status==="in_repair"?"border-l-red-500":"border-l-green-500"}`,children:[e.jsxs(B,{className:"pb-2",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx(V,{className:"text-lg font-bold text-gray-800 truncate",title:a.name,children:a.name}),e.jsx(H,{variant:a.status==="operational"?"default":"destructive",className:a.status==="operational"?"bg-green-100 text-green-800 hover:bg-green-100":"",children:a.status==="operational"?"Operativo":a.status==="maintenance_needed"?"Mantenimiento Req.":a.status==="in_repair"?"En Reparación":"Retirado"})]}),e.jsx("p",{className:"text-xs text-gray-500 truncate",children:a.serial_number?`S/N: ${a.serial_number}`:"Sin N/S"})]}),e.jsx(G,{children:e.jsx("div",{className:"space-y-3 text-sm",children:e.jsxs("div",{className:`flex items-center font-medium ${a.next_maintenance_date&&new Date(a.next_maintenance_date)<new Date?"text-red-600":"text-blue-600"}`,children:[e.jsx(ge,{className:"h-4 w-4 mr-2"}),e.jsxs("span",{children:["Próximo: ",a.next_maintenance_date||"No programado"]})]})})}),e.jsxs(ee,{className:"pt-2 flex gap-2 border-t",children:[e.jsxs(g,{variant:"outline",size:"sm",className:"flex-1 text-xs",onClick:()=>W(a),children:[e.jsx(z,{className:"h-3 w-3 mr-1"})," Bitácora"]}),e.jsx(g,{variant:"ghost",size:"sm",className:"text-red-500 hover:text-red-700 hover:bg-red-50 p-2",onClick:()=>K(a.id),children:e.jsx(ae,{className:"h-4 w-4"})})]})]},a.id))]}),e.jsx(k,{open:i,onOpenChange:n,children:e.jsxs(R,{children:[e.jsxs(P,{children:[e.jsx(D,{children:"Registrar Nuevo Equipo"}),e.jsx(te,{children:"Ingresa los datos técnicos del equipo."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Nombre del Equipo"}),e.jsx(j,{value:x.name,onChange:a=>v({...x,name:a.target.value}),placeholder:"Ej. Horno Industrial"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Número de Serie"}),e.jsx(j,{value:x.serial_number,onChange:a=>v({...x,serial_number:a.target.value}),placeholder:"Opcional"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Fecha Compra"}),e.jsx(j,{type:"date",value:x.purchase_date,onChange:a=>v({...x,purchase_date:a.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Prox. Mantenimiento"}),e.jsx(j,{type:"date",value:x.next_maintenance_date,onChange:a=>v({...x,next_maintenance_date:a.target.value})})]})]})]}),e.jsxs(I,{children:[e.jsx(g,{variant:"outline",onClick:()=>n(!1),children:"Cancelar"}),e.jsx(g,{onClick:J,children:"Guardar Equipo"})]})]})}),e.jsx(k,{open:y,onOpenChange:l,children:e.jsxs(R,{className:"max-w-2xl",children:[e.jsx(P,{children:e.jsxs(D,{children:["Bitácora: ",d==null?void 0:d.name]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 h-[400px]",children:[e.jsxs("div",{className:"border rounded-lg p-4 overflow-y-auto space-y-3 bg-slate-50",children:[e.jsxs("h4",{className:"font-semibold text-sm mb-2 flex items-center",children:[e.jsx(z,{className:"h-4 w-4 mr-2"})," Historial"]}),Q?e.jsx("p",{className:"text-xs text-gray-500",children:"Cargando..."}):q.length===0?e.jsx("p",{className:"text-xs text-gray-400 italic",children:"Sin registros."}):q.map(a=>e.jsxs("div",{className:"bg-white p-3 rounded border text-sm shadow-sm",children:[e.jsxs("div",{className:"flex justify-between font-semibold text-xs text-gray-500 mb-1",children:[e.jsx("span",{children:a.date}),e.jsx("span",{className:a.type==="corrective"?"text-red-500":"text-blue-500 uppercase",children:a.type})]}),e.jsx("p",{className:"text-gray-800",children:a.description}),(a.cost>0||a.performed_by)&&e.jsxs("div",{className:"mt-2 text-xs text-gray-500 flex gap-4 pt-1 border-t border-gray-100",children:[a.cost>0&&e.jsxs("span",{children:["Coste: $",Number(a.cost).toLocaleString()]}),a.performed_by&&e.jsxs("span",{children:["Por: ",a.performed_by]})]})]},a.id))]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h4",{className:"font-semibold text-sm mb-2 flex items-center",children:[e.jsx(re,{className:"h-4 w-4 mr-2"})," Nuevo Registro"]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border space-y-3",children:[e.jsxs("div",{children:[e.jsx(h,{className:"text-xs",children:"Tipo"}),e.jsxs(de,{value:m.type,onValueChange:a=>b({...m,type:a}),children:[e.jsx(me,{children:e.jsx(pe,{})}),e.jsxs(ue,{children:[e.jsx(M,{value:"preventive",children:"Preventivo"}),e.jsx(M,{value:"corrective",children:"Correctivo (Reparación)"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx(h,{className:"text-xs",children:"Fecha"}),e.jsx(j,{type:"date",className:"h-8",value:m.date,onChange:a=>b({...m,date:a.target.value})})]}),e.jsxs("div",{children:[e.jsx(h,{className:"text-xs",children:"Costo"}),e.jsx(j,{type:"number",className:"h-8",placeholder:"0",value:m.cost,onChange:a=>b({...m,cost:a.target.value})})]})]}),e.jsxs("div",{children:[e.jsx(h,{className:"text-xs",children:"Realizado por"}),e.jsx(j,{className:"h-8",placeholder:"Técnico / Empresa",value:m.performed_by,onChange:a=>b({...m,performed_by:a.target.value})})]}),e.jsxs("div",{children:[e.jsx(h,{className:"text-xs",children:"Descripción"}),e.jsx(xe,{className:"h-20 text-xs",placeholder:"Detalle del trabajo realizado...",value:m.description,onChange:a=>b({...m,description:a.target.value})})]}),e.jsxs(g,{className:"w-full",size:"sm",onClick:X,children:[e.jsx(je,{className:"h-3 w-3 mr-2"})," Guardar Registro"]})]})]})]}),e.jsx(I,{children:e.jsx(g,{variant:"outline",onClick:()=>l(!1),children:"Cerrar"})})]})})]})},qe=_.lazy(()=>w(()=>import("./OverviewTab-a01a807a.js"),["./OverviewTab-a01a807a.js","./index-3101bb07.js","./index-dc19931e.css","./useStoreDashboard-6cfa5bdd.js","./index-6c60542e.js","./triangle-alert-5ea4272b.js","./settings-96af137d.js","./package-99b0a55c.js","./trending-up-147c55bb.js"],import.meta.url)),Le=_.lazy(()=>w(()=>import("./OrdersManagementTab-74307886.js"),["./OrdersManagementTab-74307886.js","./index-3101bb07.js","./index-dc19931e.css","./badge-34bdff7c.js","./select-03f52418.js","./check-78166ef5.js","./useStoreDashboard-6cfa5bdd.js","./index-6c60542e.js","./triangle-alert-5ea4272b.js","./package-99b0a55c.js","./clock-0a32af33.js","./truck-a0071c63.js","./pencil-b145156d.js","./map-pin-4396fd6c.js"],import.meta.url)),Oe=_.lazy(()=>w(()=>import("./ProfileTab-fd4f3500.js"),["./ProfileTab-fd4f3500.js","./index-3101bb07.js","./index-dc19931e.css","./input-977568de.js","./label-6ced007b.js","./useStoreDashboard-6cfa5bdd.js"],import.meta.url)),ke=_.lazy(()=>w(()=>import("./AdminTab-1ef2bbd0.js"),["./AdminTab-1ef2bbd0.js","./index-3101bb07.js","./index-dc19931e.css","./user-plus-74362f50.js","./users-93d0d9a2.js"],import.meta.url)),Re=_.lazy(()=>w(()=>import("./FinancialsTab-e07ef4f8.js"),["./FinancialsTab-e07ef4f8.js","./index-3101bb07.js","./index-dc19931e.css","./useStoreDashboard-6cfa5bdd.js","./index-6c60542e.js","./triangle-alert-5ea4272b.js","./settings-96af137d.js","./trending-up-147c55bb.js","./credit-card-bcc8ac59.js","./circle-alert-58769497.js"],import.meta.url)),pa=({store:t})=>{const o=[{path:"",label:"Resumen",icon:ie,element:e.jsx(qe,{storeId:t.id})},{path:"caja",label:"Caja",icon:fe,element:e.jsx(le,{useStore:U,title:"Restaurante - Caja"})},{path:"pedidos",label:"Cocina y Pedidos",icon:oe,element:e.jsx(Le,{storeId:t.id})},{path:"menu",label:"Menú Digital",icon:be,element:e.jsx(ce,{})},{path:"mesas",label:"Mesas",icon:Ce,element:e.jsx(Se,{storeId:t.id})},{path:"mantenimiento",label:"Mantenimiento",icon:T,element:e.jsx(Te,{storeId:t.id})},{path:"importar",label:"Importar",icon:ye,element:e.jsx(se,{storeId:t.id})},{path:"finanzas",label:"Finanzas",icon:ve,element:e.jsx(Re,{storeId:t.id})},{path:"equipo",label:"Equipo",icon:_e,element:e.jsx(ke,{storeId:t.id})},{path:"configuracion",label:"Configuración",icon:Ne,element:e.jsx(Oe,{})}];return e.jsx(ne,{store:t,tabs:o})};export{pa as default};
