import{l as k,j as e,B as g,X as te,U as $,H as ae,g as re,D as H,v as I,z as U,E as F,F as ie,G as B,r as x,k as p,C as y,a as w,b as _,d as E,c as C,i as ne,f as G,T as A,t as j,I as ce,P as V,n as oe,x as le,e as de,J as me}from"./index-9083a265.js";import{H as xe}from"./Helmet-a3f46ffc.js";import{L as he}from"./log-out-f36dce14.js";import{M as W}from"./map-pin-9a40b828.js";import{C as X}from"./credit-card-e7927076.js";import{S as Z}from"./star-f6f9589a.js";import{B as ue}from"./badge-29da9c44.js";import{T as pe,a as fe,b as O,c as R}from"./tabs-e454222b.js";/* empty css                */import{c as ge,l as je,b as be,e as Ne,L,M as ve,T as ye,a as M,P as D}from"./TileLayer-971401f0.js";import{P as J}from"./package-0a61c0c1.js";import{T as q}from"./truck-cf1d9e76.js";import{C as we}from"./circle-x-716ef537.js";import{C as _e}from"./circle-check-big-df71119a.js";import{C as Ce}from"./clock-b1ebfb45.js";import{I as S}from"./input-f40b5322.js";import{S as ke}from"./shopping-cart-d265392e.js";import{C as Se}from"./check-86a4f1d1.js";import{T as Ee}from"./textarea-c7c4cb4e.js";/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pe=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]],K=k("bell",Pe);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Te=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],Me=k("copy",Te);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const De=[["path",{d:"M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5",key:"mvr1a0"}]],Q=k("heart",De);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ae=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],Le=k("info",Ae);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ze=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],$e=k("shield-check",ze);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oe=[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]],Re=k("tag",Oe);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qe=[["path",{d:"M2 9a3 3 0 0 1 0 6v2a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-2a3 3 0 0 1 0-6V7a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z",key:"qn84l0"}],["path",{d:"M13 5v2",key:"dyzc3o"}],["path",{d:"M13 17v2",key:"1ont0d"}],["path",{d:"M13 11v2",key:"1wjjxi"}]],Y=k("ticket",qe),He=ge(function({positions:a,...l},n){const d=new je.Polyline(a,l);return be(d,Ne(n,{overlayContainer:d}))},function(a,l,n){l.positions!==n.positions&&a.setLatLngs(l.positions)}),Ie=({profile:s,activeTab:a,onTabChange:l,onLogout:n,onHome:d,isOpen:u,onClose:m})=>{const r=[{id:"pedidos",label:"Mis Pedidos",icon:re},{id:"perfil",label:"Mi Perfil",icon:$},{id:"deseos",label:"Lista de Deseos",icon:Q},{id:"direcciones",label:"Mis Direcciones",icon:W},{id:"pagos",label:"Métodos de Pago",icon:X},{id:"notificaciones",label:"Notificaciones",icon:K},{id:"resenas",label:"Reseñas",icon:Z},{id:"cupones",label:"Cupones",icon:Y}];return e.jsxs(e.Fragment,{children:[u&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-40 md:hidden backdrop-blur-sm transition-opacity",onClick:m}),e.jsx("aside",{className:`
          fixed md:relative top-0 left-0 z-50 h-full w-64 bg-card text-card-foreground border-r border-border shrink-0
          transform transition-transform duration-300 ease-in-out md:transform-none shadow-lg md:shadow-none
          ${u?"translate-x-0":"-translate-x-full"}
        `,children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"p-6 border-b border-border relative",children:[e.jsx(g,{variant:"ghost",size:"icon",className:"absolute top-2 right-2 md:hidden",onClick:m,children:e.jsx(te,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex flex-col items-center text-center mt-2 md:mt-0",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-primary/10 flex items-center justify-center mb-4 text-primary",children:e.jsx($,{className:"h-10 w-10"})}),e.jsx("h2",{className:"text-lg font-bold truncate w-full px-2",children:(s==null?void 0:s.full_name)||"Usuario"}),e.jsx("p",{className:"text-xs text-muted-foreground truncate w-full px-2",children:s==null?void 0:s.email})]})]}),e.jsx("div",{className:"p-4 space-y-1 overflow-y-auto flex-1",children:r.map(t=>{const c=t.icon,i=a===t.id;return e.jsxs(g,{variant:i?"secondary":"ghost",className:`w-full justify-start ${i?"bg-primary/10 text-primary":""}`,onClick:()=>{l(t.id),m()},children:[e.jsx(c,{className:"mr-2 h-4 w-4 shrink-0"}),t.label]},t.id)})}),e.jsxs("div",{className:"p-4 border-t border-border space-y-2 bg-muted/20",children:[e.jsxs(g,{variant:"outline",className:"w-full justify-start",onClick:d,children:[e.jsx(ae,{className:"mr-2 h-4 w-4 shrink-0"})," Volver al inicio"]}),e.jsxs(g,{variant:"destructive",className:"w-full justify-start",onClick:n,children:[e.jsx(he,{className:"mr-2 h-4 w-4 shrink-0"})," Salir"]})]})]})})]})},Ue=({order:s,isOpen:a,onClose:l})=>{var n;return e.jsx(H,{open:a,onOpenChange:l,children:e.jsxs(I,{children:[e.jsxs(U,{children:[e.jsxs(F,{children:["Detalles del Pedido #",s==null?void 0:s.id.substring(0,8)]}),e.jsxs(ie,{children:["Realizado el ",new Date(s==null?void 0:s.created_at).toLocaleString()," en ",(n=s==null?void 0:s.stores)==null?void 0:n.name,"."]})]}),e.jsx("div",{className:"space-y-4 max-h-[60vh] overflow-y-auto pr-2",children:s==null?void 0:s.order_items.map(d=>{var u,m,r;return e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("img",{src:((u=d.products)==null?void 0:u.image_url)||"https://placehold.co/64",alt:(m=d.products)==null?void 0:m.name,className:"w-16 h-16 rounded-md object-cover"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:(r=d.products)==null?void 0:r.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Cantidad: ",d.quantity]})]})]}),e.jsxs("p",{className:"font-semibold",children:["$",(d.price*d.quantity).toLocaleString()]})]},d.id)})}),e.jsx(B,{className:"pt-4 border-t",children:e.jsxs("div",{className:"w-full flex justify-between font-bold text-lg",children:[e.jsx("span",{children:"Total del Pedido:"}),e.jsxs("span",{children:["$",Number(s==null?void 0:s.total).toLocaleString()]})]})})]})})};delete L.Icon.Default.prototype._getIconUrl;L.Icon.Default.mergeOptions({iconRetinaUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-2x.png",iconUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png"});const Fe=new L.Icon({iconUrl:"https://cdn-icons-png.flaticon.com/512/3448/3448620.png",iconSize:[35,35],iconAnchor:[17,35],popupAnchor:[0,-35]}),Be=({delivery:s})=>{const[a,l]=x.useState(null);if(x.useEffect(()=>{if(!s||!s.delivery_person_id)return;(async()=>{const{data:i,error:h}=await p.from("delivery_locations").select("*").eq("delivery_person_id",s.delivery_person_id).single();i&&l({lat:i.lat,lng:i.lng})})();const c=p.channel(`delivery-location-${s.delivery_person_id}`).on("postgres_changes",{event:"*",schema:"public",table:"delivery_locations",filter:`delivery_person_id=eq.${s.delivery_person_id}`},i=>{l({lat:i.new.lat,lng:i.new.lng})}).subscribe();return()=>{p.removeChannel(c)}},[s]),!(s!=null&&s.delivery_coords)||!(s!=null&&s.pickup_coords))return e.jsx("div",{className:"text-center text-sm text-gray-500",children:"No hay información de ubicación disponible para este pedido."});const n=[s.pickup_coords[0],s.pickup_coords[1]],d=[s.delivery_coords[0],s.delivery_coords[1]],u=a?[a.lat,a.lng]:null,m=u||d,r=u?[u,d]:[];return e.jsx("div",{className:"h-64 w-full rounded-lg overflow-hidden border",children:e.jsxs(ve,{center:m,zoom:14,scrollWheelZoom:!1,style:{height:"100%",width:"100%"},children:[e.jsx(ye,{attribution:'© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),e.jsx(M,{position:n,children:e.jsx(D,{children:"Punto de Recogida"})}),e.jsx(M,{position:d,children:e.jsx(D,{children:"Tu Ubicación"})}),u&&e.jsx(M,{position:u,icon:Fe,children:e.jsx(D,{children:"Domiciliario"})}),r.length>0&&e.jsx(He,{pathOptions:{color:"blue"},positions:r})]})})},Ge=({orders:s})=>{const[a,l]=x.useState(null),n=s.filter(t=>["Pendiente","Pendiente de pago en efectivo","En curso"].includes(t.status)),d=s.filter(t=>["Entregado","Cancelado"].includes(t.status)),u=t=>{switch(t){case"Pendiente":case"Pendiente de pago en efectivo":return{icon:e.jsx(Ce,{className:"h-4 w-4"}),color:"bg-yellow-100 text-yellow-800",text:"Preparando"};case"En curso":return{icon:e.jsx(q,{className:"h-4 w-4"}),color:"bg-blue-100 text-blue-800",text:"En Camino"};case"Entregado":return{icon:e.jsx(_e,{className:"h-4 w-4"}),color:"bg-green-100 text-green-800",text:"Entregado"};default:return{icon:e.jsx(we,{className:"h-4 w-4"}),color:"bg-red-100 text-red-800",text:t}}},m=t=>{const c=new Date(t);return new Date(c.getTime()+45*6e4).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})},r=({order:t,isActive:c})=>{var h,o;const i=u(t.status);return e.jsxs("div",{className:"border rounded-lg p-5 bg-card hover:bg-accent/5 transition-colors cursor-pointer",onClick:()=>l(t),children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-4",children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center shrink-0 ${i.color}`,children:i.icon}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"font-bold text-lg",children:(h=t.stores)==null?void 0:h.name}),e.jsx(ue,{variant:"outline",className:"text-xs",children:i.text})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Pedido #",t.id.substring(0,8)," • ",new Date(t.created_at).toLocaleDateString()]}),e.jsxs("p",{className:"font-medium mt-1 text-primary",children:[((o=t.order_items)==null?void 0:o.length)||0," productos • $",Number(t.total).toLocaleString()]})]})]}),c&&t.status==="En curso"&&e.jsxs("div",{className:"text-right flex flex-col justify-center",children:[e.jsx("span",{className:"text-xs text-muted-foreground uppercase tracking-wide",children:"Entrega Estimada"}),e.jsx("span",{className:"text-2xl font-bold text-blue-600",children:m(t.created_at)})]})]}),c&&t.status==="En curso"&&t.deliveries&&e.jsxs("div",{className:"mt-6 border-t pt-4",children:[e.jsxs("p",{className:"text-xs font-bold text-muted-foreground uppercase mb-3 flex items-center gap-2",children:[e.jsx(q,{className:"h-3 w-3"})," Rastreo en Tiempo Real"]}),e.jsx(Be,{delivery:t.deliveries})]})]})};return e.jsxs(y,{className:"border-none shadow-none",children:[e.jsxs(w,{className:"px-0 pt-0",children:[e.jsx(_,{className:"text-2xl",children:"Mis Pedidos"}),e.jsx(E,{children:"Rastrea tus envíos y revisa tu historial."})]}),e.jsx(C,{className:"px-0",children:e.jsxs(pe,{defaultValue:"activos",className:"w-full",children:[e.jsxs(fe,{className:"grid w-full grid-cols-2 mb-6",children:[e.jsxs(O,{value:"activos",children:["En Curso (",n.length,")"]}),e.jsxs(O,{value:"historial",children:["Historial (",d.length,")"]})]}),e.jsx(R,{value:"activos",className:"space-y-4",children:n.length===0?e.jsxs("div",{className:"text-center py-12 border-2 border-dashed rounded-xl",children:[e.jsx(J,{className:"h-12 w-12 mx-auto text-muted-foreground mb-3 opacity-20"}),e.jsx("p",{className:"text-muted-foreground",children:"No tienes pedidos activos en este momento."}),e.jsx(g,{variant:"link",className:"mt-2 text-primary",children:"Ir a comprar"})]}):n.map(t=>e.jsx(r,{order:t,isActive:!0},t.id))}),e.jsx(R,{value:"historial",className:"space-y-4",children:d.map(t=>e.jsx(r,{order:t,isActive:!1},t.id))})]})}),a&&e.jsx(Ue,{order:a,isOpen:!!a,onClose:()=>l(null)})]})},Ve=({profile:s,onInputChange:a,onProfileUpdate:l})=>e.jsxs(y,{children:[e.jsx(w,{children:e.jsx(_,{children:"Mi Perfil"})}),e.jsx(C,{children:e.jsxs("form",{onSubmit:l,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nombre"}),e.jsx(S,{name:"full_name",value:s.full_name,onChange:a})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),e.jsx(S,{name:"email",type:"email",value:s.email,onChange:a,readOnly:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Teléfono"}),e.jsx(S,{name:"phone",type:"tel",value:s.phone,onChange:a})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Dirección de Entrega"}),e.jsx(S,{name:"address",type:"text",value:s.address,onChange:a,placeholder:"Ej: Calle 123 #45-67, Apto 890"})]}),e.jsx(g,{type:"submit",children:"Guardar Cambios"})]})})]}),We=({userId:s})=>{const[a,l]=x.useState([]),[n,d]=x.useState(!0),{addToCart:u}=ne();x.useEffect(()=>{m()},[s]);const m=async()=>{try{const{data:c,error:i}=await p.from("wishlist").select(`
          id,
          products (
            id, name, price, image_url, description, stock, store_id, stores(name)
          )
        `).eq("user_id",s);if(i)throw i;l(c||[])}catch(c){console.error("Error fetching wishlist:",c)}finally{d(!1)}},r=async c=>{try{const{error:i}=await p.from("wishlist").delete().eq("id",c);if(i)throw i;l(a.filter(h=>h.id!==c)),j({title:"Eliminado",description:"Producto eliminado de la lista de deseos."})}catch{j({variant:"destructive",title:"Error",description:"No se pudo eliminar el producto."})}},t=c=>{u(c,1),j({title:"Agregado",description:"Producto agregado al carrito."})};return n?e.jsx("div",{className:"flex justify-center p-8",children:e.jsx(G,{className:"animate-spin"})}):e.jsxs(y,{children:[e.jsxs(w,{children:[e.jsx(_,{children:"Mi Lista de Deseos"}),e.jsx(E,{children:"Guarda tus productos favoritos para después."})]}),e.jsx(C,{children:a.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(Q,{className:"h-12 w-12 mx-auto mb-4 opacity-20"}),e.jsx("p",{children:"No tienes productos guardados aún."})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:a.map(c=>{var h;const i=c.products;return e.jsxs("div",{className:"border rounded-lg overflow-hidden flex flex-col",children:[e.jsx("div",{className:"h-40 overflow-hidden bg-gray-100",children:e.jsx("img",{src:i.image_url||"https://placehold.co/400x300",alt:i.name,className:"w-full h-full object-cover transition-transform hover:scale-105"})}),e.jsxs("div",{className:"p-4 flex flex-col flex-grow",children:[e.jsx("h3",{className:"font-semibold truncate",title:i.name,children:i.name}),e.jsx("p",{className:"text-xs text-muted-foreground mb-2",children:(h=i.stores)==null?void 0:h.name}),e.jsxs("p",{className:"font-bold text-lg mb-4",children:["$",Number(i.price).toLocaleString()]}),e.jsxs("div",{className:"mt-auto flex gap-2",children:[e.jsxs(g,{className:"flex-1",size:"sm",onClick:()=>t(i),disabled:i.stock<=0,children:[e.jsx(ke,{className:"h-4 w-4 mr-2"}),i.stock>0?"Agregar":"Agotado"]}),e.jsx(g,{variant:"outline",size:"icon",className:"text-destructive hover:text-destructive",onClick:()=>r(c.id),children:e.jsx(A,{className:"h-4 w-4"})})]})]})]},c.id)})})})]})},Xe=({userId:s})=>{const[a,l]=x.useState([]),[n,d]=x.useState(!0),[u,m]=x.useState(!1),[r,t]=x.useState({name:"",address_line:"",city:"Rionegro",is_default:!1});x.useEffect(()=>{c()},[s]);const c=async()=>{try{const{data:o,error:f}=await p.from("user_addresses").select("*").eq("user_id",s).order("is_default",{ascending:!1});if(f)throw f;l(o||[])}catch(o){console.error(o)}finally{d(!1)}},i=async()=>{if(!r.address_line||!r.name){j({variant:"destructive",title:"Error",description:"Completa los campos obligatorios."});return}try{r.is_default&&a.length>0&&await p.from("user_addresses").update({is_default:!1}).eq("user_id",s);const{data:o,error:f}=await p.from("user_addresses").insert([{...r,user_id:s}]).select();if(f)throw f;l([...r.is_default?[]:a,o[0],...r.is_default?a:[]]),m(!1),t({name:"",address_line:"",city:"Rionegro",is_default:!1}),j({title:"Dirección agregada",description:"Tu nueva dirección ha sido guardada."}),c()}catch(o){j({variant:"destructive",title:"Error",description:o.message})}},h=async o=>{try{const{error:f}=await p.from("user_addresses").delete().eq("id",o);if(f)throw f;l(a.filter(b=>b.id!==o)),j({title:"Eliminado",description:"Dirección eliminada correctamente."})}catch{j({variant:"destructive",title:"Error",description:"No se pudo eliminar."})}};return e.jsxs(y,{children:[e.jsxs(w,{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(_,{children:"Mis Direcciones"}),e.jsx(E,{children:"Gestiona tus lugares de entrega frecuentes."})]}),e.jsxs(H,{open:u,onOpenChange:m,children:[e.jsx(ce,{asChild:!0,children:e.jsxs(g,{size:"sm",children:[e.jsx(V,{className:"h-4 w-4 mr-2"})," Nueva Dirección"]})}),e.jsxs(I,{children:[e.jsx(U,{children:e.jsx(F,{children:"Agregar Nueva Dirección"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Nombre (ej. Casa, Trabajo)"}),e.jsx(S,{value:r.name,onChange:o=>t({...r,name:o.target.value}),placeholder:"Ej: Apartamento Centro"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Dirección Completa"}),e.jsx(S,{value:r.address_line,onChange:o=>t({...r,address_line:o.target.value}),placeholder:"Calle 123 # 45-67"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"default-addr",checked:r.is_default,onChange:o=>t({...r,is_default:o.target.checked}),className:"rounded border-gray-300"}),e.jsx("label",{htmlFor:"default-addr",className:"text-sm",children:"Establecer como predeterminada"})]})]}),e.jsx(B,{children:e.jsx(g,{onClick:i,children:"Guardar Dirección"})})]})]})]}),e.jsx(C,{children:e.jsxs("div",{className:"grid gap-4",children:[a.map(o=>e.jsxs("div",{className:"flex items-start justify-between p-4 border rounded-lg bg-card hover:bg-accent/5 transition-colors",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:`p-2 rounded-full ${o.is_default?"bg-primary/10 text-primary":"bg-secondary"}`,children:e.jsx(W,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"font-semibold",children:o.name}),o.is_default&&e.jsx("span",{className:"text-xs bg-primary/10 text-primary px-2 py-0.5 rounded-full font-medium",children:"Predeterminada"})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:o.address_line}),e.jsx("p",{className:"text-xs text-muted-foreground",children:o.city})]})]}),e.jsx(g,{variant:"ghost",size:"icon",className:"text-destructive hover:bg-destructive/10",onClick:()=>h(o.id),children:e.jsx(A,{className:"h-4 w-4"})})]},o.id)),!n&&a.length===0&&e.jsx("p",{className:"text-center text-muted-foreground py-8",children:"No tienes direcciones guardadas."})]})})]})},Ze=({userId:s})=>{const[a,l]=x.useState([]),[n,d]=x.useState(!0);x.useEffect(()=>{u()},[s]);const u=async()=>{try{const{data:t,error:c}=await p.from("user_payment_methods").select("*").eq("user_id",s).order("is_default",{ascending:!1});if(c)throw c;l(t||[])}catch(t){console.error(t)}finally{d(!1)}},m=async t=>{try{const{error:c}=await p.from("user_payment_methods").delete().eq("id",t);if(c)throw c;l(a.filter(i=>i.id!==t)),j({title:"Método eliminado",description:"La tarjeta ha sido removida."})}catch{j({variant:"destructive",title:"Error",description:"No se pudo eliminar."})}},r=async()=>{const t={user_id:s,last_four:Math.floor(1e3+Math.random()*9e3).toString(),brand:Math.random()>.5?"Visa":"Mastercard",exp_month:12,exp_year:2028,is_default:a.length===0},{data:c,error:i}=await p.from("user_payment_methods").insert([t]).select();!i&&c&&(l([...a,c[0]]),j({title:"Tarjeta Agregada",description:"Método de pago guardado exitosamente."}))};return e.jsxs(y,{children:[e.jsxs(w,{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(_,{children:"Métodos de Pago"}),e.jsx(E,{children:"Gestiona tus tarjetas para compras rápidas."})]}),e.jsxs(g,{size:"sm",onClick:r,children:[e.jsx(V,{className:"h-4 w-4 mr-2"})," Agregar Tarjeta"]})]}),e.jsx(C,{children:e.jsxs("div",{className:"grid gap-4",children:[a.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg bg-card",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"bg-slate-100 p-2 rounded",children:e.jsx(X,{className:"h-6 w-6 text-slate-700"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-semibold flex items-center gap-2",children:[t.brand," •••• ",t.last_four,t.is_default&&e.jsx("span",{className:"text-xs bg-green-100 text-green-700 px-2 rounded-full",children:"Principal"})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Expira: ",t.exp_month,"/",t.exp_year]})]})]}),e.jsx(g,{variant:"ghost",size:"icon",className:"text-destructive",onClick:()=>m(t.id),children:e.jsx(A,{className:"h-4 w-4"})})]},t.id)),a.length===0&&e.jsxs("div",{className:"text-center py-8 text-muted-foreground border-2 border-dashed rounded-lg",children:[e.jsx($e,{className:"h-10 w-10 mx-auto mb-2 opacity-20"}),e.jsx("p",{children:"No tienes métodos de pago guardados."}),e.jsx("p",{className:"text-xs mt-1",children:"Tus datos están protegidos con encriptación SSL."})]})]})})]})},Je=({userId:s})=>{const[a,l]=x.useState([]);x.useEffect(()=>{n();const r=p.channel(`notifications-${s}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"user_notifications",filter:`user_id=eq.${s}`},t=>{l(c=>[t.new,...c])}).subscribe();return()=>p.removeChannel(r)},[s]);const n=async()=>{const{data:r}=await p.from("user_notifications").select("*").eq("user_id",s).order("created_at",{ascending:!1}).limit(20);l(r||[])},d=async r=>{await p.from("user_notifications").update({read:!0}).eq("id",r),l(a.map(t=>t.id===r?{...t,read:!0}:t))},u=async()=>{await p.from("user_notifications").update({read:!0}).eq("user_id",s),l(a.map(r=>({...r,read:!0})))},m=r=>{switch(r){case"order":return e.jsx(J,{className:"h-5 w-5 text-blue-500"});case"promo":return e.jsx(Re,{className:"h-5 w-5 text-purple-500"});default:return e.jsx(Le,{className:"h-5 w-5 text-gray-500"})}};return e.jsxs(y,{children:[e.jsxs(w,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(_,{className:"text-xl",children:"Notificaciones"}),a.some(r=>!r.read)&&e.jsx(g,{variant:"ghost",size:"sm",onClick:u,children:"Marcar todo como leído"})]}),e.jsx(C,{children:e.jsx("div",{className:"space-y-2",children:a.length===0?e.jsxs("div",{className:"text-center py-10 text-muted-foreground",children:[e.jsx(K,{className:"h-10 w-10 mx-auto mb-2 opacity-20"}),e.jsx("p",{children:"No tienes notificaciones nuevas."})]}):a.map(r=>e.jsxs("div",{className:`flex items-start gap-4 p-4 rounded-lg border transition-colors ${r.read?"bg-background":"bg-blue-50/50 border-blue-100"}`,children:[e.jsx("div",{className:"mt-1",children:m(r.type)}),e.jsxs("div",{className:"flex-grow",children:[e.jsx("h4",{className:`text-sm ${r.read?"font-medium":"font-bold"}`,children:r.title}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:r.message}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:new Date(r.created_at).toLocaleString()})]}),!r.read&&e.jsx(g,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>d(r.id),children:e.jsx(Se,{className:"h-4 w-4"})})]},r.id))})})]})},Ke=({userId:s})=>{const[a,l]=x.useState([]),[n,d]=x.useState(5),[u,m]=x.useState(""),[r,t]=x.useState(null);x.useEffect(()=>{c()},[s]);const c=async()=>{const{data:h,error:o}=await p.from("orders").select("id, created_at, order_items(id, product_id, products!order_items_product_id_fkey(name, image_url))").eq("customer_id",s).eq("status","Entregado").order("created_at",{ascending:!1}).limit(5);if(o){console.error("Error fetching reviews:",o);return}if(h){const f=h.flatMap(b=>b.order_items.map(v=>({...v,order_date:b.created_at})));l(f)}},i=async h=>{t(h.id);try{const{error:o}=await p.from("reviews").insert([{user_id:s,rating:n,comment:u}]);if(o)throw o;j({title:"Reseña enviada",description:"¡Gracias por tu opinión!"}),l(f=>f.filter(b=>b.id!==h.id)),m(""),d(5)}catch(o){console.error(o),j({title:"Error",description:"Intenta nuevamente."})}finally{t(null)}};return e.jsxs(y,{children:[e.jsxs(w,{children:[e.jsx(_,{children:"Reseñas Pendientes"}),e.jsx(E,{children:"Califica los productos que has comprado recientemente."})]}),e.jsx(C,{children:e.jsx("div",{className:"space-y-6",children:a.length===0?e.jsx("p",{className:"text-center text-muted-foreground py-8",children:"No tienes productos pendientes por calificar."}):a.map(h=>{var o,f,b;return e.jsxs("div",{className:"flex gap-4 p-4 border rounded-lg bg-card",children:[e.jsx("img",{src:((o=h.products)==null?void 0:o.image_url)||"https://placehold.co/64",className:"w-20 h-20 object-cover rounded",alt:(f=h.products)==null?void 0:f.name}),e.jsxs("div",{className:"flex-grow",children:[e.jsx("h4",{className:"font-semibold",children:(b=h.products)==null?void 0:b.name}),e.jsxs("p",{className:"text-xs text-muted-foreground mb-3",children:["Comprado el ",new Date(h.order_date).toLocaleDateString()]}),e.jsx("div",{className:"flex items-center gap-1 mb-2",children:[1,2,3,4,5].map(v=>e.jsx("button",{onClick:()=>d(v),type:"button",children:e.jsx(Z,{className:`h-5 w-5 ${v<=n?"fill-yellow-400 text-yellow-400":"text-gray-300"}`})},v))}),e.jsx(Ee,{placeholder:"Escribe tu opinión...",value:u,onChange:v=>m(v.target.value),className:"mb-2 h-20"}),e.jsx(g,{size:"sm",onClick:()=>i(h),disabled:r===h.id,children:r===h.id?"Enviando...":"Enviar Calificación"})]})]},h.id)})})})]})},Qe=()=>{const[s,a]=x.useState([]);x.useEffect(()=>{(async()=>{const{data:d}=await p.from("discounts").select("*, stores(name, logo_url)").gt("expires_at",new Date().toISOString()).limit(10);a(d||[])})()},[]);const l=n=>{navigator.clipboard.writeText(n),j({title:"Código copiado",description:"Úsalo al finalizar tu compra."})};return e.jsxs(y,{children:[e.jsxs(w,{children:[e.jsx(_,{children:"Cupones y Promociones"}),e.jsx(E,{children:"Aprovecha estos descuentos exclusivos."})]}),e.jsx(C,{children:e.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:s.length===0?e.jsxs("div",{className:"col-span-full text-center py-12 text-muted-foreground border-2 border-dashed rounded-xl",children:[e.jsx(Y,{className:"h-12 w-12 mx-auto mb-3 opacity-20"}),e.jsx("p",{children:"No hay cupones disponibles en este momento."})]}):s.map(n=>{var d;return e.jsxs("div",{className:"relative overflow-hidden border rounded-xl bg-gradient-to-br from-primary/5 to-primary/10 p-5 flex flex-col justify-between",children:[e.jsx("div",{className:"absolute -right-4 -top-4 w-16 h-16 bg-primary/20 rounded-full blur-xl"}),e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg text-primary",children:n.code}),e.jsx("p",{className:"text-sm text-gray-600",children:(d=n.stores)==null?void 0:d.name})]}),e.jsxs("div",{className:"bg-white p-2 rounded-lg shadow-sm border",children:[e.jsx("span",{className:"font-bold text-xl text-primary",children:n.discount_type==="percentage"?`${n.value}%`:`$${n.value}`}),e.jsx("span",{className:"text-[10px] block text-center uppercase",children:"OFF"})]})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-primary/10 flex justify-between items-center",children:[e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Vence: ",new Date(n.expires_at).toLocaleDateString()]}),e.jsxs(g,{size:"sm",variant:"outline",className:"h-8",onClick:()=>l(n.code),children:[e.jsx(Me,{className:"h-3 w-3 mr-2"})," Copiar"]})]})]},n.id)})})})]})},js=()=>{const s=oe(),{user:a,signOut:l,loading:n}=le(),[d,u]=de(),[m,r]=x.useState("pedidos"),[t,c]=x.useState([]),[i,h]=x.useState(null),[o,f]=x.useState(!0),[b,v]=x.useState(!1);x.useEffect(()=>{const N=d.get("tab");N&&r(N)},[d]);const z=x.useCallback(async N=>{f(!0);try{const[P,T]=await Promise.all([p.from("orders").select(`
            *, 
            stores (name), 
            deliveries (*), 
            order_items (*, products!order_items_product_id_fkey(name, image_url))
          `).eq("customer_id",N).order("created_at",{ascending:!1}),p.from("profiles").select("*").eq("id",N).single()]);if(P.error)throw P.error;if(c(P.data||[]),T.error)throw T.error;h(T.data)}catch(P){console.error("Error fetching dashboard data:",P),j({title:"Error",description:"No se pudieron cargar tus datos.",variant:"destructive"})}finally{f(!1)}},[]);x.useEffect(()=>{var N;if(!n){if(!a){s("/cliente/login");return}if(((N=a.user_metadata)==null?void 0:N.role)!=="cliente"){s("/"),j({title:"Acceso no autorizado",description:"Esta sección es solo para clientes.",variant:"destructive"});return}z(a.id)}},[a,s,n,z]);const ee=async()=>{await l(),j({title:"Sesión cerrada",description:"Has cerrado sesión exitosamente."})},se=N=>{r(N),u({tab:N})};return n||o?e.jsxs("div",{className:"min-h-screen bg-background flex items-center justify-center",children:[e.jsx(G,{className:"h-8 w-8 animate-spin text-primary"}),e.jsx("p",{className:"ml-2 text-foreground",children:"Cargando tu panel..."})]}):e.jsxs("div",{className:"min-h-screen bg-background flex flex-col md:flex-row relative",children:[e.jsx(xe,{children:e.jsx("title",{children:"Mi Panel | Cliente"})}),e.jsxs(g,{variant:"outline",size:"icon",className:"fixed top-4 left-4 z-50 md:hidden shadow-md bg-background",onClick:()=>v(!0),children:[e.jsx(me,{className:"h-5 w-5"}),e.jsx("span",{className:"sr-only",children:"Menu"})]}),e.jsx(Ie,{profile:i,activeTab:m,onTabChange:se,onLogout:ee,onHome:()=>s("/"),isOpen:b,onClose:()=>v(!1)}),e.jsx("main",{className:"flex-1 p-4 md:p-8 overflow-y-auto max-h-screen mt-14 md:mt-0",children:e.jsxs("div",{className:"max-w-5xl mx-auto space-y-6",children:[m==="pedidos"&&e.jsx(Ge,{orders:t}),m==="perfil"&&i&&e.jsx(Ve,{profile:{...i,email:a.email}}),m==="deseos"&&e.jsx(We,{userId:a.id}),m==="direcciones"&&e.jsx(Xe,{userId:a.id}),m==="pagos"&&e.jsx(Ze,{userId:a.id}),m==="notificaciones"&&e.jsx(Je,{userId:a.id}),m==="resenas"&&e.jsx(Ke,{userId:a.id}),m==="cupones"&&e.jsx(Qe,{})]})})]})};export{js as default};
