import{S as J,u as X,w as R,T as Y,b as n,U as Q,V as Z,y as e,$ as F,a0 as z,a5 as W,l as O,Z as ee,t as re,Y as se,x as N,F as te,X as ae,q as oe,i as ie,H as ce,J as ne,_ as E}from"./index-2ce94096.js";import{R as de,_ as le}from"./BaseStoreDashboard-e6c3d8a1-4e64a417.js";import{s as A,u as me}from"./useStoreDashboard-6e1233c7-c0c33d1b.js";import ue from"./OverviewTab-4d90d2b2-2472bb25.js";import{l as _}from"./input-30c35c11-b44761b2.js";import{k as pe,O as he,V as xe,I as fe,M as je}from"./select-f8f9a097-f8aafdb0.js";import{u as q}from"./label-a4c1a31d-e949b025.js";import"./textarea-d838bc32-b9870e6c.js";import{h as ge,z as ye}from"./index-dcb504c2-12f47de7.js";import{t as be}from"./check-d1d3ff5a-31b10f76.js";import{d as ve}from"./badge-aa6603fa-a4f8275d.js";import{r as ke,d as Ne,c as D,f as C,m as we,i as P}from"./table-4cf982c6-df9350bf.js";import{r as K}from"./shopping-cart-539ff770-43b9593e.js";import{o as Ce}from"./search-34f7aa01-f8dfb85b.js";import{c as Pe}from"./pencil-fe5409bf-721c7957.js";import Se from"./OrdersTab-bbdc2219-8f06d749.js";import{B as _e}from"./BulkUploadTab-3e25ba5e-0feebfa1.js";import qe from"./FinancialsTab-aa1c096f-73719405.js";import $e from"./AdminTab-383d089a-5b305ef9.js";import Ee from"./ProfileTab-b476a6ea-f55c5293.js";import{c as Ie}from"./credit-card-a50d43c9-92f7ec06.js";import{t as Le}from"./upload-7019e91d-5c44e162.js";import{a as Me,n as Re}from"./settings-030bd9e5-67a41fef.js";import{r as ze}from"./users-1e3e6770-1b81f4c4.js";import"./Helmet-c26e192a-711588c7.js";import"./log-out-8e22b546-d2fb474d.js";import"./index-bd02b651-8cbaad37.js";import"./triangle-alert-0cea0848-982fead7.js";import"./package-8a53cd5c-b574c2fa.js";import"./trending-up-6d925098-59ad96bf.js";import"./clock-87f27ea4-2e4bce74.js";import"./truck-4de66a3b-1e0700fb.js";import"./map-pin-4c971ad0-cfbd587c.js";import"./circle-alert-9e1a28d8-b20db8b3.js";import"./user-plus-413d81fa-4edbf458.js";/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oe=[["path",{d:"M3 5v14",key:"1nt18q"}],["path",{d:"M8 5v14",key:"1ybrkv"}],["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"M17 5v14",key:"ycjyhj"}],["path",{d:"M21 5v14",key:"nzette"}]],Ae=J("barcode",Oe),De=X((s,d)=>({products:[],cart:[],isLoadingProducts:!1,isLoadingCheckout:!1,error:null,fetchProducts:async a=>{s({isLoadingProducts:!0});try{const i=await A.obtenerProductos(a);s({products:i||[]})}catch(i){s({error:i.message})}finally{s({isLoadingProducts:!1})}},addToCart:a=>{const i=d().cart,l=i.find(t=>t.id===a.id);return s(l?{cart:i.map(t=>t.id===a.id?{...t,qty:t.qty+1}:t)}:{cart:[...i,{...a,qty:1}]}),!0},removeFromCart:a=>s(i=>({cart:i.cart.filter(l=>l.id!==a)})),updateCartQty:(a,i)=>s(l=>({cart:l.cart.map(t=>t.id===a?{...t,qty:Math.max(1,t.qty+i)}:t)})),clearCart:()=>s({cart:[]}),processCheckout:async(a,i,l,t)=>{const m=d().cart;if(m.length===0)return;const p=typeof i=="object"?{...i,method:l,type:"POS"}:{name:i,method:l,type:"POS"};s({isLoadingCheckout:!0});try{const{data:f,error:h}=await R.from("orders").insert({store_id:a,customer_id:null,status:"Entregado",total:t,delivery_address:JSON.stringify({guest:p,items:m.map(o=>({id:o.id,name:o.name,qty:o.qty,price:o.price}))})}).select().single();if(h)throw h;const j=m.map(o=>({order_id:f.id,product_id:o.id,quantity:o.qty,price:o.price})),{error:g}=await R.from("order_items").insert(j);if(g)throw g;for(const o of m)o.stock!==void 0&&await A.actualizarProducto(o.id,{stock:Math.max(0,o.stock-o.qty)});return d().clearCart(),!0}catch(f){throw f}finally{s({isLoadingCheckout:!1})}}}));var L="Checkbox",[Fe,qr]=Y(L),[Ke,Ve]=Fe(L),V=n.forwardRef((s,d)=>{const{__scopeCheckbox:a,name:i,checked:l,defaultChecked:t,required:m,disabled:p,value:f="on",onCheckedChange:h,form:j,...g}=s,[o,w]=n.useState(null),c=Q(d,u=>w(u)),x=n.useRef(!1),$=o?j||!!o.closest("form"):!0,[y=!1,S]=Z({prop:l,defaultProp:t,onChange:h}),I=n.useRef(y);return n.useEffect(()=>{const u=o==null?void 0:o.form;if(u){const v=()=>S(I.current);return u.addEventListener("reset",v),()=>u.removeEventListener("reset",v)}},[o,S]),e.jsxs(Ke,{scope:a,state:y,disabled:p,children:[e.jsx(F.button,{type:"button",role:"checkbox","aria-checked":b(y)?"mixed":y,"aria-required":m,"data-state":G(y),"data-disabled":p?"":void 0,disabled:p,value:f,...g,ref:c,onKeyDown:z(s.onKeyDown,u=>{u.key==="Enter"&&u.preventDefault()}),onClick:z(s.onClick,u=>{S(v=>b(v)?!0:!v),$&&(x.current=u.isPropagationStopped(),x.current||u.stopPropagation())})}),$&&e.jsx(Ue,{control:o,bubbles:!x.current,name:i,value:f,checked:y,required:m,disabled:p,form:j,style:{transform:"translateX(-100%)"},defaultChecked:b(t)?!1:t})]})});V.displayName=L;var U="CheckboxIndicator",B=n.forwardRef((s,d)=>{const{__scopeCheckbox:a,forceMount:i,...l}=s,t=Ve(U,a);return e.jsx(W,{present:i||b(t.state)||t.state===!0,children:e.jsx(F.span,{"data-state":G(t.state),"data-disabled":t.disabled?"":void 0,...l,ref:d,style:{pointerEvents:"none",...s.style}})})});B.displayName=U;var Ue=s=>{const{control:d,checked:a,bubbles:i=!0,defaultChecked:l,...t}=s,m=n.useRef(null),p=ge(a),f=ye(d);n.useEffect(()=>{const j=m.current,g=window.HTMLInputElement.prototype,o=Object.getOwnPropertyDescriptor(g,"checked").set;if(p!==a&&o){const w=new Event("click",{bubbles:i});j.indeterminate=b(a),o.call(j,b(a)?!1:a),j.dispatchEvent(w)}},[p,a,i]);const h=n.useRef(b(a)?!1:a);return e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:l??h.current,...t,tabIndex:-1,ref:m,style:{...s.style,...f,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function b(s){return s==="indeterminate"}function G(s){return b(s)?"indeterminate":s?"checked":"unchecked"}var H=V,Be=B;const Ge=n.forwardRef(({className:s,...d},a)=>e.jsx(H,{ref:a,className:O("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",s),...d,children:e.jsx(Be,{className:O("flex items-center justify-center text-current"),children:e.jsx(be,{className:"h-4 w-4"})})}));Ge.displayName=H.displayName;const He=()=>{const{products:s,fetchProducts:d,addProduct:a,updateProduct:i,deleteProduct:l,store:t}=me(),[m,p]=n.useState(""),[f,h]=n.useState(!1),[j,g]=n.useState(!1),[o,w]=n.useState(null),[c,x]=n.useState({name:"",price:"",stock:"",description:"",category:"Abarrotes",sku:"",image_url:""});n.useEffect(()=>{t!=null&&t.id&&d(t.id)},[t==null?void 0:t.id,d]);const $=s.filter(r=>r.name.toLowerCase().includes(m.toLowerCase())||r.sku&&r.sku.includes(m)),y=["Abarrotes","Lácteos","Carnes","Frutas/Verduras","Limpieza","Bebidas","Cuidado Personal"],S=()=>{w(null),x({name:"",price:"",stock:"50",description:"",category:"Abarrotes",sku:"",image_url:""}),h(!0)},I=r=>{w(r),x({name:r.name,price:r.price,stock:r.stock,description:r.description||"",category:r.category||"Abarrotes",sku:r.sku||"",image_url:r.image_url||""}),h(!0)},u=async(r,k)=>{try{await i(r.id,{stock:parseInt(k)}),E({title:"Stock actualizado"})}catch{}},v=async r=>{r.preventDefault(),g(!0);try{const k={name:c.name,price:parseFloat(c.price),stock:parseInt(c.stock),sku:c.sku,description:c.sku?`${c.description}

SKU:${c.sku}`:c.description,category:c.category,store_id:t==null?void 0:t.id,product_type:"physical",requires_shipping:!0};o?(await i(o.id,k),E({title:"Producto actualizado"})):(await a(k),E({title:"Producto registrado"})),h(!1)}catch{E({title:"Error",variant:"destructive"})}finally{g(!1)}},T=async r=>{confirm("¿Eliminar producto?")&&await l(r)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-emerald-50 border border-emerald-100 p-6 rounded-t-xl flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-emerald-900 flex items-center gap-2",children:[e.jsx(K,{className:"h-8 w-8 text-emerald-600"}),"Inventario Máster"]}),e.jsx("p",{className:"text-emerald-700",children:"Gestión masiva de referencias, precios y existencias."})]}),e.jsxs(N,{className:"bg-emerald-700 hover:bg-emerald-800",onClick:S,children:[e.jsx(te,{className:"h-4 w-4 mr-2"})," Nuevo Producto"]})]}),e.jsxs("div",{className:"flex gap-4 items-center bg-white p-2 border-b",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Ce,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(_,{placeholder:"Buscar por nombre, código de barras...",className:"pl-10",value:m,onChange:r=>p(r.target.value)})]}),e.jsxs(N,{variant:"outline",children:[e.jsx(Ae,{className:"h-4 w-4 mr-2"})," Escanear"]})]}),e.jsx("div",{className:"bg-white border rounded-lg overflow-hidden shadow-sm",children:e.jsxs(ke,{children:[e.jsx(Ne,{children:e.jsxs(D,{className:"bg-gray-50",children:[e.jsx(C,{className:"w-[100px]",children:"Código/SKU"}),e.jsx(C,{children:"Producto"}),e.jsx(C,{children:"Categoría"}),e.jsx(C,{className:"text-right",children:"Precio"}),e.jsx(C,{className:"text-center w-[150px]",children:"Stock"}),e.jsx(C,{className:"text-right",children:"Acciones"})]})}),e.jsx(we,{children:$.map(r=>{var k,M;return e.jsxs(D,{children:[e.jsx(P,{className:"font-mono text-xs text-gray-500",children:r.sku||((M=(k=r.description)==null?void 0:k.match(/SKU:(\w+)/))==null?void 0:M[1])||"---"}),e.jsx(P,{className:"font-medium text-slate-800",children:r.name}),e.jsx(P,{children:e.jsx(ve,{variant:"outline",className:"font-normal",children:r.category})}),e.jsxs(P,{className:"text-right font-bold text-emerald-700",children:["$",Number(r.price).toLocaleString()]}),e.jsx(P,{className:"text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(N,{variant:"ghost",className:"h-6 w-6 rounded-full p-0",onClick:()=>u(r,Math.max(0,r.stock-1)),children:"-"}),e.jsx("span",{className:"w-8 text-center",children:r.stock}),e.jsx(N,{variant:"ghost",className:"h-6 w-6 rounded-full p-0",onClick:()=>u(r,r.stock+1),children:"+"})]})}),e.jsxs(P,{className:"text-right",children:[e.jsx(N,{variant:"ghost",size:"sm",onClick:()=>I(r),children:e.jsx(Pe,{className:"h-4 w-4 text-blue-500"})}),e.jsx(N,{variant:"ghost",size:"sm",onClick:()=>T(r.id),children:e.jsx(ae,{className:"h-4 w-4 text-red-500"})})]})]},r.id)})})]})}),e.jsx(oe,{open:f,onOpenChange:h,children:e.jsxs(ie,{children:[e.jsx(ce,{children:e.jsx(ne,{children:"Producto de Supermercado"})}),e.jsxs("form",{onSubmit:v,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2 col-span-2",children:[e.jsx(q,{children:"Nombre Producto"}),e.jsx(_,{value:c.name,onChange:r=>x({...c,name:r.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{children:"Código Barras / SKU"}),e.jsx(_,{value:c.sku,onChange:r=>x({...c,sku:r.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{children:"Categoría"}),e.jsxs(pe,{value:c.category,onValueChange:r=>x({...c,category:r}),children:[e.jsx(he,{children:e.jsx(xe,{})}),e.jsx(fe,{children:y.map(r=>e.jsx(je,{value:r,children:r},r))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{children:"Precio"}),e.jsx(_,{type:"number",value:c.price,onChange:r=>x({...c,price:r.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{children:"Stock Inicial"}),e.jsx(_,{type:"number",value:c.stock,onChange:r=>x({...c,stock:r.target.value}),required:!0})]})]}),e.jsx(N,{type:"submit",className:"w-full bg-emerald-600 hover:bg-emerald-700",disabled:j,children:"Guardar"})]})]})})]})},Te=n.lazy(()=>ee(()=>re(()=>import("./GenericPOSView-837e2cc5-c84fd532.js"),["./GenericPOSView-837e2cc5-c84fd532.js","./index-2ce94096.js","./index-9e34f4e4.css","./input-30c35c11-b44761b2.js","./badge-aa6603fa-a4f8275d.js","./scroll-area-305a242e-4c6bab7e.js","./label-a4c1a31d-e949b025.js","./useStoreDashboard-6e1233c7-c0c33d1b.js","./shopping-cart-539ff770-43b9593e.js","./search-34f7aa01-f8dfb85b.js","./circle-check-big-e18572b1-a21d79ae.js"],import.meta.url),["./GenericPOSView-837e2cc5.js","./index-7593522e.js","./index-9e34f4e4.css","./input-30c35c11.js","./badge-aa6603fa.js","./scroll-area-305a242e.js","./label-a4c1a31d.js","./useStoreDashboard-6e1233c7.js","./shopping-cart-539ff770.js","./search-34f7aa01.js","./circle-check-big-e18572b1.js"],import.meta.url)),$r=n.memo(({store:s})=>{const d=[{path:"",label:"Resumen",icon:de,element:e.jsx(ue,{storeId:s.id})},{path:"caja",label:"Caja (POS)",icon:Ie,element:e.jsx(Te,{useStore:De,title:"Caja Registradora"})},{path:"inventario",label:"Inventario",icon:K,element:e.jsx(He,{})},{path:"pedidos",label:"Pedidos",icon:se,element:e.jsx(Se,{storeId:s.id})},{path:"importar",label:"Carga Masiva",icon:Le,element:e.jsx(_e,{storeId:s.id,onProductsUploaded:()=>{}})},{path:"finanzas",label:"Finanzas",icon:Me,element:e.jsx(qe,{storeId:s.id})},{path:"equipo",label:"Cajeros",icon:ze,element:e.jsx($e,{storeId:s.id})},{path:"configuracion",label:"Ajustes",icon:Re,element:e.jsx(Ee,{})}];return e.jsx(le,{store:s,tabs:d})});export{$r as default};
