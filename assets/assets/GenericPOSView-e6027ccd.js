import{r as t,j as e,M as ae,P as R,T as I,B as o,D as $,v as A,z as M,E as V,F as B,G as q,f as le,C as te,c as re,t as h}from"./index-1fdf2a9f.js";import{I as d}from"./input-6f32d436.js";import{B as ce}from"./badge-2a6a9d48.js";import{S as z}from"./scroll-area-700d22f5.js";import{L as i}from"./label-dba26b4b.js";import{u as ne}from"./useStoreDashboard-2973ddec.js";import{S as v}from"./shopping-cart-1d516b7d.js";import{S as _}from"./search-a003f046.js";import{C as G}from"./circle-check-big-1affdfe6.js";const ie=({product:l,onAddToCart:j})=>{const a=l.stock<=0;return e.jsxs(te,{className:`overflow-hidden h-full flex flex-col group ${a?"opacity-60":""}`,children:[e.jsxs("div",{className:"relative h-32 overflow-hidden bg-slate-100",children:[l.image_url?e.jsx("img",{src:l.image_url,alt:l.name,className:"w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-slate-400",children:e.jsx(v,{className:"h-8 w-8"})}),a&&e.jsx("div",{className:"absolute inset-0 bg-black/10 flex items-center justify-center",children:e.jsx(ce,{variant:"destructive",children:"Agotado"})})]}),e.jsxs(re,{className:"p-3 flex-1 flex flex-col",children:[e.jsx("h3",{className:"font-semibold text-sm leading-tight mb-1 line-clamp-2",children:l.name}),e.jsx("p",{className:"text-xs text-slate-500 mb-2",children:l.category||"General"}),e.jsxs("div",{className:"mt-auto flex items-center justify-between",children:[e.jsxs("span",{className:"font-bold text-blue-900",children:["$",parseFloat(l.price).toLocaleString()]}),e.jsx(o,{size:"sm",className:"h-7 w-7 rounded-full p-0",onClick:()=>j(l),disabled:a,children:e.jsx(R,{className:"h-4 w-4"})})]})]})]})},fe=({useStore:l,title:j="Punto de Venta"})=>{const{store:a}=ne(),{products:H,fetchProducts:b,cart:r,addToCart:Q,removeFromCart:J,updateCartQty:C,clearCart:K,processCheckout:U,isLoadingCheckout:w}=l(),[u,W]=t.useState(""),[X,m]=t.useState(!1),[p,y]=t.useState(""),[g,S]=t.useState(""),[k,D]=t.useState(""),[L,T]=t.useState(""),[x,E]=t.useState("Efectivo"),[Y,f]=t.useState(!1),[c,Z]=t.useState(null);t.useEffect(()=>{a!=null&&a.id&&b(a.id)},[a==null?void 0:a.id,b]);const O=H.filter(s=>s.name.toLowerCase().includes(u.toLowerCase())||s.code&&s.code.toLowerCase().includes(u.toLowerCase())),P=r.reduce((s,n)=>s+n.price*n.qty,0),N=P,ee=s=>{Q(s)||h({title:"Stock insuficiente",variant:"destructive"})},se=async()=>{if(!p||!g){h({title:"Datos incompletos",description:"Nombre y Documento son obligatorios",variant:"destructive"});return}const s={name:p,docId:g,phone:k,email:L},n={customer:s,items:[...r],total:N,date:new Date().toLocaleString(),id:`POS-${Date.now().toString().slice(-6)}`,paymentMethod:x};try{await U(a.id,s,x,N),m(!1),Z(n),f(!0),y(""),S(""),D(""),T(""),h({title:"Venta realizada con éxito"})}catch(F){console.error(F),h({title:"Error al procesar venta",description:F.message,variant:"destructive"})}};return e.jsxs("div",{className:"flex h-[calc(100vh-100px)] gap-4 font-sans",children:[e.jsxs("div",{className:"flex-1 flex flex-col gap-4",children:[e.jsxs("div",{className:"bg-white p-4 rounded-xl border border-slate-200 shadow-sm flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-slate-800 flex items-center gap-2",children:[e.jsx(v,{className:"h-6 w-6 text-blue-600"}),j]}),e.jsx("p",{className:"text-slate-500 text-sm",children:"Selecciona productos para agregar a la orden"})]}),e.jsxs("div",{className:"relative w-72",children:[e.jsx(_,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(d,{placeholder:"Buscar producto...",className:"pl-9 bg-slate-50",value:u,onChange:s=>W(s.target.value)})]})]}),e.jsxs(z,{className:"flex-1 bg-slate-50/50 rounded-xl border border-slate-200 p-4",children:[e.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:O.map(s=>e.jsx(ie,{product:s,onAddToCart:ee},s.id))}),O.length===0&&e.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-slate-400",children:[e.jsx(_,{className:"h-12 w-12 mb-2 opacity-20"}),e.jsx("p",{children:"No se encontraron productos"})]})]})]}),e.jsxs("div",{className:"w-96 bg-white border-l border-slate-200 flex flex-col shadow-xl",children:[e.jsxs("div",{className:"p-4 border-b border-slate-100 bg-slate-50",children:[e.jsxs("h2",{className:"font-bold text-lg flex items-center gap-2",children:[e.jsx(v,{className:"h-5 w-5"}),"Orden Actual"]}),e.jsxs("p",{className:"text-xs text-slate-400",children:[r.length," ítems"]})]}),e.jsx(z,{className:"flex-1 p-4",children:e.jsxs("div",{className:"space-y-3",children:[r.map(s=>e.jsxs("div",{className:"flex gap-3 bg-white border border-slate-100 p-2 rounded-lg shadow-sm",children:[e.jsx("div",{className:"h-12 w-12 bg-slate-100 rounded-md overflow-hidden flex-shrink-0",children:s.image_url&&e.jsx("img",{src:s.image_url,alt:"",className:"h-full w-full object-cover"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"text-sm font-medium truncate",children:s.name}),e.jsxs("div",{className:"flex items-center justify-between mt-1",children:[e.jsxs("div",{className:"flex items-center gap-2 bg-slate-50 rounded-md p-0.5",children:[e.jsx("button",{className:"h-6 w-6 flex items-center justify-center hover:bg-slate-200 rounded",onClick:()=>C(s.id,-1),children:e.jsx(ae,{className:"h-3 w-3"})}),e.jsx("span",{className:"text-xs w-4 text-center font-medium",children:s.qty}),e.jsx("button",{className:"h-6 w-6 flex items-center justify-center hover:bg-slate-200 rounded",onClick:()=>C(s.id,1),children:e.jsx(R,{className:"h-3 w-3"})})]}),e.jsxs("span",{className:"text-sm font-bold",children:["$",(s.price*s.qty).toLocaleString()]})]})]}),e.jsx("button",{className:"text-slate-300 hover:text-red-500 self-center",onClick:()=>J(s.id),children:e.jsx(I,{className:"h-4 w-4"})})]},s.id)),r.length===0&&e.jsx("div",{className:"text-center py-10 text-slate-400 text-sm",children:"El carrito está vacío"})]})}),e.jsxs("div",{className:"p-4 bg-slate-50 border-t border-slate-200",children:[e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-slate-500",children:"Subtotal"}),e.jsxs("span",{children:["$",P.toLocaleString()]})]}),e.jsx("div",{className:"border-b border-gray-200"}),e.jsxs("div",{className:"flex justify-between font-bold text-lg",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{className:"text-blue-600",children:["$",N.toLocaleString()]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs(o,{variant:"outline",onClick:K,disabled:r.length===0,children:[e.jsx(I,{className:"h-4 w-4 mr-2"}),"Limpiar"]}),e.jsxs(o,{className:"bg-blue-600 hover:bg-blue-700",disabled:r.length===0,onClick:()=>m(!0),children:["Pagar ",e.jsx(G,{className:"h-4 w-4 ml-2"})]})]})]})]}),e.jsx($,{open:X,onOpenChange:m,children:e.jsxs(A,{className:"sm:max-w-[425px]",children:[e.jsxs(M,{children:[e.jsx(V,{children:"Finalizar Venta"}),e.jsx(B,{children:"Ingrese los datos del cliente para la factura."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(i,{htmlFor:"docId",className:"text-right",children:"Documento"}),e.jsx(d,{id:"docId",value:g,onChange:s=>S(s.target.value),className:"col-span-3",placeholder:"CC / NIT"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(i,{htmlFor:"name",className:"text-right",children:"Nombre"}),e.jsx(d,{id:"name",value:p,onChange:s=>y(s.target.value),className:"col-span-3",placeholder:"Nombre completo"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(i,{htmlFor:"phone",className:"text-right",children:"Celular"}),e.jsx(d,{id:"phone",value:k,onChange:s=>D(s.target.value),className:"col-span-3",placeholder:"300..."})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(i,{htmlFor:"email",className:"text-right",children:"Email"}),e.jsx(d,{id:"email",value:L,onChange:s=>T(s.target.value),className:"col-span-3",placeholder:"cliente@email.com"})]}),e.jsx("div",{className:"border-b border-gray-200 my-2"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Método de Pago"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",id:"r1",value:"Efectivo",checked:x==="Efectivo",onChange:s=>E(s.target.value),className:"h-4 w-4"}),e.jsx(i,{htmlFor:"r1",children:"Efectivo"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",id:"r2",value:"Tarjeta",checked:x==="Tarjeta",onChange:s=>E(s.target.value),className:"h-4 w-4"}),e.jsx(i,{htmlFor:"r2",children:"Tarjeta"})]})]})]})]}),e.jsxs(q,{children:[e.jsx(o,{variant:"outline",onClick:()=>m(!1),children:"Cancelar"}),e.jsxs(o,{onClick:se,disabled:w,children:[w?e.jsx(le,{className:"animate-spin mr-2"}):null,"Confirmar Venta"]})]})]})}),e.jsx($,{open:Y,onOpenChange:f,children:e.jsxs(A,{className:"sm:max-w-[400px]",children:[e.jsxs(M,{children:[e.jsxs(V,{className:"flex items-center gap-2 text-green-600",children:[e.jsx(G,{className:"h-6 w-6"}),"Venta Exitosa"]}),e.jsx(B,{children:"Resumen de la factura generada."})]}),c&&e.jsxs("div",{className:"bg-slate-50 p-4 rounded-lg text-sm space-y-3 font-mono border",children:[e.jsxs("div",{className:"flex justify-between border-b pb-2",children:[e.jsx("span",{children:"Factura #"}),e.jsx("span",{className:"font-bold",children:c.id})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{children:[e.jsx("span",{className:"text-slate-500",children:"Cliente:"})," ",c.customer.name]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-slate-500",children:"Doc:"})," ",c.customer.docId]})]}),e.jsx("div",{className:"border-t border-b py-2 space-y-1",children:c.items.map((s,n)=>e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{children:[s.qty,"x ",s.name]}),e.jsxs("span",{children:["$",(s.price*s.qty).toLocaleString()]})]},n))}),e.jsxs("div",{className:"flex justify-between text-lg font-bold pt-1",children:[e.jsx("span",{children:"TOTAL"}),e.jsxs("span",{children:["$",c.total.toLocaleString()]})]}),e.jsxs("p",{className:"text-center text-xs text-slate-400 pt-2",children:["Comprobante enviado a ",c.customer.email||"N/A"]})]}),e.jsx(q,{children:e.jsx(o,{className:"w-full",onClick:()=>f(!1),children:"Cerrar y Nueva Venta"})})]})})]})};export{fe as default};
