import{u as ee,y as e,Y as se,w as v,b as x,x as N,F as R,q as ae,i as re,H as te,J as ie,X as B,A as le,d as ne,p as ce,_ as k}from"./index-2ce94096.js";import{R as oe,_ as de}from"./BaseStoreDashboard-e6c3d8a1-4e64a417.js";import me from"./OverviewTab-4d90d2b2-2472bb25.js";import{l as w}from"./input-30c35c11-b44761b2.js";import{k as $,O as A,V as L,I as D,M as g}from"./select-f8f9a097-f8aafdb0.js";import{u as p}from"./label-a4c1a31d-e949b025.js";import{t as xe}from"./textarea-d838bc32-b9870e6c.js";import{d as pe}from"./badge-aa6603fa-a4f8275d.js";import{u as he}from"./useStoreDashboard-6e1233c7-c0c33d1b.js";import{o as ue}from"./search-34f7aa01-f8dfb85b.js";import{c as T}from"./shirt-7d77b204-10da42e2.js";import{c as ge}from"./pencil-fe5409bf-721c7957.js";import je from"./OrdersTab-bbdc2219-8f06d749.js";import fe from"./FinancialsTab-aa1c096f-73719405.js";import{U as ve,k as Ne}from"./StoreCustomersTab-a98fd0a4-2cfcce8b.js";import{r as ye}from"./users-1e3e6770-1b81f4c4.js";import{a as be,n as we}from"./settings-030bd9e5-67a41fef.js";import"./Helmet-c26e192a-711588c7.js";import"./log-out-8e22b546-d2fb474d.js";import"./index-bd02b651-8cbaad37.js";import"./triangle-alert-0cea0848-982fead7.js";import"./package-8a53cd5c-b574c2fa.js";import"./trending-up-6d925098-59ad96bf.js";import"./check-d1d3ff5a-31b10f76.js";import"./clock-87f27ea4-2e4bce74.js";import"./truck-4de66a3b-1e0700fb.js";import"./map-pin-4c971ad0-cfbd587c.js";import"./credit-card-a50d43c9-92f7ec06.js";import"./circle-alert-9e1a28d8-b20db8b3.js";const G={_parseVariants(a){var l;if(!a)return a;let n=[];const t=(l=a.description)==null?void 0:l.match(/VARIANTS_JSON:\s*(\[.*\])/s);let c=a.description||"";if(t)try{n=JSON.parse(t[1]),c=a.description.replace(/\n\nVARIANTS_JSON:\s*\[.*\]/s,"")}catch(r){console.error("Error parsing variants",r)}return{...a,variants:n,description:c,full_description:a.description}},async getClothingProducts(a){const{data:l,error:n}=await v.from("products").select("*").eq("store_id",a).order("created_at",{ascending:!1});if(n)throw n;return l.map(this._parseVariants)},async saveClothingProduct(a){const{variants:l,description:n,...t}=a;let c=n||"";if(l&&l.length>0){const d=JSON.stringify(l);c=`${n||""}

VARIANTS_JSON: ${d}`}let r=t.stock;l&&l.length>0&&(r=l.reduce((d,m)=>d+(Number(m.qty)||0),0));const u={...t,description:c,stock:r,product_type:"physical",requires_shipping:!0};if(u.id){const{data:d,error:m}=await v.from("products").update(u).eq("id",u.id).select().single();if(m)throw m;return this._parseVariants(d)}else{const{data:d,error:m}=await v.from("products").insert(u).select().single();if(m)throw m;return this._parseVariants(d)}},async deleteClothingProduct(a){const{error:l}=await v.from("products").delete().eq("id",a);if(l)throw l}},Ce=ee((a,l)=>({products:[],isLoading:!1,error:null,fetchProducts:async n=>{a({isLoading:!0,error:null});try{const t=await G.getClothingProducts(n);a({products:t})}catch(t){a({error:t.message})}finally{a({isLoading:!1})}},saveProduct:async n=>{try{const t=await G.saveClothingProduct(n);return a(c=>c.products.find(r=>r.id===t.id)?{products:c.products.map(r=>r.id===t.id?t:r)}:{products:[t,...c.products]}),t}catch(t){throw t}},deleteProduct:async n=>{try{await G.deleteClothingProduct(n),a(t=>({products:t.products.filter(c=>c.id!==n)}))}catch(t){throw t}}})),Se=({product:a,onEdit:l,onDelete:n})=>{const t=a.variants||[],c=[...new Set(t.map(r=>r.size))].sort();return e.jsxs(ne,{className:"rounded-none overflow-hidden border-0 shadow-sm hover:shadow-xl transition-all group bg-white h-full flex flex-col",children:[e.jsxs("div",{className:"relative aspect-[3/4] bg-gray-100 overflow-hidden",children:[a.image_url?e.jsx("img",{src:a.image_url,alt:a.name,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-gray-300",children:[e.jsx(T,{className:"h-16 w-16 mb-2"}),e.jsx("span",{className:"text-xs",children:"Sin imagen"})]}),e.jsx("div",{className:"absolute top-2 left-2 flex flex-col gap-1",children:a.discount>0&&e.jsxs(pe,{className:"bg-red-500 hover:bg-red-600 text-white border-0 text-xs",children:["-",a.discount,"% OFF"]})}),e.jsxs("div",{className:"absolute bottom-4 right-4 flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity translate-y-2 group-hover:translate-y-0 duration-300",children:[e.jsx(N,{variant:"secondary",size:"icon",className:"h-9 w-9 rounded-full shadow-lg bg-white hover:bg-gray-50 text-black",onClick:r=>{r.stopPropagation(),l(a)},children:e.jsx(ge,{className:"h-4 w-4"})}),e.jsx(N,{variant:"destructive",size:"icon",className:"h-9 w-9 rounded-full shadow-lg",onClick:r=>{r.stopPropagation(),n(a.id)},children:e.jsx(B,{className:"h-4 w-4"})})]})]}),e.jsxs(ce,{className:"p-4 flex-1 flex flex-col",children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-widest mb-1",children:a.category||"Colección General"}),e.jsx("h3",{className:"font-serif text-lg text-slate-900 leading-tight mb-2 truncate",children:a.name}),e.jsx("div",{className:"flex flex-wrap gap-1 mb-3 min-h-[1.5rem]",children:c.length>0?c.map(r=>e.jsx("span",{className:"text-[10px] border border-gray-200 px-1.5 py-0.5 rounded text-gray-600",children:r},r)):e.jsx("span",{className:"text-[10px] text-gray-400 italic",children:"Talla única"})}),e.jsxs("div",{className:"mt-auto flex justify-between items-end border-t pt-3",children:[e.jsx("div",{className:"flex flex-col",children:e.jsxs("span",{className:"text-sm font-medium text-slate-900",children:["$",Number(a.price).toLocaleString()]})}),e.jsxs("span",{className:"text-xs text-gray-400",children:["Total: ",a.stock," un."]})]})]})]})},_e=["XS","S","M","L","XL","XXL","Única"],Pe=[{name:"Negro",hex:"#000000"},{name:"Blanco",hex:"#FFFFFF"},{name:"Rojo",hex:"#EF4444"},{name:"Azul",hex:"#3B82F6"},{name:"Verde",hex:"#22C55E"},{name:"Amarillo",hex:"#EAB308"},{name:"Rosa",hex:"#EC4899"},{name:"Gris",hex:"#6B7280"},{name:"Beige",hex:"#F5F5DC"}],ke=()=>{const{products:a,fetchProducts:l,saveProduct:n,deleteProduct:t,isLoading:c}=Ce(),{store:r}=he(),[u,d]=x.useState(""),[m,C]=x.useState(!1),[I,O]=x.useState(!1),[S,F]=x.useState(null),[j,_]=x.useState([]),[y,P]=x.useState({size:"M",color:"Negro",qty:1}),[o,b]=x.useState({name:"",price:"",description:"",category:"General",image_url:""}),[q,z]=x.useState(null);x.useEffect(()=>{r!=null&&r.id&&l(r.id)},[r==null?void 0:r.id,l]);const J=a.filter(s=>s.name.toLowerCase().includes(u.toLowerCase())),M=()=>{_([...j,{...y,id:Date.now()}]),P({...y,qty:1})},X=s=>{_(j.filter(i=>i.id!==s))},H=()=>{F(null),b({name:"",price:"",description:"",category:"General",image_url:""}),_([]),z(null),C(!0)},U=s=>{F(s);let i=s.variants||[];i=i.map(h=>({...h,id:h.id||Math.random()})),b({name:s.name,price:s.price,description:s.description||"",category:s.category||"General",image_url:s.image_url||""}),_(i),z(null),C(!0)},E=s=>{const{name:i,value:h}=s.target;b(f=>({...f,[i]:h}))},Y=s=>{s.target.files&&s.target.files[0]&&z(s.target.files[0])},Z=async(s,i,h)=>{const{error:f,data:V}=await v.storage.from(i).upload(h,s);if(f)throw new Error(`Error upload: ${f.message}`);const{data:W}=v.storage.from(i).getPublicUrl(V.path);return W.publicUrl},K=async s=>{s.preventDefault(),O(!0);try{let i=o.image_url;if(q&&r!=null&&r.id){const f=q.name.replace(/[^a-zA-Z0-9.]/g,"_"),V=`${r.id}/${Date.now()}_fashion_${f}`;i=await Z(q,"product-images",V)}const h={id:S?S.id:void 0,name:o.name,price:parseFloat(o.price),stock:0,variants:j,image_url:i,description:o.description,category:o.category,store_id:r==null?void 0:r.id};await n(h),k({title:S?"Prenda actualizada":"Prenda añadida",description:"Inventario sincronizado."}),C(!1),F(null),b({name:"",price:"",description:"",category:"General",image_url:""})}catch(i){console.error(i),k({title:"Error",description:"Fallo al guardar.",variant:"destructive"})}finally{O(!1)}},Q=async s=>{if(window.confirm("¿Retirar prenda del catálogo?"))try{await t(s),k({title:"Prenda eliminada"})}catch{k({title:"Error",variant:"destructive"})}};return e.jsxs("div",{className:"space-y-8 font-sans",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-end md:items-center gap-4 border-b border-slate-100 pb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-serif text-slate-900 mb-2",children:"Colección & Stock"}),e.jsx("p",{className:"text-slate-500 font-light",children:"Gestiona tallas, colores y disponiblidad de tus prendas."})]}),e.jsxs(N,{className:"bg-slate-900 text-white hover:bg-slate-800 rounded-none px-8 py-6 uppercase tracking-wider text-xs",onClick:H,children:[e.jsx(R,{className:"h-4 w-4 mr-2"})," Nueva Prenda"]})]}),e.jsx("div",{className:"flex gap-4 items-center bg-white p-1",children:e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(ue,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-300"}),e.jsx(w,{placeholder:"Buscar referencia...",className:"pl-10 border-slate-200 rounded-none focus-visible:ring-0 focus-visible:border-slate-400",value:u,onChange:s=>d(s.target.value)})]})}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-x-8 gap-y-12",children:J.map(s=>e.jsx(Se,{product:{...s,discount:0},onEdit:U,onDelete:Q},s.id))}),e.jsx(ae,{open:m,onOpenChange:C,children:e.jsxs(re,{className:"sm:max-w-[700px] max-h-[90vh] overflow-y-auto",children:[e.jsx(te,{children:e.jsx(ie,{className:"font-serif text-2xl",children:S?"Editar Prenda":"Nueva Prenda"})}),e.jsxs("form",{onSubmit:K,className:"space-y-6 py-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Nombre / Referencia"}),e.jsx(w,{name:"name",value:o.name,onChange:E,placeholder:"Ej: Camisa Lino Blanca",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Precio"}),e.jsx(w,{name:"price",type:"number",value:o.price,onChange:E,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Categoría / Colección"}),e.jsxs($,{name:"category",value:o.category,onValueChange:s=>b(i=>({...i,category:s})),children:[e.jsx(A,{children:e.jsx(L,{})}),e.jsxs(D,{children:[e.jsx(g,{value:"General",children:"General"}),e.jsx(g,{value:"Hombre",children:"Hombre"}),e.jsx(g,{value:"Mujer",children:"Mujer"}),e.jsx(g,{value:"Niños",children:"Niños"}),e.jsx(g,{value:"Accesorios",children:"Accesorios"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Imagen"}),e.jsx(w,{type:"file",accept:"image/*",onChange:Y}),o.image_url&&e.jsx("img",{src:o.image_url,alt:"Preview",className:"h-20 w-auto object-contain border mt-2"})]})]}),e.jsxs("div",{className:"bg-slate-50 p-4 rounded-lg space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(p,{className:"font-bold",children:"Variantes de Stock"}),e.jsxs("span",{className:"text-xs text-slate-500",children:["Total: ",j.reduce((s,i)=>s+Number(i.qty),0)," un."]})]}),e.jsxs("div",{className:"flex gap-2 items-end",children:[e.jsxs("div",{className:"w-20",children:[e.jsx(p,{className:"text-xs",children:"Talla"}),e.jsxs($,{value:y.size,onValueChange:s=>P(i=>({...i,size:s})),children:[e.jsx(A,{className:"h-8 text-xs",children:e.jsx(L,{})}),e.jsx(D,{children:_e.map(s=>e.jsx(g,{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx(p,{className:"text-xs",children:"Color"}),e.jsxs($,{value:y.color,onValueChange:s=>P(i=>({...i,color:s})),children:[e.jsx(A,{className:"h-8 text-xs",children:e.jsx(L,{})}),e.jsx(D,{children:Pe.map(s=>e.jsx(g,{value:s.name,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full border",style:{backgroundColor:s.hex}}),s.name]})},s.name))})]})]}),e.jsxs("div",{className:"w-20",children:[e.jsx(p,{className:"text-xs",children:"Cant."}),e.jsx(w,{type:"number",className:"h-8 text-xs",value:y.qty,onChange:s=>P(i=>({...i,qty:s.target.value}))})]}),e.jsx(N,{type:"button",size:"sm",onClick:M,className:"h-8 bg-black text-white",children:e.jsx(R,{className:"h-3 w-3"})})]}),e.jsxs("div",{className:"space-y-1 max-h-[200px] overflow-y-auto",children:[j.map(s=>e.jsxs("div",{className:"flex justify-between items-center text-sm bg-white p-2 rounded border",children:[e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("span",{className:"font-bold w-6",children:s.size}),e.jsx("span",{className:"text-slate-500",children:s.color})]}),e.jsxs("div",{className:"flex gap-3 items-center",children:[e.jsx("span",{className:"font-mono bg-slate-100 px-1",children:s.qty}),e.jsx(N,{variant:"ghost",size:"icon",className:"h-5 w-5 hover:text-red-500",onClick:()=>X(s.id),children:e.jsx(B,{className:"h-3 w-3"})})]})]},s.id)),j.length===0&&e.jsx("p",{className:"text-xs text-gray-400 text-center py-2",children:"Sin variantes definidas"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Descripción Pública"}),e.jsx(xe,{name:"description",value:o.description,onChange:E,placeholder:"Detalles de la tela, cuidados, etc."})]}),e.jsx(N,{type:"submit",className:"w-full bg-slate-900 text-white rounded-none py-6 uppercase tracking-widest font-bold hover:bg-slate-800",disabled:I,children:I?e.jsx(le,{className:"animate-spin"}):"Guardar Prenda"})]})]})})]})},ts=({store:a})=>{const l=[{path:"",label:"Resumen",icon:oe,element:e.jsx(me,{storeId:a.id})},{path:"coleccion",label:"Colección",icon:T,element:e.jsx(ke,{})},{path:"pedidos",label:"Pedidos",icon:se,element:e.jsx(je,{storeId:a.id})},{path:"clientes",label:"Clientes",icon:ye,element:e.jsx(ve,{})},{path:"finanzas",label:"Finanzas",icon:be,element:e.jsx(fe,{storeId:a.id})},{path:"configuracion",label:"Configuración",icon:we,element:e.jsx(Ne,{})}];return e.jsx(de,{store:a,tabs:l})};export{ts as default};
