import{k as X,E as Z,d as O,R as J,f as d,$ as Q,a0 as W,y as e,a1 as V,a2 as R,a7 as Y,l as D,X as ee,B as se,D as re,_ as ae,Z as te,w,K as oe,H as ie,o as ce,p as de,I as ne,S as le,h as E}from"./index-bea51c07.js";import{P as me,_ as ue}from"./BaseStoreDashboard-9ad5c13e-d7a1a933-4e4e637d-e46edf80.js";import{s as z,u as pe}from"./useStoreDashboard-6cfa5bdd-a014cfe4-c8bff8db-4123484f.js";import he from"./OverviewTab-a01a807a-07dd1735-5ada0bfc-c4caa4a6.js";import{a as S}from"./input-977568de-bea10295-4adb3258-368f21ef.js";import{I as fe,T as be,H as xe,_ as je,k as ge}from"./select-03f52418-c5111b6c-af5e7482-637f31c9.js";import{u as q}from"./label-6ced007b-31f64b09-71156226-1e4e75c4.js";import"./textarea-03a75c76-69040bf5-35a9782e-8e0ca7dd.js";import{l as ye,b as ve}from"./index-e23a302d-1b9287b5-b6450a0d-35f60f24.js";import{e as ke}from"./check-78166ef5-9630779a-ee565adf-12fad7f6.js";import{d as we}from"./badge-34bdff7c-b2c90fce-efd43af8-f7a84e83.js";import{o as Ne,d as Ce,f as K,N as C,m as Pe,b as P}from"./table-d515a05c-fec441de-a95c27a2-dbafa435.js";import{o as A}from"./shopping-cart-8aca5ef3-095b1616-112594bf-3a6e2763.js";import{o as _e}from"./search-566f00ed-c3babbf0-ad60b5b7-3e645f27.js";import{o as Se}from"./pencil-b145156d-81e39600-5a684db5-7834b695.js";import qe from"./OrdersManagementTab-74307886-48065a75-18a01665-f134e541.js";import{B as $e}from"./BulkUploadTab-0fe3efc4-824a62de-987b67e9-4bcf2828.js";import Ee from"./FinancialsTab-e07ef4f8-cb7c3ea0-71aba4e2-cf3d1041.js";import Ie from"./AdminTab-1ef2bbd0-38fe81f3-dd6c0adf-0124de59.js";import Le from"./ProfileTab-fd4f3500-9e2db3bd-31628205-5943de2a.js";import{t as Me}from"./credit-card-bcc8ac59-e0a7eb79-9e00e665-407b30eb.js";import{e as Oe}from"./upload-8259cec2-21216fe4-eb25a68c-1da87379.js";import{t as Re,o as De}from"./settings-96af137d-f461a4db-8933cd88-d7585a9f.js";import{r as ze}from"./users-93d0d9a2-82ed9403-42cfbbc5-b53a716c.js";import"./Helmet-d9a99439-17d17245-80416325-0a82370e.js";import"./log-out-1de3e3ee-53ee1d6f-be22ed5f-31659d2d.js";import"./index-6c60542e-1f0cc56c-a6179bc2-c5eb0dfa.js";import"./triangle-alert-5ea4272b-316ec065-d63fb5c5-7c95de1a.js";import"./package-99b0a55c-785e5cf1-bac652b0-c1d00408.js";import"./trending-up-147c55bb-4628ab85-e3b835f1-1f811d81.js";import"./clock-0a32af33-121834d9-4cd0de5d-d758c7ab.js";import"./truck-a0071c63-090d128d-9cfc595e-b33772c3.js";import"./map-pin-4396fd6c-98f8e615-be2face5-18973d83.js";import"./circle-alert-58769497-aeae36dd-aab7d564-c8980787.js";import"./user-plus-74362f50-3e37ce73-40475d04-0b128926.js";/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ke=[["path",{d:"M3 5v14",key:"1nt18q"}],["path",{d:"M8 5v14",key:"1ybrkv"}],["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"M17 5v14",key:"ycjyhj"}],["path",{d:"M21 5v14",key:"nzette"}]],Ve=X("barcode",Ke),Ae=Z((r,n)=>({products:[],cart:[],isLoadingProducts:!1,isLoadingCheckout:!1,error:null,fetchProducts:async t=>{r({isLoadingProducts:!0});try{const i=await z.obtenerProductos(t);r({products:i||[]})}catch(i){r({error:i.message})}finally{r({isLoadingProducts:!1})}},addToCart:t=>{const i=n().cart,l=i.find(a=>a.id===t.id);return r(l?{cart:i.map(a=>a.id===t.id?{...a,qty:a.qty+1}:a)}:{cart:[...i,{...t,qty:1}]}),!0},removeFromCart:t=>r(i=>({cart:i.cart.filter(l=>l.id!==t)})),updateCartQty:(t,i)=>r(l=>({cart:l.cart.map(a=>a.id===t?{...a,qty:Math.max(1,a.qty+i)}:a)})),clearCart:()=>r({cart:[]}),processCheckout:async(t,i,l,a)=>{const m=n().cart;if(m.length===0)return;const p=typeof i=="object"?{...i,method:l,type:"POS"}:{name:i,method:l,type:"POS"};r({isLoadingCheckout:!0});try{const{data:b,error:h}=await O.from("orders").insert({store_id:t,customer_id:null,status:"Entregado",total:a,delivery_address:JSON.stringify({guest:p,items:m.map(o=>({id:o.id,name:o.name,qty:o.qty,price:o.price}))})}).select().single();if(h)throw h;const x=m.map(o=>({order_id:b.id,product_id:o.id,quantity:o.qty,price:o.price})),{error:j}=await O.from("order_items").insert(x);if(j)throw j;for(const o of m)o.stock!==void 0&&await z.actualizarProducto(o.id,{stock:Math.max(0,o.stock-o.qty)});return n().clearCart(),!0}catch(b){throw b}finally{r({isLoadingCheckout:!1})}}}));var L="Checkbox",[Te,Es]=J(L),[Ge,Ue]=Te(L),T=d.forwardRef((r,n)=>{const{__scopeCheckbox:t,name:i,checked:l,defaultChecked:a,required:m,disabled:p,value:b="on",onCheckedChange:h,form:x,...j}=r,[o,N]=d.useState(null),c=Q(n,u=>N(u)),f=d.useRef(!1),$=o?x||!!o.closest("form"):!0,[g=!1,_]=W({prop:l,defaultProp:a,onChange:h}),I=d.useRef(g);return d.useEffect(()=>{const u=o==null?void 0:o.form;if(u){const v=()=>_(I.current);return u.addEventListener("reset",v),()=>u.removeEventListener("reset",v)}},[o,_]),e.jsxs(Ge,{scope:t,state:g,disabled:p,children:[e.jsx(V.button,{type:"button",role:"checkbox","aria-checked":y(g)?"mixed":g,"aria-required":m,"data-state":B(g),"data-disabled":p?"":void 0,disabled:p,value:b,...j,ref:c,onKeyDown:R(r.onKeyDown,u=>{u.key==="Enter"&&u.preventDefault()}),onClick:R(r.onClick,u=>{_(v=>y(v)?!0:!v),$&&(f.current=u.isPropagationStopped(),f.current||u.stopPropagation())})}),$&&e.jsx(Be,{control:o,bubbles:!f.current,name:i,value:b,checked:g,required:m,disabled:p,form:x,style:{transform:"translateX(-100%)"},defaultChecked:y(a)?!1:a})]})});T.displayName=L;var G="CheckboxIndicator",U=d.forwardRef((r,n)=>{const{__scopeCheckbox:t,forceMount:i,...l}=r,a=Ue(G,t);return e.jsx(Y,{present:i||y(a.state)||a.state===!0,children:e.jsx(V.span,{"data-state":B(a.state),"data-disabled":a.disabled?"":void 0,...l,ref:n,style:{pointerEvents:"none",...r.style}})})});U.displayName=G;var Be=r=>{const{control:n,checked:t,bubbles:i=!0,defaultChecked:l,...a}=r,m=d.useRef(null),p=ye(t),b=ve(n);d.useEffect(()=>{const x=m.current,j=window.HTMLInputElement.prototype,o=Object.getOwnPropertyDescriptor(j,"checked").set;if(p!==t&&o){const N=new Event("click",{bubbles:i});x.indeterminate=y(t),o.call(x,y(t)?!1:t),x.dispatchEvent(N)}},[p,t,i]);const h=d.useRef(y(t)?!1:t);return e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:l??h.current,...a,tabIndex:-1,ref:m,style:{...r.style,...b,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function y(r){return r==="indeterminate"}function B(r){return y(r)?"indeterminate":r?"checked":"unchecked"}var F=T,Fe=U;const He=d.forwardRef(({className:r,...n},t)=>e.jsx(F,{ref:t,className:D("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",r),...n,children:e.jsx(Fe,{className:D("flex items-center justify-center text-current"),children:e.jsx(ke,{className:"h-4 w-4"})})}));He.displayName=F.displayName;const Xe=()=>{const{products:r,fetchProducts:n,addProduct:t,updateProduct:i,deleteProduct:l,store:a}=pe(),[m,p]=d.useState(""),[b,h]=d.useState(!1),[x,j]=d.useState(!1),[o,N]=d.useState(null),[c,f]=d.useState({name:"",price:"",stock:"",description:"",category:"Abarrotes",sku:"",image_url:""});d.useEffect(()=>{a!=null&&a.id&&n(a.id)},[a==null?void 0:a.id,n]);const $=r.filter(s=>s.name.toLowerCase().includes(m.toLowerCase())||s.sku&&s.sku.includes(m)),g=["Abarrotes","Lácteos","Carnes","Frutas/Verduras","Limpieza","Bebidas","Cuidado Personal"],_=()=>{N(null),f({name:"",price:"",stock:"50",description:"",category:"Abarrotes",sku:"",image_url:""}),h(!0)},I=s=>{N(s),f({name:s.name,price:s.price,stock:s.stock,description:s.description||"",category:s.category||"Abarrotes",sku:s.sku||"",image_url:s.image_url||""}),h(!0)},u=async(s,k)=>{try{await i(s.id,{stock:parseInt(k)}),E({title:"Stock actualizado"})}catch{}},v=async s=>{s.preventDefault(),j(!0);try{const k={name:c.name,price:parseFloat(c.price),stock:parseInt(c.stock),sku:c.sku,description:c.sku?`${c.description}

SKU:${c.sku}`:c.description,category:c.category,store_id:a==null?void 0:a.id,product_type:"physical",requires_shipping:!0};o?(await i(o.id,k),E({title:"Producto actualizado"})):(await t(k),E({title:"Producto registrado"})),h(!1)}catch{E({title:"Error",variant:"destructive"})}finally{j(!1)}},H=async s=>{confirm("¿Eliminar producto?")&&await l(s)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-emerald-50 border border-emerald-100 p-6 rounded-t-xl flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-emerald-900 flex items-center gap-2",children:[e.jsx(A,{className:"h-8 w-8 text-emerald-600"}),"Inventario Máster"]}),e.jsx("p",{className:"text-emerald-700",children:"Gestión masiva de referencias, precios y existencias."})]}),e.jsxs(w,{className:"bg-emerald-700 hover:bg-emerald-800",onClick:_,children:[e.jsx(oe,{className:"h-4 w-4 mr-2"})," Nuevo Producto"]})]}),e.jsxs("div",{className:"flex gap-4 items-center bg-white p-2 border-b",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(_e,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(S,{placeholder:"Buscar por nombre, código de barras...",className:"pl-10",value:m,onChange:s=>p(s.target.value)})]}),e.jsxs(w,{variant:"outline",children:[e.jsx(Ve,{className:"h-4 w-4 mr-2"})," Escanear"]})]}),e.jsx("div",{className:"bg-white border rounded-lg overflow-hidden shadow-sm",children:e.jsxs(Ne,{children:[e.jsx(Ce,{children:e.jsxs(K,{className:"bg-gray-50",children:[e.jsx(C,{className:"w-[100px]",children:"Código/SKU"}),e.jsx(C,{children:"Producto"}),e.jsx(C,{children:"Categoría"}),e.jsx(C,{className:"text-right",children:"Precio"}),e.jsx(C,{className:"text-center w-[150px]",children:"Stock"}),e.jsx(C,{className:"text-right",children:"Acciones"})]})}),e.jsx(Pe,{children:$.map(s=>{var k,M;return e.jsxs(K,{children:[e.jsx(P,{className:"font-mono text-xs text-gray-500",children:s.sku||((M=(k=s.description)==null?void 0:k.match(/SKU:(\w+)/))==null?void 0:M[1])||"---"}),e.jsx(P,{className:"font-medium text-slate-800",children:s.name}),e.jsx(P,{children:e.jsx(we,{variant:"outline",className:"font-normal",children:s.category})}),e.jsxs(P,{className:"text-right font-bold text-emerald-700",children:["$",Number(s.price).toLocaleString()]}),e.jsx(P,{className:"text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(w,{variant:"ghost",className:"h-6 w-6 rounded-full p-0",onClick:()=>u(s,Math.max(0,s.stock-1)),children:"-"}),e.jsx("span",{className:"w-8 text-center",children:s.stock}),e.jsx(w,{variant:"ghost",className:"h-6 w-6 rounded-full p-0",onClick:()=>u(s,s.stock+1),children:"+"})]})}),e.jsxs(P,{className:"text-right",children:[e.jsx(w,{variant:"ghost",size:"sm",onClick:()=>I(s),children:e.jsx(Se,{className:"h-4 w-4 text-blue-500"})}),e.jsx(w,{variant:"ghost",size:"sm",onClick:()=>H(s.id),children:e.jsx(ie,{className:"h-4 w-4 text-red-500"})})]})]},s.id)})})]})}),e.jsx(ce,{open:b,onOpenChange:h,children:e.jsxs(de,{children:[e.jsx(ne,{children:e.jsx(le,{children:"Producto de Supermercado"})}),e.jsxs("form",{onSubmit:v,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2 col-span-2",children:[e.jsx(q,{children:"Nombre Producto"}),e.jsx(S,{value:c.name,onChange:s=>f({...c,name:s.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{children:"Código Barras / SKU"}),e.jsx(S,{value:c.sku,onChange:s=>f({...c,sku:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{children:"Categoría"}),e.jsxs(fe,{value:c.category,onValueChange:s=>f({...c,category:s}),children:[e.jsx(be,{children:e.jsx(xe,{})}),e.jsx(je,{children:g.map(s=>e.jsx(ge,{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{children:"Precio"}),e.jsx(S,{type:"number",value:c.price,onChange:s=>f({...c,price:s.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{children:"Stock Inicial"}),e.jsx(S,{type:"number",value:c.stock,onChange:s=>f({...c,stock:s.target.value}),required:!0})]})]}),e.jsx(w,{type:"submit",className:"w-full bg-emerald-600 hover:bg-emerald-700",disabled:x,children:"Guardar"})]})]})})]})},Ze=d.lazy(()=>ee(()=>se(()=>re(()=>ae(()=>import("./GenericPOSView-65865e30-e48d2479-1f7364f9-da5c4b26.js"),["./GenericPOSView-65865e30-e48d2479-1f7364f9-da5c4b26.js","./index-bea51c07.js","./index-dc19931e.css","./input-977568de-bea10295-4adb3258-368f21ef.js","./badge-34bdff7c-b2c90fce-efd43af8-f7a84e83.js","./scroll-area-d0c9b1aa-5d11dc0b-4a9e3f1e-c4827a88.js","./label-6ced007b-31f64b09-71156226-1e4e75c4.js","./useStoreDashboard-6cfa5bdd-a014cfe4-c8bff8db-4123484f.js","./shopping-cart-8aca5ef3-095b1616-112594bf-3a6e2763.js","./search-566f00ed-c3babbf0-ad60b5b7-3e645f27.js","./circle-check-big-68527463-8ad93454-9bdb44d7-ad5a0975.js"],import.meta.url),["./GenericPOSView-65865e30-e48d2479-1f7364f9.js","./index-8e3c4911.js","./index-dc19931e.css","./input-977568de-bea10295-4adb3258.js","./badge-34bdff7c-b2c90fce-efd43af8.js","./scroll-area-d0c9b1aa-5d11dc0b-4a9e3f1e.js","./label-6ced007b-31f64b09-71156226.js","./useStoreDashboard-6cfa5bdd-a014cfe4-c8bff8db.js","./shopping-cart-8aca5ef3-095b1616-112594bf.js","./search-566f00ed-c3babbf0-ad60b5b7.js","./circle-check-big-68527463-8ad93454-9bdb44d7.js"],import.meta.url),["./GenericPOSView-65865e30-e48d2479.js","./index-4834c6e1.js","./index-dc19931e.css","./input-977568de-bea10295.js","./badge-34bdff7c-b2c90fce.js","./scroll-area-d0c9b1aa-5d11dc0b.js","./label-6ced007b-31f64b09.js","./useStoreDashboard-6cfa5bdd-a014cfe4.js","./shopping-cart-8aca5ef3-095b1616.js","./search-566f00ed-c3babbf0.js","./circle-check-big-68527463-8ad93454.js"],import.meta.url),["./GenericPOSView-65865e30.js","./index-3101bb07.js","./index-dc19931e.css","./input-977568de.js","./badge-34bdff7c.js","./scroll-area-d0c9b1aa.js","./label-6ced007b.js","./useStoreDashboard-6cfa5bdd.js","./shopping-cart-8aca5ef3.js","./search-566f00ed.js","./circle-check-big-68527463.js"],import.meta.url)),Is=d.memo(({store:r})=>{const n=[{path:"",label:"Resumen",icon:me,element:e.jsx(he,{storeId:r.id})},{path:"caja",label:"Caja (POS)",icon:Me,element:e.jsx(Ze,{useStore:Ae,title:"Caja Registradora"})},{path:"inventario",label:"Inventario",icon:A,element:e.jsx(Xe,{})},{path:"pedidos",label:"Pedidos",icon:te,element:e.jsx(qe,{storeId:r.id})},{path:"importar",label:"Carga Masiva",icon:Oe,element:e.jsx($e,{storeId:r.id,onProductsUploaded:()=>{}})},{path:"finanzas",label:"Finanzas",icon:Re,element:e.jsx(Ee,{storeId:r.id})},{path:"equipo",label:"Cajeros",icon:ze,element:e.jsx(Ie,{storeId:r.id})},{path:"configuracion",label:"Ajustes",icon:De,element:e.jsx(Le,{})}];return e.jsx(ue,{store:r,tabs:n})});export{Is as default};
