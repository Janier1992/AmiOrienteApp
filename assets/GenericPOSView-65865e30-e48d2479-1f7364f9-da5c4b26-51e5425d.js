import{f as t,y as e,J as ae,Z,B as A,x as d,m as D,n as P,I as _,T as q,R as O,P as z,W as le,a as te,d as re,N as h}from"./index-87ab05f1.js";import{a as o}from"./input-977568de-bea10295-4adb3258-368f21ef-dd0395aa.js";import{d as ce}from"./badge-34bdff7c-b2c90fce-efd43af8-f7a84e83-2020d777.js";import{f as B}from"./scroll-area-d0c9b1aa-5d11dc0b-4a9e3f1e-c4827a88-a3cd7b48.js";import{u as i}from"./label-6ced007b-31f64b09-71156226-1e4e75c4-8af8544c.js";import{u as ie}from"./useStoreDashboard-6cfa5bdd-a014cfe4-c8bff8db-4123484f-ad5d382b.js";import{e as v}from"./shopping-cart-8aca5ef3-095b1616-112594bf-3a6e2763-072beeee.js";import{o as J}from"./search-566f00ed-c3babbf0-ad60b5b7-3e645f27-67335d64.js";import{p as R}from"./circle-check-big-68527463-8ad93454-9bdb44d7-ad5a0975-66385ab6.js";const ne=({product:a,onAddToCart:j})=>{const l=a.stock<=0;return e.jsxs(te,{className:`overflow-hidden h-full flex flex-col group ${l?"opacity-60":""}`,children:[e.jsxs("div",{className:"relative h-32 overflow-hidden bg-slate-100",children:[a.image_url?e.jsx("img",{src:a.image_url,alt:a.name,className:"w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-slate-400",children:e.jsx(v,{className:"h-8 w-8"})}),l&&e.jsx("div",{className:"absolute inset-0 bg-black/10 flex items-center justify-center",children:e.jsx(ce,{variant:"destructive",children:"Agotado"})})]}),e.jsxs(re,{className:"p-3 flex-1 flex flex-col",children:[e.jsx("h3",{className:"font-semibold text-sm leading-tight mb-1 line-clamp-2",children:a.name}),e.jsx("p",{className:"text-xs text-slate-500 mb-2",children:a.category||"General"}),e.jsxs("div",{className:"mt-auto flex items-center justify-between",children:[e.jsxs("span",{className:"font-bold text-blue-900",children:["$",parseFloat(a.price).toLocaleString()]}),e.jsx(d,{size:"sm",className:"h-7 w-7 rounded-full p-0",onClick:()=>j(a),disabled:l,children:e.jsx(Z,{className:"h-4 w-4"})})]})]})]})},fe=({useStore:a,title:j="Punto de Venta"})=>{const{store:l}=ie(),{products:G,fetchProducts:b,cart:r,addToCart:M,removeFromCart:Q,updateCartQty:w,clearCart:W,processCheckout:U,isLoadingCheckout:y}=a(),[p,X]=t.useState(""),[Y,x]=t.useState(!1),[u,C]=t.useState(""),[g,S]=t.useState(""),[k,L]=t.useState(""),[$,T]=t.useState(""),[m,F]=t.useState("Efectivo"),[H,f]=t.useState(!1),[c,K]=t.useState(null);t.useEffect(()=>{l!=null&&l.id&&b(l.id)},[l==null?void 0:l.id,b]);const E=G.filter(s=>s.name.toLowerCase().includes(p.toLowerCase())||s.code&&s.code.toLowerCase().includes(p.toLowerCase())),I=r.reduce((s,n)=>s+n.price*n.qty,0),N=I,ee=s=>{M(s)||h({title:"Stock insuficiente",variant:"destructive"})},se=async()=>{if(!u||!g){h({title:"Datos incompletos",description:"Nombre y Documento son obligatorios",variant:"destructive"});return}const s={name:u,docId:g,phone:k,email:$},n={customer:s,items:[...r],total:N,date:new Date().toLocaleString(),id:`POS-${Date.now().toString().slice(-6)}`,paymentMethod:m};try{await U(l.id,s,m,N),x(!1),K(n),f(!0),C(""),S(""),L(""),T(""),h({title:"Venta realizada con éxito"})}catch(V){console.error(V),h({title:"Error al procesar venta",description:V.message,variant:"destructive"})}};return e.jsxs("div",{className:"flex h-[calc(100vh-100px)] gap-4 font-sans",children:[e.jsxs("div",{className:"flex-1 flex flex-col gap-4",children:[e.jsxs("div",{className:"bg-white p-4 rounded-xl border border-slate-200 shadow-sm flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-slate-800 flex items-center gap-2",children:[e.jsx(v,{className:"h-6 w-6 text-blue-600"}),j]}),e.jsx("p",{className:"text-slate-500 text-sm",children:"Selecciona productos para agregar a la orden"})]}),e.jsxs("div",{className:"relative w-72",children:[e.jsx(J,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(o,{placeholder:"Buscar producto...",className:"pl-9 bg-slate-50",value:p,onChange:s=>X(s.target.value)})]})]}),e.jsxs(B,{className:"flex-1 bg-slate-50/50 rounded-xl border border-slate-200 p-4",children:[e.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:E.map(s=>e.jsx(ne,{product:s,onAddToCart:ee},s.id))}),E.length===0&&e.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-slate-400",children:[e.jsx(J,{className:"h-12 w-12 mb-2 opacity-20"}),e.jsx("p",{children:"No se encontraron productos"})]})]})]}),e.jsxs("div",{className:"w-96 bg-white border-l border-slate-200 flex flex-col shadow-xl",children:[e.jsxs("div",{className:"p-4 border-b border-slate-100 bg-slate-50",children:[e.jsxs("h2",{className:"font-bold text-lg flex items-center gap-2",children:[e.jsx(v,{className:"h-5 w-5"}),"Orden Actual"]}),e.jsxs("p",{className:"text-xs text-slate-400",children:[r.length," ítems"]})]}),e.jsx(B,{className:"flex-1 p-4",children:e.jsxs("div",{className:"space-y-3",children:[r.map(s=>e.jsxs("div",{className:"flex gap-3 bg-white border border-slate-100 p-2 rounded-lg shadow-sm",children:[e.jsx("div",{className:"h-12 w-12 bg-slate-100 rounded-md overflow-hidden flex-shrink-0",children:s.image_url&&e.jsx("img",{src:s.image_url,alt:"",className:"h-full w-full object-cover"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"text-sm font-medium truncate",children:s.name}),e.jsxs("div",{className:"flex items-center justify-between mt-1",children:[e.jsxs("div",{className:"flex items-center gap-2 bg-slate-50 rounded-md p-0.5",children:[e.jsx("button",{className:"h-6 w-6 flex items-center justify-center hover:bg-slate-200 rounded",onClick:()=>w(s.id,-1),children:e.jsx(ae,{className:"h-3 w-3"})}),e.jsx("span",{className:"text-xs w-4 text-center font-medium",children:s.qty}),e.jsx("button",{className:"h-6 w-6 flex items-center justify-center hover:bg-slate-200 rounded",onClick:()=>w(s.id,1),children:e.jsx(Z,{className:"h-3 w-3"})})]}),e.jsxs("span",{className:"text-sm font-bold",children:["$",(s.price*s.qty).toLocaleString()]})]})]}),e.jsx("button",{className:"text-slate-300 hover:text-red-500 self-center",onClick:()=>Q(s.id),children:e.jsx(A,{className:"h-4 w-4"})})]},s.id)),r.length===0&&e.jsx("div",{className:"text-center py-10 text-slate-400 text-sm",children:"El carrito está vacío"})]})}),e.jsxs("div",{className:"p-4 bg-slate-50 border-t border-slate-200",children:[e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-slate-500",children:"Subtotal"}),e.jsxs("span",{children:["$",I.toLocaleString()]})]}),e.jsx("div",{className:"border-b border-gray-200"}),e.jsxs("div",{className:"flex justify-between font-bold text-lg",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{className:"text-blue-600",children:["$",N.toLocaleString()]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs(d,{variant:"outline",onClick:W,disabled:r.length===0,children:[e.jsx(A,{className:"h-4 w-4 mr-2"}),"Limpiar"]}),e.jsxs(d,{className:"bg-blue-600 hover:bg-blue-700",disabled:r.length===0,onClick:()=>x(!0),children:["Pagar ",e.jsx(R,{className:"h-4 w-4 ml-2"})]})]})]})]}),e.jsx(D,{open:Y,onOpenChange:x,children:e.jsxs(P,{className:"sm:max-w-[425px]",children:[e.jsxs(_,{children:[e.jsx(q,{children:"Finalizar Venta"}),e.jsx(O,{children:"Ingrese los datos del cliente para la factura."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(i,{htmlFor:"docId",className:"text-right",children:"Documento"}),e.jsx(o,{id:"docId",value:g,onChange:s=>S(s.target.value),className:"col-span-3",placeholder:"CC / NIT"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(i,{htmlFor:"name",className:"text-right",children:"Nombre"}),e.jsx(o,{id:"name",value:u,onChange:s=>C(s.target.value),className:"col-span-3",placeholder:"Nombre completo"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(i,{htmlFor:"phone",className:"text-right",children:"Celular"}),e.jsx(o,{id:"phone",value:k,onChange:s=>L(s.target.value),className:"col-span-3",placeholder:"300..."})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(i,{htmlFor:"email",className:"text-right",children:"Email"}),e.jsx(o,{id:"email",value:$,onChange:s=>T(s.target.value),className:"col-span-3",placeholder:"cliente@email.com"})]}),e.jsx("div",{className:"border-b border-gray-200 my-2"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Método de Pago"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",id:"r1",value:"Efectivo",checked:m==="Efectivo",onChange:s=>F(s.target.value),className:"h-4 w-4"}),e.jsx(i,{htmlFor:"r1",children:"Efectivo"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",id:"r2",value:"Tarjeta",checked:m==="Tarjeta",onChange:s=>F(s.target.value),className:"h-4 w-4"}),e.jsx(i,{htmlFor:"r2",children:"Tarjeta"})]})]})]})]}),e.jsxs(z,{children:[e.jsx(d,{variant:"outline",onClick:()=>x(!1),children:"Cancelar"}),e.jsxs(d,{onClick:se,disabled:y,children:[y?e.jsx(le,{className:"animate-spin mr-2"}):null,"Confirmar Venta"]})]})]})}),e.jsx(D,{open:H,onOpenChange:f,children:e.jsxs(P,{className:"sm:max-w-[400px]",children:[e.jsxs(_,{children:[e.jsxs(q,{className:"flex items-center gap-2 text-green-600",children:[e.jsx(R,{className:"h-6 w-6"}),"Venta Exitosa"]}),e.jsx(O,{children:"Resumen de la factura generada."})]}),c&&e.jsxs("div",{className:"bg-slate-50 p-4 rounded-lg text-sm space-y-3 font-mono border",children:[e.jsxs("div",{className:"flex justify-between border-b pb-2",children:[e.jsx("span",{children:"Factura #"}),e.jsx("span",{className:"font-bold",children:c.id})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{children:[e.jsx("span",{className:"text-slate-500",children:"Cliente:"})," ",c.customer.name]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-slate-500",children:"Doc:"})," ",c.customer.docId]})]}),e.jsx("div",{className:"border-t border-b py-2 space-y-1",children:c.items.map((s,n)=>e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{children:[s.qty,"x ",s.name]}),e.jsxs("span",{children:["$",(s.price*s.qty).toLocaleString()]})]},n))}),e.jsxs("div",{className:"flex justify-between text-lg font-bold pt-1",children:[e.jsx("span",{children:"TOTAL"}),e.jsxs("span",{children:["$",c.total.toLocaleString()]})]}),e.jsxs("p",{className:"text-center text-xs text-slate-400 pt-2",children:["Comprobante enviado a ",c.customer.email||"N/A"]})]}),e.jsx(z,{children:e.jsx(d,{className:"w-full",onClick:()=>f(!1),children:"Cerrar y Nueva Venta"})})]})})]})};export{fe as default};
